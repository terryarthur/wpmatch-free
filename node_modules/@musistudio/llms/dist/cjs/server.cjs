"use strict";var Yy=Object.create;var ps=Object.defineProperty;var Xy=Object.getOwnPropertyDescriptor;var Qy=Object.getOwnPropertyNames;var Zy=Object.getPrototypeOf,e0=Object.prototype.hasOwnProperty;var Me=(r,e)=>()=>(r&&(e=r(r=0)),e);var z=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Ba=(r,e)=>{for(var t in e)ps(r,t,{get:e[t],enumerable:!0})},Rf=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Qy(e))!e0.call(r,s)&&s!==t&&ps(r,s,{get:()=>e[s],enumerable:!(n=Xy(e,s))||n.enumerable});return r};var qe=(r,e,t)=>(t=r!=null?Yy(Zy(r)):{},Rf(e||!r||!r.__esModule?ps(t,"default",{value:r,enumerable:!0}):t,r)),t0=r=>Rf(ps({},"__esModule",{value:!0}),r);var kf=z((Xw,ms)=>{ms.exports.Space_Separator=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/;ms.exports.ID_Start=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/;ms.exports.ID_Continue=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/});var Na=z((Qw,Ff)=>{var Ia=kf();Ff.exports={isSpaceSeparator(r){return typeof r=="string"&&Ia.Space_Separator.test(r)},isIdStartChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="$"||r==="_"||Ia.ID_Start.test(r))},isIdContinueChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r==="$"||r==="_"||r==="\u200C"||r==="\u200D"||Ia.ID_Continue.test(r))},isDigit(r){return typeof r=="string"&&/[0-9]/.test(r)},isHexDigit(r){return typeof r=="string"&&/[0-9A-Fa-f]/.test(r)}}});var If=z((Zw,Bf)=>{var $e=Na(),ja,et,dr,ys,Fr,It,He,Ma,io;Bf.exports=function(e,t){ja=String(e),et="start",dr=[],ys=0,Fr=1,It=0,He=void 0,Ma=void 0,io=void 0;do He=r0(),s0[et]();while(He.type!=="eof");return typeof t=="function"?La({"":io},"",t):io};function La(r,e,t){let n=r[e];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let s=0;s<n.length;s++){let a=String(s),u=La(n,a,t);u===void 0?delete n[a]:Object.defineProperty(n,a,{value:u,writable:!0,enumerable:!0,configurable:!0})}else for(let s in n){let a=La(n,s,t);a===void 0?delete n[s]:Object.defineProperty(n,s,{value:a,writable:!0,enumerable:!0,configurable:!0})}return t.call(r,e,n)}var pe,fe,so,fr,_e;function r0(){for(pe="default",fe="",so=!1,fr=1;;){_e=hr();let r=Pf[pe]();if(r)return r}}function hr(){if(ja[ys])return String.fromCodePoint(ja.codePointAt(ys))}function $(){let r=hr();return r===`
`?(Fr++,It=0):r?It+=r.length:It++,r&&(ys+=r.length),r}var Pf={default(){switch(_e){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":$();return;case"/":$(),pe="comment";return;case void 0:return $(),Oe("eof")}if($e.isSpaceSeparator(_e)){$();return}return Pf[et]()},comment(){switch(_e){case"*":$(),pe="multiLineComment";return;case"/":$(),pe="singleLineComment";return}throw Pe($())},multiLineComment(){switch(_e){case"*":$(),pe="multiLineCommentAsterisk";return;case void 0:throw Pe($())}$()},multiLineCommentAsterisk(){switch(_e){case"*":$();return;case"/":$(),pe="default";return;case void 0:throw Pe($())}$(),pe="multiLineComment"},singleLineComment(){switch(_e){case`
`:case"\r":case"\u2028":case"\u2029":$(),pe="default";return;case void 0:return $(),Oe("eof")}$()},value(){switch(_e){case"{":case"[":return Oe("punctuator",$());case"n":return $(),Kr("ull"),Oe("null",null);case"t":return $(),Kr("rue"),Oe("boolean",!0);case"f":return $(),Kr("alse"),Oe("boolean",!1);case"-":case"+":$()==="-"&&(fr=-1),pe="sign";return;case".":fe=$(),pe="decimalPointLeading";return;case"0":fe=$(),pe="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":fe=$(),pe="decimalInteger";return;case"I":return $(),Kr("nfinity"),Oe("numeric",1/0);case"N":return $(),Kr("aN"),Oe("numeric",NaN);case'"':case"'":so=$()==='"',fe="",pe="string";return}throw Pe($())},identifierNameStartEscape(){if(_e!=="u")throw Pe($());$();let r=Ua();switch(r){case"$":case"_":break;default:if(!$e.isIdStartChar(r))throw Of();break}fe+=r,pe="identifierName"},identifierName(){switch(_e){case"$":case"_":case"\u200C":case"\u200D":fe+=$();return;case"\\":$(),pe="identifierNameEscape";return}if($e.isIdContinueChar(_e)){fe+=$();return}return Oe("identifier",fe)},identifierNameEscape(){if(_e!=="u")throw Pe($());$();let r=Ua();switch(r){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!$e.isIdContinueChar(r))throw Of();break}fe+=r,pe="identifierName"},sign(){switch(_e){case".":fe=$(),pe="decimalPointLeading";return;case"0":fe=$(),pe="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":fe=$(),pe="decimalInteger";return;case"I":return $(),Kr("nfinity"),Oe("numeric",fr*(1/0));case"N":return $(),Kr("aN"),Oe("numeric",NaN)}throw Pe($())},zero(){switch(_e){case".":fe+=$(),pe="decimalPoint";return;case"e":case"E":fe+=$(),pe="decimalExponent";return;case"x":case"X":fe+=$(),pe="hexadecimal";return}return Oe("numeric",fr*0)},decimalInteger(){switch(_e){case".":fe+=$(),pe="decimalPoint";return;case"e":case"E":fe+=$(),pe="decimalExponent";return}if($e.isDigit(_e)){fe+=$();return}return Oe("numeric",fr*Number(fe))},decimalPointLeading(){if($e.isDigit(_e)){fe+=$(),pe="decimalFraction";return}throw Pe($())},decimalPoint(){switch(_e){case"e":case"E":fe+=$(),pe="decimalExponent";return}if($e.isDigit(_e)){fe+=$(),pe="decimalFraction";return}return Oe("numeric",fr*Number(fe))},decimalFraction(){switch(_e){case"e":case"E":fe+=$(),pe="decimalExponent";return}if($e.isDigit(_e)){fe+=$();return}return Oe("numeric",fr*Number(fe))},decimalExponent(){switch(_e){case"+":case"-":fe+=$(),pe="decimalExponentSign";return}if($e.isDigit(_e)){fe+=$(),pe="decimalExponentInteger";return}throw Pe($())},decimalExponentSign(){if($e.isDigit(_e)){fe+=$(),pe="decimalExponentInteger";return}throw Pe($())},decimalExponentInteger(){if($e.isDigit(_e)){fe+=$();return}return Oe("numeric",fr*Number(fe))},hexadecimal(){if($e.isHexDigit(_e)){fe+=$(),pe="hexadecimalInteger";return}throw Pe($())},hexadecimalInteger(){if($e.isHexDigit(_e)){fe+=$();return}return Oe("numeric",fr*Number(fe))},string(){switch(_e){case"\\":$(),fe+=n0();return;case'"':if(so)return $(),Oe("string",fe);fe+=$();return;case"'":if(!so)return $(),Oe("string",fe);fe+=$();return;case`
`:case"\r":throw Pe($());case"\u2028":case"\u2029":i0(_e);break;case void 0:throw Pe($())}fe+=$()},start(){switch(_e){case"{":case"[":return Oe("punctuator",$())}pe="value"},beforePropertyName(){switch(_e){case"$":case"_":fe=$(),pe="identifierName";return;case"\\":$(),pe="identifierNameStartEscape";return;case"}":return Oe("punctuator",$());case'"':case"'":so=$()==='"',pe="string";return}if($e.isIdStartChar(_e)){fe+=$(),pe="identifierName";return}throw Pe($())},afterPropertyName(){if(_e===":")return Oe("punctuator",$());throw Pe($())},beforePropertyValue(){pe="value"},afterPropertyValue(){switch(_e){case",":case"}":return Oe("punctuator",$())}throw Pe($())},beforeArrayValue(){if(_e==="]")return Oe("punctuator",$());pe="value"},afterArrayValue(){switch(_e){case",":case"]":return Oe("punctuator",$())}throw Pe($())},end(){throw Pe($())}};function Oe(r,e){return{type:r,value:e,line:Fr,column:It}}function Kr(r){for(let e of r){if(hr()!==e)throw Pe($());$()}}function n0(){switch(hr()){case"b":return $(),"\b";case"f":return $(),"\f";case"n":return $(),`
`;case"r":return $(),"\r";case"t":return $(),"	";case"v":return $(),"\v";case"0":if($(),$e.isDigit(hr()))throw Pe($());return"\0";case"x":return $(),o0();case"u":return $(),Ua();case`
`:case"\u2028":case"\u2029":return $(),"";case"\r":return $(),hr()===`
`&&$(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw Pe($());case void 0:throw Pe($())}return $()}function o0(){let r="",e=hr();if(!$e.isHexDigit(e)||(r+=$(),e=hr(),!$e.isHexDigit(e)))throw Pe($());return r+=$(),String.fromCodePoint(parseInt(r,16))}function Ua(){let r="",e=4;for(;e-- >0;){let t=hr();if(!$e.isHexDigit(t))throw Pe($());r+=$()}return String.fromCodePoint(parseInt(r,16))}var s0={start(){if(He.type==="eof")throw Yr();qa()},beforePropertyName(){switch(He.type){case"identifier":case"string":Ma=He.value,et="afterPropertyName";return;case"punctuator":gs();return;case"eof":throw Yr()}},afterPropertyName(){if(He.type==="eof")throw Yr();et="beforePropertyValue"},beforePropertyValue(){if(He.type==="eof")throw Yr();qa()},beforeArrayValue(){if(He.type==="eof")throw Yr();if(He.type==="punctuator"&&He.value==="]"){gs();return}qa()},afterPropertyValue(){if(He.type==="eof")throw Yr();switch(He.value){case",":et="beforePropertyName";return;case"}":gs()}},afterArrayValue(){if(He.type==="eof")throw Yr();switch(He.value){case",":et="beforeArrayValue";return;case"]":gs()}},end(){}};function qa(){let r;switch(He.type){case"punctuator":switch(He.value){case"{":r={};break;case"[":r=[];break}break;case"null":case"boolean":case"numeric":case"string":r=He.value;break}if(io===void 0)io=r;else{let e=dr[dr.length-1];Array.isArray(e)?e.push(r):Object.defineProperty(e,Ma,{value:r,writable:!0,enumerable:!0,configurable:!0})}if(r!==null&&typeof r=="object")dr.push(r),Array.isArray(r)?et="beforeArrayValue":et="beforePropertyName";else{let e=dr[dr.length-1];e==null?et="end":Array.isArray(e)?et="afterArrayValue":et="afterPropertyValue"}}function gs(){dr.pop();let r=dr[dr.length-1];r==null?et="end":Array.isArray(r)?et="afterArrayValue":et="afterPropertyValue"}function Pe(r){return _s(r===void 0?`JSON5: invalid end of input at ${Fr}:${It}`:`JSON5: invalid character '${xf(r)}' at ${Fr}:${It}`)}function Yr(){return _s(`JSON5: invalid end of input at ${Fr}:${It}`)}function Of(){return It-=5,_s(`JSON5: invalid identifier character at ${Fr}:${It}`)}function i0(r){console.warn(`JSON5: '${xf(r)}' in strings is not valid ECMAScript; consider escaping`)}function xf(r){let e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[r])return e[r];if(r<" "){let t=r.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return r}function _s(r){let e=new SyntaxError(r);return e.lineNumber=Fr,e.columnNumber=It,e}});var qf=z((eA,Nf)=>{var $a=Na();Nf.exports=function(e,t,n){let s=[],a="",u,l,f="",d;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(n=t.space,d=t.quote,t=t.replacer),typeof t=="function")l=t;else if(Array.isArray(t)){u=[];for(let b of t){let _;typeof b=="string"?_=b:(typeof b=="number"||b instanceof String||b instanceof Number)&&(_=String(b)),_!==void 0&&u.indexOf(_)<0&&u.push(_)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),typeof n=="number"?n>0&&(n=Math.min(10,Math.floor(n)),f="          ".substr(0,n)):typeof n=="string"&&(f=n.substr(0,10)),h("",{"":e});function h(b,_){let y=_[b];switch(y!=null&&(typeof y.toJSON5=="function"?y=y.toJSON5(b):typeof y.toJSON=="function"&&(y=y.toJSON(b))),l&&(y=l.call(_,b,y)),y instanceof Number?y=Number(y):y instanceof String?y=String(y):y instanceof Boolean&&(y=y.valueOf()),y){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof y=="string")return C(y,!1);if(typeof y=="number")return String(y);if(typeof y=="object")return Array.isArray(y)?S(y):w(y)}function C(b){let _={"'":.1,'"':.2},y={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},T="";for(let L=0;L<b.length;L++){let P=b[L];switch(P){case"'":case'"':_[P]++,T+=P;continue;case"\0":if($a.isDigit(b[L+1])){T+="\\x00";continue}}if(y[P]){T+=y[P];continue}if(P<" "){let j=P.charCodeAt(0).toString(16);T+="\\x"+("00"+j).substring(j.length);continue}T+=P}let F=d||Object.keys(_).reduce((L,P)=>_[L]<_[P]?L:P);return T=T.replace(new RegExp(F,"g"),y[F]),F+T+F}function w(b){if(s.indexOf(b)>=0)throw TypeError("Converting circular structure to JSON5");s.push(b);let _=a;a=a+f;let y=u||Object.keys(b),T=[];for(let L of y){let P=h(L,b);if(P!==void 0){let j=I(L)+":";f!==""&&(j+=" "),j+=P,T.push(j)}}let F;if(T.length===0)F="{}";else{let L;if(f==="")L=T.join(","),F="{"+L+"}";else{let P=`,
`+a;L=T.join(P),F=`{
`+a+L+`,
`+_+"}"}}return s.pop(),a=_,F}function I(b){if(b.length===0)return C(b,!0);let _=String.fromCodePoint(b.codePointAt(0));if(!$a.isIdStartChar(_))return C(b,!0);for(let y=_.length;y<b.length;y++)if(!$a.isIdContinueChar(String.fromCodePoint(b.codePointAt(y))))return C(b,!0);return b}function S(b){if(s.indexOf(b)>=0)throw TypeError("Converting circular structure to JSON5");s.push(b);let _=a;a=a+f;let y=[];for(let F=0;F<b.length;F++){let L=h(String(F),b);y.push(L!==void 0?L:"null")}let T;if(y.length===0)T="[]";else if(f==="")T="["+y.join(",")+"]";else{let F=`,
`+a,L=y.join(F);T=`[
`+a+L+`,
`+_+"]"}return s.pop(),a=_,T}}});var Ha=z((tA,jf)=>{var a0=If(),u0=qf(),c0={parse:a0,stringify:u0};jf.exports=c0});var Va=z((BA,od)=>{"use strict";var ks=Object.prototype.hasOwnProperty,nd=Object.prototype.toString,Xf=Object.defineProperty,Qf=Object.getOwnPropertyDescriptor,Zf=function(e){return typeof Array.isArray=="function"?Array.isArray(e):nd.call(e)==="[object Array]"},ed=function(e){if(!e||nd.call(e)!=="[object Object]")return!1;var t=ks.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&ks.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var s;for(s in e);return typeof s>"u"||ks.call(e,s)},td=function(e,t){Xf&&t.name==="__proto__"?Xf(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},rd=function(e,t){if(t==="__proto__")if(ks.call(e,t)){if(Qf)return Qf(e,t).value}else return;return e[t]};od.exports=function r(){var e,t,n,s,a,u,l=arguments[0],f=1,d=arguments.length,h=!1;for(typeof l=="boolean"&&(h=l,l=arguments[1]||{},f=2),(l==null||typeof l!="object"&&typeof l!="function")&&(l={});f<d;++f)if(e=arguments[f],e!=null)for(t in e)n=rd(l,t),s=rd(e,t),l!==s&&(h&&s&&(ed(s)||(a=Zf(s)))?(a?(a=!1,u=n&&Zf(n)?n:[]):u=n&&ed(n)?n:{},td(l,{name:t,newValue:r(h,u,s)})):typeof s<"u"&&td(l,{name:t,newValue:s}));return l}});var sd=z((IA,C0)=>{C0.exports={name:"gaxios",version:"7.1.1",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:"googleapis/gaxios",keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^4.0.0","jsdoc-region-tag":"^3.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^3.0.0",puppeteer:"^24.0.0",sinon:"^20.0.0","stream-browserify":"^3.0.0",tmp:"0.2.3","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2"}}});var ad=z((NA,id)=>{"use strict";var b0=sd();id.exports={pkg:b0}});var Xa=z(Dt=>{"use strict";var cd=Dt&&Dt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.GaxiosError=Dt.GAXIOS_ERROR_SYMBOL=void 0;Dt.defaultErrorRedactor=ld;var ud=cd(Va()),E0=cd(ad()),Ka=E0.default.pkg;Dt.GAXIOS_ERROR_SYMBOL=Symbol.for(`${Ka.name}-gaxios-error`);var Ya=class r extends Error{config;response;code;status;error;[Dt.GAXIOS_ERROR_SYMBOL]=Ka.version;static[Symbol.hasInstance](e){return e&&typeof e=="object"&&Dt.GAXIOS_ERROR_SYMBOL in e&&e[Dt.GAXIOS_ERROR_SYMBOL]===Ka.version?!0:Function.prototype[Symbol.hasInstance].call(r,e)}constructor(e,t,n,s){if(super(e,{cause:s}),this.config=t,this.response=n,this.error=s instanceof Error?s:void 0,this.config=(0,ud.default)(!0,{},t),this.response&&(this.response.config=(0,ud.default)(!0,{},this.response.config)),this.response){try{this.response.data=w0(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}s instanceof DOMException?this.code=s.name:s&&typeof s=="object"&&"code"in s&&(typeof s.code=="string"||typeof s.code=="number")&&(this.code=s.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let n=t;if(typeof e.data=="string"&&(n=e.data),e.data&&typeof e.data=="object"&&"error"in e.data&&e.data.error&&!e.ok){if(typeof e.data.error=="string")return{message:e.data.error,code:e.status,status:e.statusText};if(typeof e.data.error=="object"){n="message"in e.data.error&&typeof e.data.error.message=="string"?e.data.error.message:n;let s="status"in e.data.error&&typeof e.data.error.status=="string"?e.data.error.status:e.statusText,a="code"in e.data.error&&typeof e.data.error.code=="number"?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let u=[];for(let l of e.data.error.errors)typeof l=="object"&&"message"in l&&typeof l.message=="string"&&u.push(l.message);return Object.assign({message:u.join(`
`)||n,code:a,status:s},e.data.error)}return Object.assign({message:n,code:a,status:s},e.data.error)}}return{message:n,code:e.status,status:e.statusText}}};Dt.GaxiosError=Ya;function w0(r,e){switch(r){case"stream":return e;case"json":return JSON.parse(JSON.stringify(e));case"arraybuffer":return JSON.parse(Buffer.from(e).toString("utf8"));case"blob":return JSON.parse(e.text());default:return e}}function ld(r){let e="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function t(a){a&&a.forEach((u,l)=>{(/^authentication$/i.test(l)||/^authorization$/i.test(l)||/secret/i.test(l))&&a.set(l,e)})}function n(a,u){if(typeof a=="object"&&a!==null&&typeof a[u]=="string"){let l=a[u];(/grant_type=/i.test(l)||/assertion=/i.test(l)||/secret/i.test(l))&&(a[u]=e)}}function s(a){!a||typeof a!="object"||(a instanceof FormData||a instanceof URLSearchParams||"forEach"in a&&"set"in a?a.forEach((u,l)=>{(["grant_type","assertion"].includes(l)||/secret/.test(l))&&a.set(l,e)}):("grant_type"in a&&(a.grant_type=e),"assertion"in a&&(a.assertion=e),"client_secret"in a&&(a.client_secret=e)))}return r.config&&(t(r.config.headers),n(r.config,"data"),s(r.config.data),n(r.config,"body"),s(r.config.body),r.config.url.searchParams.has("token")&&r.config.url.searchParams.set("token",e),r.config.url.searchParams.has("client_secret")&&r.config.url.searchParams.set("client_secret",e)),r.response&&(ld({config:r.response.config}),t(r.response.headers),r.response.bodyUsed&&(n(r.response,"data"),s(r.response.data))),r}});var dd=z(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.getRetryConfig=A0;async function A0(r){let e=fd(r);if(!r||!r.config||!e&&!r.config.retry)return{shouldRetry:!1};e=e||{},e.currentRetryAttempt=e.currentRetryAttempt||0,e.retry=e.retry===void 0||e.retry===null?3:e.retry,e.httpMethodsToRetry=e.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],e.noResponseRetries=e.noResponseRetries===void 0||e.noResponseRetries===null?2:e.noResponseRetries,e.retryDelayMultiplier=e.retryDelayMultiplier?e.retryDelayMultiplier:2,e.timeOfFirstRequest=e.timeOfFirstRequest?e.timeOfFirstRequest:Date.now(),e.totalTimeout=e.totalTimeout?e.totalTimeout:Number.MAX_SAFE_INTEGER,e.maxRetryDelay=e.maxRetryDelay?e.maxRetryDelay:Number.MAX_SAFE_INTEGER;let t=[[100,199],[408,408],[429,429],[500,599]];if(e.statusCodesToRetry=e.statusCodesToRetry||t,r.config.retryConfig=e,!await(e.shouldRetry||D0)(r))return{shouldRetry:!1,config:r.config};let s=S0(e);r.config.retryConfig.currentRetryAttempt+=1;let a=e.retryBackoff?e.retryBackoff(r,s):new Promise(u=>{setTimeout(u,s)});return e.onRetryAttempt&&await e.onRetryAttempt(r),await a,{shouldRetry:!0,config:r.config}}function D0(r){let e=fd(r);if(r.config.signal?.aborted&&r.code!=="TimeoutError"||r.code==="AbortError"||!e||e.retry===0||!r.response&&(e.currentRetryAttempt||0)>=e.noResponseRetries||!e.httpMethodsToRetry||!e.httpMethodsToRetry.includes(r.config.method?.toUpperCase()||"GET"))return!1;if(r.response&&r.response.status){let t=!1;for(let[n,s]of e.statusCodesToRetry){let a=r.response.status;if(a>=n&&a<=s){t=!0;break}}if(!t)return!1}return e.currentRetryAttempt=e.currentRetryAttempt||0,!(e.currentRetryAttempt>=e.retry)}function fd(r){if(r&&r.config&&r.config.retryConfig)return r.config.retryConfig}function S0(r){let t=(r.currentRetryAttempt?0:r.retryDelay??100)+(Math.pow(r.retryDelayMultiplier,r.currentRetryAttempt)-1)/2*1e3,n=r.totalTimeout-(Date.now()-r.timeOfFirstRequest);return Math.min(t,n,r.maxRetryDelay)}});var eu=z(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.GaxiosInterceptorManager=void 0;var Za=class extends Set{};Fs.GaxiosInterceptorManager=Za});var pd=z((UA,hd)=>{var An=1e3,Dn=An*60,Sn=Dn*60,Xr=Sn*24,v0=Xr*7,T0=Xr*365.25;hd.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return R0(r);if(t==="number"&&isFinite(r))return e.long?F0(r):k0(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function R0(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*T0;case"weeks":case"week":case"w":return t*v0;case"days":case"day":case"d":return t*Xr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Sn;case"minutes":case"minute":case"mins":case"min":case"m":return t*Dn;case"seconds":case"second":case"secs":case"sec":case"s":return t*An;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function k0(r){var e=Math.abs(r);return e>=Xr?Math.round(r/Xr)+"d":e>=Sn?Math.round(r/Sn)+"h":e>=Dn?Math.round(r/Dn)+"m":e>=An?Math.round(r/An)+"s":r+"ms"}function F0(r){var e=Math.abs(r);return e>=Xr?Os(r,e,Xr,"day"):e>=Sn?Os(r,e,Sn,"hour"):e>=Dn?Os(r,e,Dn,"minute"):e>=An?Os(r,e,An,"second"):r+" ms"}function Os(r,e,t,n){var s=e>=t*1.5;return Math.round(r/t)+" "+n+(s?"s":"")}});var tu=z((MA,md)=>{function O0(r){t.debug=t,t.default=t,t.coerce=f,t.disable=u,t.enable=s,t.enabled=l,t.humanize=pd(),t.destroy=d,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let C=0;for(let w=0;w<h.length;w++)C=(C<<5)-C+h.charCodeAt(w),C|=0;return t.colors[Math.abs(C)%t.colors.length]}t.selectColor=e;function t(h){let C,w=null,I,S;function b(..._){if(!b.enabled)return;let y=b,T=Number(new Date),F=T-(C||T);y.diff=F,y.prev=C,y.curr=T,C=T,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let L=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(j,G)=>{if(j==="%%")return"%";L++;let te=t.formatters[G];if(typeof te=="function"){let W=_[L];j=te.call(y,W),_.splice(L,1),L--}return j}),t.formatArgs.call(y,_),(y.log||t.log).apply(y,_)}return b.namespace=h,b.useColors=t.useColors(),b.color=t.selectColor(h),b.extend=n,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>w!==null?w:(I!==t.namespaces&&(I=t.namespaces,S=t.enabled(h)),S),set:_=>{w=_}}),typeof t.init=="function"&&t.init(b),b}function n(h,C){let w=t(this.namespace+(typeof C>"u"?":":C)+h);return w.log=this.log,w}function s(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let C=(typeof h=="string"?h:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let w of C)w[0]==="-"?t.skips.push(w.slice(1)):t.names.push(w)}function a(h,C){let w=0,I=0,S=-1,b=0;for(;w<h.length;)if(I<C.length&&(C[I]===h[w]||C[I]==="*"))C[I]==="*"?(S=I,b=w,I++):(w++,I++);else if(S!==-1)I=S+1,b++,w=b;else return!1;for(;I<C.length&&C[I]==="*";)I++;return I===C.length}function u(){let h=[...t.names,...t.skips.map(C=>"-"+C)].join(",");return t.enable(""),h}function l(h){for(let C of t.skips)if(a(h,C))return!1;for(let C of t.names)if(a(h,C))return!0;return!1}function f(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}md.exports=O0});var gd=z((ot,Ps)=>{ot.formatArgs=x0;ot.save=B0;ot.load=I0;ot.useColors=P0;ot.storage=N0();ot.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ot.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function P0(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function x0(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Ps.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),r.splice(n,0,e)}ot.log=console.debug||console.log||(()=>{});function B0(r){try{r?ot.storage.setItem("debug",r):ot.storage.removeItem("debug")}catch{}}function I0(){let r;try{r=ot.storage.getItem("debug")||ot.storage.getItem("DEBUG")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function N0(){try{return localStorage}catch{}}Ps.exports=tu()(ot);var{formatters:q0}=Ps.exports;q0.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var _d=z(($A,yd)=>{"use strict";yd.exports=(r,e)=>{e=e||process.argv;let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),s=e.indexOf("--");return n!==-1&&(s===-1?!0:n<s)}});var bd=z((HA,Cd)=>{"use strict";var j0=require("os"),Nt=_d(),Xe=process.env,vn;Nt("no-color")||Nt("no-colors")||Nt("color=false")?vn=!1:(Nt("color")||Nt("colors")||Nt("color=true")||Nt("color=always"))&&(vn=!0);"FORCE_COLOR"in Xe&&(vn=Xe.FORCE_COLOR.length===0||parseInt(Xe.FORCE_COLOR,10)!==0);function L0(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function U0(r){if(vn===!1)return 0;if(Nt("color=16m")||Nt("color=full")||Nt("color=truecolor"))return 3;if(Nt("color=256"))return 2;if(r&&!r.isTTY&&vn!==!0)return 0;let e=vn?1:0;if(process.platform==="win32"){let t=j0.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Xe)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Xe)||Xe.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Xe)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Xe.TEAMCITY_VERSION)?1:0;if(Xe.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Xe){let t=parseInt((Xe.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Xe.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Xe.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Xe.TERM)||"COLORTERM"in Xe?1:(Xe.TERM==="dumb",e)}function ru(r){let e=U0(r);return L0(e)}Cd.exports={supportsColor:ru,stdout:ru(process.stdout),stderr:ru(process.stderr)}});var wd=z((Ge,Bs)=>{var M0=require("tty"),xs=require("util");Ge.init=V0;Ge.log=W0;Ge.formatArgs=H0;Ge.save=z0;Ge.load=J0;Ge.useColors=$0;Ge.destroy=xs.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ge.colors=[6,2,3,4,5,1];try{let r=bd();r&&(r.stderr||r).level>=2&&(Ge.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Ge.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,a)=>a.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function $0(){return"colors"in Ge.inspectOpts?!!Ge.inspectOpts.colors:M0.isatty(process.stderr.fd)}function H0(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,s="\x1B[3"+(n<8?n:"8;5;"+n),a=`  ${s};1m${e} \x1B[0m`;r[0]=a+r[0].split(`
`).join(`
`+a),r.push(s+"m+"+Bs.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=G0()+e+" "+r[0]}function G0(){return Ge.inspectOpts.hideDate?"":new Date().toISOString()+" "}function W0(...r){return process.stderr.write(xs.formatWithOptions(Ge.inspectOpts,...r)+`
`)}function z0(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function J0(){return process.env.DEBUG}function V0(r){r.inspectOpts={};let e=Object.keys(Ge.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=Ge.inspectOpts[e[t]]}Bs.exports=tu()(Ge);var{formatters:Ed}=Bs.exports;Ed.o=function(r){return this.inspectOpts.colors=this.useColors,xs.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Ed.O=function(r){return this.inspectOpts.colors=this.useColors,xs.inspect(r,this.inspectOpts)}});var ou=z((GA,nu)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?nu.exports=gd():nu.exports=wd()});var Sd=z(st=>{"use strict";var K0=st&&st.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Y0=st&&st.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Ad=st&&st.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&K0(e,r,t);return Y0(e,r),e};Object.defineProperty(st,"__esModule",{value:!0});st.req=st.json=st.toBuffer=void 0;var X0=Ad(require("http")),Q0=Ad(require("https"));async function Dd(r){let e=0,t=[];for await(let n of r)e+=n.length,t.push(n);return Buffer.concat(t,e)}st.toBuffer=Dd;async function Z0(r){let t=(await Dd(r)).toString("utf8");try{return JSON.parse(t)}catch(n){let s=n;throw s.message+=` (input: ${t})`,s}}st.json=Z0;function e_(r,e={}){let n=((typeof r=="string"?r:r.href).startsWith("https:")?Q0:X0).request(r,e),s=new Promise((a,u)=>{n.once("response",a).once("error",u).end()});return n.then=s.then.bind(s),n}st.req=e_});var kd=z(lt=>{"use strict";var Td=lt&&lt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),t_=lt&&lt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Rd=lt&&lt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Td(e,r,t);return t_(e,r),e},r_=lt&&lt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Td(e,r,t)};Object.defineProperty(lt,"__esModule",{value:!0});lt.Agent=void 0;var n_=Rd(require("net")),vd=Rd(require("http")),o_=require("https");r_(Sd(),lt);var Jt=Symbol("AgentBaseInternalState"),su=class extends vd.Agent{constructor(e){super(e),this[Jt]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:t}=new Error;return typeof t!="string"?!1:t.split(`
`).some(n=>n.indexOf("(https.js:")!==-1||n.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new n_.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||t===null)return;let n=this.sockets[e],s=n.indexOf(t);s!==-1&&(n.splice(s,1),this.totalSocketCount--,n.length===0&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?o_.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,n){let s={...t,secureEndpoint:this.isSecureEndpoint(t)},a=this.getName(s),u=this.incrementSockets(a);Promise.resolve().then(()=>this.connect(e,s)).then(l=>{if(this.decrementSockets(a,u),l instanceof vd.Agent)try{return l.addRequest(e,s)}catch(f){return n(f)}this[Jt].currentSocket=l,super.createSocket(e,t,n)},l=>{this.decrementSockets(a,u),n(l)})}createConnection(){let e=this[Jt].currentSocket;if(this[Jt].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[Jt].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(e){this[Jt]&&(this[Jt].defaultPort=e)}get protocol(){return this[Jt].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[Jt]&&(this[Jt].protocol=e)}};lt.Agent=su});var Fd=z(Tn=>{"use strict";var s_=Tn&&Tn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Tn,"__esModule",{value:!0});Tn.parseProxyResponse=void 0;var i_=s_(ou()),Is=(0,i_.default)("https-proxy-agent:parse-proxy-response");function a_(r){return new Promise((e,t)=>{let n=0,s=[];function a(){let h=r.read();h?d(h):r.once("readable",a)}function u(){r.removeListener("end",l),r.removeListener("error",f),r.removeListener("readable",a)}function l(){u(),Is("onend"),t(new Error("Proxy connection ended before receiving CONNECT response"))}function f(h){u(),Is("onerror %o",h),t(h)}function d(h){s.push(h),n+=h.length;let C=Buffer.concat(s,n),w=C.indexOf(`\r
\r
`);if(w===-1){Is("have not received end of HTTP headers yet..."),a();return}let I=C.slice(0,w).toString("ascii").split(`\r
`),S=I.shift();if(!S)return r.destroy(),t(new Error("No header received from proxy CONNECT response"));let b=S.split(" "),_=+b[1],y=b.slice(2).join(" "),T={};for(let F of I){if(!F)continue;let L=F.indexOf(":");if(L===-1)return r.destroy(),t(new Error(`Invalid header from proxy CONNECT response: "${F}"`));let P=F.slice(0,L).toLowerCase(),j=F.slice(L+1).trimStart(),G=T[P];typeof G=="string"?T[P]=[G,j]:Array.isArray(G)?G.push(j):T[P]=j}Is("got proxy server response: %o %o",S,T),u(),e({connect:{statusCode:_,statusText:y,headers:T},buffered:C})}r.on("error",f),r.on("end",l),a()})}Tn.parseProxyResponse=a_});var Nd=z(St=>{"use strict";var u_=St&&St.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),c_=St&&St.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Bd=St&&St.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&u_(e,r,t);return c_(e,r),e},Id=St&&St.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(St,"__esModule",{value:!0});St.HttpsProxyAgent=void 0;var Ns=Bd(require("net")),Od=Bd(require("tls")),l_=Id(require("assert")),f_=Id(ou()),d_=kd(),h_=require("url"),p_=Fd(),uo=(0,f_.default)("https-proxy-agent"),Pd=r=>r.servername===void 0&&r.host&&!Ns.isIP(r.host)?{...r,servername:r.host}:r,qs=class extends d_.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy=typeof e=="string"?new h_.URL(e):e,this.proxyHeaders=t?.headers??{},uo("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),s=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?xd(t,"headers"):null,host:n,port:s}}async connect(e,t){let{proxy:n}=this;if(!t.host)throw new TypeError('No "host" provided');let s;n.protocol==="https:"?(uo("Creating `tls.Socket`: %o",this.connectOpts),s=Od.connect(Pd(this.connectOpts))):(uo("Creating `net.Socket`: %o",this.connectOpts),s=Ns.connect(this.connectOpts));let a=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},u=Ns.isIPv6(t.host)?`[${t.host}]`:t.host,l=`CONNECT ${u}:${t.port} HTTP/1.1\r
`;if(n.username||n.password){let w=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;a["Proxy-Authorization"]=`Basic ${Buffer.from(w).toString("base64")}`}a.Host=`${u}:${t.port}`,a["Proxy-Connection"]||(a["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let w of Object.keys(a))l+=`${w}: ${a[w]}\r
`;let f=(0,p_.parseProxyResponse)(s);s.write(`${l}\r
`);let{connect:d,buffered:h}=await f;if(e.emit("proxyConnect",d),this.emit("proxyConnect",d,e),d.statusCode===200)return e.once("socket",m_),t.secureEndpoint?(uo("Upgrading socket connection to TLS"),Od.connect({...xd(Pd(t),"host","path","port"),socket:s})):s;s.destroy();let C=new Ns.Socket({writable:!1});return C.readable=!0,e.once("socket",w=>{uo("Replaying proxy buffer for failed request"),(0,l_.default)(w.listenerCount("data")>0),w.push(h),w.push(null)}),C}};qs.protocols=["http","https"];St.HttpsProxyAgent=qs;function m_(r){r.resume()}function xd(r,...e){let t={},n;for(n in r)e.includes(n)||(t[n]=r[n]);return t}});function g_(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let e=r.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=r.substring(5,e).split(";"),n="",s=!1,a=t[0]||"text/plain",u=a;for(let h=1;h<t.length;h++)t[h]==="base64"?s=!0:t[h]&&(u+=`;${t[h]}`,t[h].indexOf("charset=")===0&&(n=t[h].substring(8)));!t[0]&&!n.length&&(u+=";charset=US-ASCII",n="US-ASCII");let l=s?"base64":"ascii",f=unescape(r.substring(e+1)),d=Buffer.from(f,l);return d.type=a,d.typeFull=u,d.charset=n,d}var qd,jd=Me(()=>{qd=g_});var Ud=z((js,Ld)=>{(function(r,e){typeof js=="object"&&typeof Ld<"u"?e(js):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.WebStreamsPolyfill={}))})(js,function(r){"use strict";function e(){}function t(o){return typeof o=="object"&&o!==null||typeof o=="function"}let n=e;function s(o,i){try{Object.defineProperty(o,"name",{value:i,configurable:!0})}catch{}}let a=Promise,u=Promise.prototype.then,l=Promise.reject.bind(a);function f(o){return new a(o)}function d(o){return f(i=>i(o))}function h(o){return l(o)}function C(o,i,c){return u.call(o,i,c)}function w(o,i,c){C(C(o,i,c),void 0,n)}function I(o,i){w(o,i)}function S(o,i){w(o,void 0,i)}function b(o,i,c){return C(o,i,c)}function _(o){C(o,void 0,n)}let y=o=>{if(typeof queueMicrotask=="function")y=queueMicrotask;else{let i=d(void 0);y=c=>C(i,c)}return y(o)};function T(o,i,c){if(typeof o!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(o,i,c)}function F(o,i,c){try{return d(T(o,i,c))}catch(m){return h(m)}}let L=16384;class P{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(i){let c=this._back,m=c;c._elements.length===L-1&&(m={_elements:[],_next:void 0}),c._elements.push(i),m!==c&&(this._back=m,c._next=m),++this._size}shift(){let i=this._front,c=i,m=this._cursor,A=m+1,N=i._elements,U=N[m];return A===L&&(c=i._next,A=0),--this._size,this._cursor=A,i!==c&&(this._front=c),N[m]=void 0,U}forEach(i){let c=this._cursor,m=this._front,A=m._elements;for(;(c!==A.length||m._next!==void 0)&&!(c===A.length&&(m=m._next,A=m._elements,c=0,A.length===0));)i(A[c]),++c}peek(){let i=this._front,c=this._cursor;return i._elements[c]}}let j=Symbol("[[AbortSteps]]"),G=Symbol("[[ErrorSteps]]"),te=Symbol("[[CancelSteps]]"),W=Symbol("[[PullSteps]]"),be=Symbol("[[ReleaseSteps]]");function de(o,i){o._ownerReadableStream=i,i._reader=o,i._state==="readable"?ue(o):i._state==="closed"?ve(o):he(o,i._storedError)}function oe(o,i){let c=o._ownerReadableStream;return xt(c,i)}function ae(o){let i=o._ownerReadableStream;i._state==="readable"?J(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Y(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),i._readableStreamController[be](),i._reader=void 0,o._ownerReadableStream=void 0}function Q(o){return new TypeError("Cannot "+o+" a stream using a released reader")}function ue(o){o._closedPromise=f((i,c)=>{o._closedPromise_resolve=i,o._closedPromise_reject=c})}function he(o,i){ue(o),J(o,i)}function ve(o){ue(o),ce(o)}function J(o,i){o._closedPromise_reject!==void 0&&(_(o._closedPromise),o._closedPromise_reject(i),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}function Y(o,i){he(o,i)}function ce(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}let Ne=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},ze=Math.trunc||function(o){return o<0?Math.ceil(o):Math.floor(o)};function H(o){return typeof o=="object"||typeof o=="function"}function ge(o,i){if(o!==void 0&&!H(o))throw new TypeError(`${i} is not an object.`)}function we(o,i){if(typeof o!="function")throw new TypeError(`${i} is not a function.`)}function nr(o){return typeof o=="object"&&o!==null||typeof o=="function"}function xe(o,i){if(!nr(o))throw new TypeError(`${i} is not an object.`)}function Ie(o,i,c){if(o===void 0)throw new TypeError(`Parameter ${i} is required in '${c}'.`)}function p(o,i,c){if(o===void 0)throw new TypeError(`${i} is required in '${c}'.`)}function g(o){return Number(o)}function E(o){return o===0?0:o}function x(o){return E(ze(o))}function v(o,i){let m=Number.MAX_SAFE_INTEGER,A=Number(o);if(A=E(A),!Ne(A))throw new TypeError(`${i} is not a finite number`);if(A=x(A),A<0||A>m)throw new TypeError(`${i} is outside the accepted range of 0 to ${m}, inclusive`);return!Ne(A)||A===0?0:A}function k(o,i){if(!vr(o))throw new TypeError(`${i} is not a ReadableStream.`)}function q(o){return new M(o)}function D(o,i){o._reader._readRequests.push(i)}function R(o,i,c){let A=o._reader._readRequests.shift();c?A._closeSteps():A._chunkSteps(i)}function B(o){return o._reader._readRequests.length}function O(o){let i=o._reader;return!(i===void 0||!K(i))}class M{constructor(i){if(Ie(i,1,"ReadableStreamDefaultReader"),k(i,"First parameter"),Tr(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");de(this,i),this._readRequests=new P}get closed(){return K(this)?this._closedPromise:h(Be("closed"))}cancel(i=void 0){return K(this)?this._ownerReadableStream===void 0?h(Q("cancel")):oe(this,i):h(Be("cancel"))}read(){if(!K(this))return h(Be("read"));if(this._ownerReadableStream===void 0)return h(Q("read from"));let i,c,m=f((N,U)=>{i=N,c=U});return X(this,{_chunkSteps:N=>i({value:N,done:!1}),_closeSteps:()=>i({value:void 0,done:!0}),_errorSteps:N=>c(N)}),m}releaseLock(){if(!K(this))throw Be("releaseLock");this._ownerReadableStream!==void 0&&Ee(this)}}Object.defineProperties(M.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(M.prototype.cancel,"cancel"),s(M.prototype.read,"read"),s(M.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(M.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function K(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readRequests")?!1:o instanceof M}function X(o,i){let c=o._ownerReadableStream;c._disturbed=!0,c._state==="closed"?i._closeSteps():c._state==="errored"?i._errorSteps(c._storedError):c._readableStreamController[W](i)}function Ee(o){ae(o);let i=new TypeError("Reader was released");Fe(o,i)}function Fe(o,i){let c=o._readRequests;o._readRequests=new P,c.forEach(m=>{m._errorSteps(i)})}function Be(o){return new TypeError(`ReadableStreamDefaultReader.prototype.${o} can only be used on a ReadableStreamDefaultReader`)}let Ce=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Ae{constructor(i,c){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=i,this._preventCancel=c}next(){let i=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?b(this._ongoingPromise,i,i):i(),this._ongoingPromise}return(i){let c=()=>this._returnSteps(i);return this._ongoingPromise?b(this._ongoingPromise,c,c):c()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let i=this._reader,c,m,A=f((U,V)=>{c=U,m=V});return X(i,{_chunkSteps:U=>{this._ongoingPromise=void 0,y(()=>c({value:U,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,ae(i),c({value:void 0,done:!0})},_errorSteps:U=>{this._ongoingPromise=void 0,this._isFinished=!0,ae(i),m(U)}}),A}_returnSteps(i){if(this._isFinished)return Promise.resolve({value:i,done:!0});this._isFinished=!0;let c=this._reader;if(!this._preventCancel){let m=oe(c,i);return ae(c),b(m,()=>({value:i,done:!0}))}return ae(c),d({value:i,done:!0})}}let Le={next(){return ln(this)?this._asyncIteratorImpl.next():h(fn("next"))},return(o){return ln(this)?this._asyncIteratorImpl.return(o):h(fn("return"))}};Object.setPrototypeOf(Le,Ce);function cn(o,i){let c=q(o),m=new Ae(c,i),A=Object.create(Le);return A._asyncIteratorImpl=m,A}function ln(o){if(!t(o)||!Object.prototype.hasOwnProperty.call(o,"_asyncIteratorImpl"))return!1;try{return o._asyncIteratorImpl instanceof Ae}catch{return!1}}function fn(o){return new TypeError(`ReadableStreamAsyncIterator.${o} can only be used on a ReadableSteamAsyncIterator`)}let ut=Number.isNaN||function(o){return o!==o};var or,Ke,Ue;function De(o){return o.slice()}function Sl(o,i,c,m,A){new Uint8Array(o).set(new Uint8Array(c,m,A),i)}let sr=o=>(typeof o.transfer=="function"?sr=i=>i.transfer():typeof structuredClone=="function"?sr=i=>structuredClone(i,{transfer:[i]}):sr=i=>i,sr(o)),wr=o=>(typeof o.detached=="boolean"?wr=i=>i.detached:wr=i=>i.byteLength===0,wr(o));function vl(o,i,c){if(o.slice)return o.slice(i,c);let m=c-i,A=new ArrayBuffer(m);return Sl(A,0,o,i,m),A}function Mo(o,i){let c=o[i];if(c!=null){if(typeof c!="function")throw new TypeError(`${String(i)} is not a function`);return c}}function mg(o){let i={[Symbol.iterator]:()=>o.iterator},c=async function*(){return yield*i}(),m=c.next;return{iterator:c,nextMethod:m,done:!1}}let aa=(Ue=(or=Symbol.asyncIterator)!==null&&or!==void 0?or:(Ke=Symbol.for)===null||Ke===void 0?void 0:Ke.call(Symbol,"Symbol.asyncIterator"))!==null&&Ue!==void 0?Ue:"@@asyncIterator";function Tl(o,i="sync",c){if(c===void 0)if(i==="async"){if(c=Mo(o,aa),c===void 0){let N=Mo(o,Symbol.iterator),U=Tl(o,"sync",N);return mg(U)}}else c=Mo(o,Symbol.iterator);if(c===void 0)throw new TypeError("The object is not iterable");let m=T(c,o,[]);if(!t(m))throw new TypeError("The iterator method must return an object");let A=m.next;return{iterator:m,nextMethod:A,done:!1}}function gg(o){let i=T(o.nextMethod,o.iterator,[]);if(!t(i))throw new TypeError("The iterator.next() method must return an object");return i}function yg(o){return!!o.done}function _g(o){return o.value}function Cg(o){return!(typeof o!="number"||ut(o)||o<0)}function Rl(o){let i=vl(o.buffer,o.byteOffset,o.byteOffset+o.byteLength);return new Uint8Array(i)}function ua(o){let i=o._queue.shift();return o._queueTotalSize-=i.size,o._queueTotalSize<0&&(o._queueTotalSize=0),i.value}function ca(o,i,c){if(!Cg(c)||c===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");o._queue.push({value:i,size:c}),o._queueTotalSize+=c}function bg(o){return o._queue.peek().value}function Ar(o){o._queue=new P,o._queueTotalSize=0}function kl(o){return o===DataView}function Eg(o){return kl(o.constructor)}function wg(o){return kl(o)?1:o.BYTES_PER_ELEMENT}class Mr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!la(this))throw ma("view");return this._view}respond(i){if(!la(this))throw ma("respond");if(Ie(i,1,"respond"),i=v(i,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(wr(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");Wo(this._associatedReadableByteStreamController,i)}respondWithNewView(i){if(!la(this))throw ma("respondWithNewView");if(Ie(i,1,"respondWithNewView"),!ArrayBuffer.isView(i))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(wr(i.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");zo(this._associatedReadableByteStreamController,i)}}Object.defineProperties(Mr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),s(Mr.prototype.respond,"respond"),s(Mr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Mr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class ir{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!$r(this))throw Qn("byobRequest");return pa(this)}get desiredSize(){if(!$r(this))throw Qn("desiredSize");return Ll(this)}close(){if(!$r(this))throw Qn("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be closed`);Xn(this)}enqueue(i){if(!$r(this))throw Qn("enqueue");if(Ie(i,1,"enqueue"),!ArrayBuffer.isView(i))throw new TypeError("chunk must be an array buffer view");if(i.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(i.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let c=this._controlledReadableByteStream._state;if(c!=="readable")throw new TypeError(`The stream (in ${c} state) is not in the readable state and cannot be enqueued to`);Go(this,i)}error(i=void 0){if(!$r(this))throw Qn("error");Et(this,i)}[te](i){Fl(this),Ar(this);let c=this._cancelAlgorithm(i);return Ho(this),c}[W](i){let c=this._controlledReadableByteStream;if(this._queueTotalSize>0){jl(this,i);return}let m=this._autoAllocateChunkSize;if(m!==void 0){let A;try{A=new ArrayBuffer(m)}catch(U){i._errorSteps(U);return}let N={buffer:A,bufferByteLength:m,byteOffset:0,byteLength:m,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(N)}D(c,i),Hr(this)}[be](){if(this._pendingPullIntos.length>0){let i=this._pendingPullIntos.peek();i.readerType="none",this._pendingPullIntos=new P,this._pendingPullIntos.push(i)}}}Object.defineProperties(ir.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),s(ir.prototype.close,"close"),s(ir.prototype.enqueue,"enqueue"),s(ir.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ir.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function $r(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableByteStream")?!1:o instanceof ir}function la(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_associatedReadableByteStreamController")?!1:o instanceof Mr}function Hr(o){if(!Tg(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;let c=o._pullAlgorithm();w(c,()=>(o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,Hr(o)),null),m=>(Et(o,m),null))}function Fl(o){da(o),o._pendingPullIntos=new P}function fa(o,i){let c=!1;o._state==="closed"&&(c=!0);let m=Ol(i);i.readerType==="default"?R(o,m,c):xg(o,m,c)}function Ol(o){let i=o.bytesFilled,c=o.elementSize;return new o.viewConstructor(o.buffer,o.byteOffset,i/c)}function $o(o,i,c,m){o._queue.push({buffer:i,byteOffset:c,byteLength:m}),o._queueTotalSize+=m}function Pl(o,i,c,m){let A;try{A=vl(i,c,c+m)}catch(N){throw Et(o,N),N}$o(o,A,0,m)}function xl(o,i){i.bytesFilled>0&&Pl(o,i.buffer,i.byteOffset,i.bytesFilled),dn(o)}function Bl(o,i){let c=Math.min(o._queueTotalSize,i.byteLength-i.bytesFilled),m=i.bytesFilled+c,A=c,N=!1,U=m%i.elementSize,V=m-U;V>=i.minimumFill&&(A=V-i.bytesFilled,N=!0);let ie=o._queue;for(;A>0;){let ee=ie.peek(),le=Math.min(A,ee.byteLength),me=i.byteOffset+i.bytesFilled;Sl(i.buffer,me,ee.buffer,ee.byteOffset,le),ee.byteLength===le?ie.shift():(ee.byteOffset+=le,ee.byteLength-=le),o._queueTotalSize-=le,Il(o,le,i),A-=le}return N}function Il(o,i,c){c.bytesFilled+=i}function Nl(o){o._queueTotalSize===0&&o._closeRequested?(Ho(o),oo(o._controlledReadableByteStream)):Hr(o)}function da(o){o._byobRequest!==null&&(o._byobRequest._associatedReadableByteStreamController=void 0,o._byobRequest._view=null,o._byobRequest=null)}function ha(o){for(;o._pendingPullIntos.length>0;){if(o._queueTotalSize===0)return;let i=o._pendingPullIntos.peek();Bl(o,i)&&(dn(o),fa(o._controlledReadableByteStream,i))}}function Ag(o){let i=o._controlledReadableByteStream._reader;for(;i._readRequests.length>0;){if(o._queueTotalSize===0)return;let c=i._readRequests.shift();jl(o,c)}}function Dg(o,i,c,m){let A=o._controlledReadableByteStream,N=i.constructor,U=wg(N),{byteOffset:V,byteLength:ie}=i,ee=c*U,le;try{le=sr(i.buffer)}catch(Te){m._errorSteps(Te);return}let me={buffer:le,bufferByteLength:le.byteLength,byteOffset:V,byteLength:ie,bytesFilled:0,minimumFill:ee,elementSize:U,viewConstructor:N,readerType:"byob"};if(o._pendingPullIntos.length>0){o._pendingPullIntos.push(me),$l(A,m);return}if(A._state==="closed"){let Te=new N(me.buffer,me.byteOffset,0);m._closeSteps(Te);return}if(o._queueTotalSize>0){if(Bl(o,me)){let Te=Ol(me);Nl(o),m._chunkSteps(Te);return}if(o._closeRequested){let Te=new TypeError("Insufficient bytes to fill elements in the given buffer");Et(o,Te),m._errorSteps(Te);return}}o._pendingPullIntos.push(me),$l(A,m),Hr(o)}function Sg(o,i){i.readerType==="none"&&dn(o);let c=o._controlledReadableByteStream;if(ga(c))for(;Hl(c)>0;){let m=dn(o);fa(c,m)}}function vg(o,i,c){if(Il(o,i,c),c.readerType==="none"){xl(o,c),ha(o);return}if(c.bytesFilled<c.minimumFill)return;dn(o);let m=c.bytesFilled%c.elementSize;if(m>0){let A=c.byteOffset+c.bytesFilled;Pl(o,c.buffer,A-m,m)}c.bytesFilled-=m,fa(o._controlledReadableByteStream,c),ha(o)}function ql(o,i){let c=o._pendingPullIntos.peek();da(o),o._controlledReadableByteStream._state==="closed"?Sg(o,c):vg(o,i,c),Hr(o)}function dn(o){return o._pendingPullIntos.shift()}function Tg(o){let i=o._controlledReadableByteStream;return i._state!=="readable"||o._closeRequested||!o._started?!1:!!(O(i)&&B(i)>0||ga(i)&&Hl(i)>0||Ll(o)>0)}function Ho(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0}function Xn(o){let i=o._controlledReadableByteStream;if(!(o._closeRequested||i._state!=="readable")){if(o._queueTotalSize>0){o._closeRequested=!0;return}if(o._pendingPullIntos.length>0){let c=o._pendingPullIntos.peek();if(c.bytesFilled%c.elementSize!==0){let m=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Et(o,m),m}}Ho(o),oo(i)}}function Go(o,i){let c=o._controlledReadableByteStream;if(o._closeRequested||c._state!=="readable")return;let{buffer:m,byteOffset:A,byteLength:N}=i;if(wr(m))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let U=sr(m);if(o._pendingPullIntos.length>0){let V=o._pendingPullIntos.peek();if(wr(V.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");da(o),V.buffer=sr(V.buffer),V.readerType==="none"&&xl(o,V)}if(O(c))if(Ag(o),B(c)===0)$o(o,U,A,N);else{o._pendingPullIntos.length>0&&dn(o);let V=new Uint8Array(U,A,N);R(c,V,!1)}else ga(c)?($o(o,U,A,N),ha(o)):$o(o,U,A,N);Hr(o)}function Et(o,i){let c=o._controlledReadableByteStream;c._state==="readable"&&(Fl(o),Ar(o),Ho(o),pf(c,i))}function jl(o,i){let c=o._queue.shift();o._queueTotalSize-=c.byteLength,Nl(o);let m=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);i._chunkSteps(m)}function pa(o){if(o._byobRequest===null&&o._pendingPullIntos.length>0){let i=o._pendingPullIntos.peek(),c=new Uint8Array(i.buffer,i.byteOffset+i.bytesFilled,i.byteLength-i.bytesFilled),m=Object.create(Mr.prototype);kg(m,o,c),o._byobRequest=m}return o._byobRequest}function Ll(o){let i=o._controlledReadableByteStream._state;return i==="errored"?null:i==="closed"?0:o._strategyHWM-o._queueTotalSize}function Wo(o,i){let c=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(i!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(i===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(c.bytesFilled+i>c.byteLength)throw new RangeError("bytesWritten out of range")}c.buffer=sr(c.buffer),ql(o,i)}function zo(o,i){let c=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(i.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(i.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(c.byteOffset+c.bytesFilled!==i.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(c.bufferByteLength!==i.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(c.bytesFilled+i.byteLength>c.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let A=i.byteLength;c.buffer=sr(i.buffer),ql(o,A)}function Ul(o,i,c,m,A,N,U){i._controlledReadableByteStream=o,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,Ar(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=N,i._pullAlgorithm=m,i._cancelAlgorithm=A,i._autoAllocateChunkSize=U,i._pendingPullIntos=new P,o._readableStreamController=i;let V=c();w(d(V),()=>(i._started=!0,Hr(i),null),ie=>(Et(i,ie),null))}function Rg(o,i,c){let m=Object.create(ir.prototype),A,N,U;i.start!==void 0?A=()=>i.start(m):A=()=>{},i.pull!==void 0?N=()=>i.pull(m):N=()=>d(void 0),i.cancel!==void 0?U=ie=>i.cancel(ie):U=()=>d(void 0);let V=i.autoAllocateChunkSize;if(V===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Ul(o,m,A,N,U,c,V)}function kg(o,i,c){o._associatedReadableByteStreamController=i,o._view=c}function ma(o){return new TypeError(`ReadableStreamBYOBRequest.prototype.${o} can only be used on a ReadableStreamBYOBRequest`)}function Qn(o){return new TypeError(`ReadableByteStreamController.prototype.${o} can only be used on a ReadableByteStreamController`)}function Fg(o,i){ge(o,i);let c=o?.mode;return{mode:c===void 0?void 0:Og(c,`${i} has member 'mode' that`)}}function Og(o,i){if(o=`${o}`,o!=="byob")throw new TypeError(`${i} '${o}' is not a valid enumeration value for ReadableStreamReaderMode`);return o}function Pg(o,i){var c;ge(o,i);let m=(c=o?.min)!==null&&c!==void 0?c:1;return{min:v(m,`${i} has member 'min' that`)}}function Ml(o){return new Dr(o)}function $l(o,i){o._reader._readIntoRequests.push(i)}function xg(o,i,c){let A=o._reader._readIntoRequests.shift();c?A._closeSteps(i):A._chunkSteps(i)}function Hl(o){return o._reader._readIntoRequests.length}function ga(o){let i=o._reader;return!(i===void 0||!Gr(i))}class Dr{constructor(i){if(Ie(i,1,"ReadableStreamBYOBReader"),k(i,"First parameter"),Tr(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!$r(i._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");de(this,i),this._readIntoRequests=new P}get closed(){return Gr(this)?this._closedPromise:h(Jo("closed"))}cancel(i=void 0){return Gr(this)?this._ownerReadableStream===void 0?h(Q("cancel")):oe(this,i):h(Jo("cancel"))}read(i,c={}){if(!Gr(this))return h(Jo("read"));if(!ArrayBuffer.isView(i))return h(new TypeError("view must be an array buffer view"));if(i.byteLength===0)return h(new TypeError("view must have non-zero byteLength"));if(i.buffer.byteLength===0)return h(new TypeError("view's buffer must have non-zero byteLength"));if(wr(i.buffer))return h(new TypeError("view's buffer has been detached"));let m;try{m=Pg(c,"options")}catch(ee){return h(ee)}let A=m.min;if(A===0)return h(new TypeError("options.min must be greater than 0"));if(Eg(i)){if(A>i.byteLength)return h(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(A>i.length)return h(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return h(Q("read from"));let N,U,V=f((ee,le)=>{N=ee,U=le});return Gl(this,i,A,{_chunkSteps:ee=>N({value:ee,done:!1}),_closeSteps:ee=>N({value:ee,done:!0}),_errorSteps:ee=>U(ee)}),V}releaseLock(){if(!Gr(this))throw Jo("releaseLock");this._ownerReadableStream!==void 0&&Bg(this)}}Object.defineProperties(Dr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(Dr.prototype.cancel,"cancel"),s(Dr.prototype.read,"read"),s(Dr.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Dr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Gr(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readIntoRequests")?!1:o instanceof Dr}function Gl(o,i,c,m){let A=o._ownerReadableStream;A._disturbed=!0,A._state==="errored"?m._errorSteps(A._storedError):Dg(A._readableStreamController,i,c,m)}function Bg(o){ae(o);let i=new TypeError("Reader was released");Wl(o,i)}function Wl(o,i){let c=o._readIntoRequests;o._readIntoRequests=new P,c.forEach(m=>{m._errorSteps(i)})}function Jo(o){return new TypeError(`ReadableStreamBYOBReader.prototype.${o} can only be used on a ReadableStreamBYOBReader`)}function Zn(o,i){let{highWaterMark:c}=o;if(c===void 0)return i;if(ut(c)||c<0)throw new RangeError("Invalid highWaterMark");return c}function Vo(o){let{size:i}=o;return i||(()=>1)}function Ko(o,i){ge(o,i);let c=o?.highWaterMark,m=o?.size;return{highWaterMark:c===void 0?void 0:g(c),size:m===void 0?void 0:Ig(m,`${i} has member 'size' that`)}}function Ig(o,i){return we(o,i),c=>g(o(c))}function Ng(o,i){ge(o,i);let c=o?.abort,m=o?.close,A=o?.start,N=o?.type,U=o?.write;return{abort:c===void 0?void 0:qg(c,o,`${i} has member 'abort' that`),close:m===void 0?void 0:jg(m,o,`${i} has member 'close' that`),start:A===void 0?void 0:Lg(A,o,`${i} has member 'start' that`),write:U===void 0?void 0:Ug(U,o,`${i} has member 'write' that`),type:N}}function qg(o,i,c){return we(o,c),m=>F(o,i,[m])}function jg(o,i,c){return we(o,c),()=>F(o,i,[])}function Lg(o,i,c){return we(o,c),m=>T(o,i,[m])}function Ug(o,i,c){return we(o,c),(m,A)=>F(o,i,[m,A])}function zl(o,i){if(!hn(o))throw new TypeError(`${i} is not a WritableStream.`)}function Mg(o){if(typeof o!="object"||o===null)return!1;try{return typeof o.aborted=="boolean"}catch{return!1}}let $g=typeof AbortController=="function";function Hg(){if($g)return new AbortController}class Sr{constructor(i={},c={}){i===void 0?i=null:xe(i,"First parameter");let m=Ko(c,"Second parameter"),A=Ng(i,"First parameter");if(Vl(this),A.type!==void 0)throw new RangeError("Invalid type is specified");let U=Vo(m),V=Zn(m,1);ny(this,A,V,U)}get locked(){if(!hn(this))throw es("locked");return pn(this)}abort(i=void 0){return hn(this)?pn(this)?h(new TypeError("Cannot abort a stream that already has a writer")):Yo(this,i):h(es("abort"))}close(){return hn(this)?pn(this)?h(new TypeError("Cannot close a stream that already has a writer")):zt(this)?h(new TypeError("Cannot close an already-closing stream")):Kl(this):h(es("close"))}getWriter(){if(!hn(this))throw es("getWriter");return Jl(this)}}Object.defineProperties(Sr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),s(Sr.prototype.abort,"abort"),s(Sr.prototype.close,"close"),s(Sr.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Sr.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Jl(o){return new ar(o)}function Gg(o,i,c,m,A=1,N=()=>1){let U=Object.create(Sr.prototype);Vl(U);let V=Object.create(mn.prototype);return tf(U,V,o,i,c,m,A,N),U}function Vl(o){o._state="writable",o._storedError=void 0,o._writer=void 0,o._writableStreamController=void 0,o._writeRequests=new P,o._inFlightWriteRequest=void 0,o._closeRequest=void 0,o._inFlightCloseRequest=void 0,o._pendingAbortRequest=void 0,o._backpressure=!1}function hn(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_writableStreamController")?!1:o instanceof Sr}function pn(o){return o._writer!==void 0}function Yo(o,i){var c;if(o._state==="closed"||o._state==="errored")return d(void 0);o._writableStreamController._abortReason=i,(c=o._writableStreamController._abortController)===null||c===void 0||c.abort(i);let m=o._state;if(m==="closed"||m==="errored")return d(void 0);if(o._pendingAbortRequest!==void 0)return o._pendingAbortRequest._promise;let A=!1;m==="erroring"&&(A=!0,i=void 0);let N=f((U,V)=>{o._pendingAbortRequest={_promise:void 0,_resolve:U,_reject:V,_reason:i,_wasAlreadyErroring:A}});return o._pendingAbortRequest._promise=N,A||_a(o,i),N}function Kl(o){let i=o._state;if(i==="closed"||i==="errored")return h(new TypeError(`The stream (in ${i} state) is not in the writable state and cannot be closed`));let c=f((A,N)=>{let U={_resolve:A,_reject:N};o._closeRequest=U}),m=o._writer;return m!==void 0&&o._backpressure&&i==="writable"&&va(m),oy(o._writableStreamController),c}function Wg(o){return f((c,m)=>{let A={_resolve:c,_reject:m};o._writeRequests.push(A)})}function ya(o,i){if(o._state==="writable"){_a(o,i);return}Ca(o)}function _a(o,i){let c=o._writableStreamController;o._state="erroring",o._storedError=i;let m=o._writer;m!==void 0&&Xl(m,i),!Yg(o)&&c._started&&Ca(o)}function Ca(o){o._state="errored",o._writableStreamController[G]();let i=o._storedError;if(o._writeRequests.forEach(A=>{A._reject(i)}),o._writeRequests=new P,o._pendingAbortRequest===void 0){Xo(o);return}let c=o._pendingAbortRequest;if(o._pendingAbortRequest=void 0,c._wasAlreadyErroring){c._reject(i),Xo(o);return}let m=o._writableStreamController[j](c._reason);w(m,()=>(c._resolve(),Xo(o),null),A=>(c._reject(A),Xo(o),null))}function zg(o){o._inFlightWriteRequest._resolve(void 0),o._inFlightWriteRequest=void 0}function Jg(o,i){o._inFlightWriteRequest._reject(i),o._inFlightWriteRequest=void 0,ya(o,i)}function Vg(o){o._inFlightCloseRequest._resolve(void 0),o._inFlightCloseRequest=void 0,o._state==="erroring"&&(o._storedError=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._resolve(),o._pendingAbortRequest=void 0)),o._state="closed";let c=o._writer;c!==void 0&&sf(c)}function Kg(o,i){o._inFlightCloseRequest._reject(i),o._inFlightCloseRequest=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._reject(i),o._pendingAbortRequest=void 0),ya(o,i)}function zt(o){return!(o._closeRequest===void 0&&o._inFlightCloseRequest===void 0)}function Yg(o){return!(o._inFlightWriteRequest===void 0&&o._inFlightCloseRequest===void 0)}function Xg(o){o._inFlightCloseRequest=o._closeRequest,o._closeRequest=void 0}function Qg(o){o._inFlightWriteRequest=o._writeRequests.shift()}function Xo(o){o._closeRequest!==void 0&&(o._closeRequest._reject(o._storedError),o._closeRequest=void 0);let i=o._writer;i!==void 0&&Da(i,o._storedError)}function ba(o,i){let c=o._writer;c!==void 0&&i!==o._backpressure&&(i?fy(c):va(c)),o._backpressure=i}class ar{constructor(i){if(Ie(i,1,"WritableStreamDefaultWriter"),zl(i,"First parameter"),pn(i))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=i,i._writer=this;let c=i._state;if(c==="writable")!zt(i)&&i._backpressure?rs(this):af(this),ts(this);else if(c==="erroring")Sa(this,i._storedError),ts(this);else if(c==="closed")af(this),cy(this);else{let m=i._storedError;Sa(this,m),of(this,m)}}get closed(){return Wr(this)?this._closedPromise:h(zr("closed"))}get desiredSize(){if(!Wr(this))throw zr("desiredSize");if(this._ownerWritableStream===void 0)throw to("desiredSize");return ry(this)}get ready(){return Wr(this)?this._readyPromise:h(zr("ready"))}abort(i=void 0){return Wr(this)?this._ownerWritableStream===void 0?h(to("abort")):Zg(this,i):h(zr("abort"))}close(){if(!Wr(this))return h(zr("close"));let i=this._ownerWritableStream;return i===void 0?h(to("close")):zt(i)?h(new TypeError("Cannot close an already-closing stream")):Yl(this)}releaseLock(){if(!Wr(this))throw zr("releaseLock");this._ownerWritableStream!==void 0&&Ql(this)}write(i=void 0){return Wr(this)?this._ownerWritableStream===void 0?h(to("write to")):Zl(this,i):h(zr("write"))}}Object.defineProperties(ar.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),s(ar.prototype.abort,"abort"),s(ar.prototype.close,"close"),s(ar.prototype.releaseLock,"releaseLock"),s(ar.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ar.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Wr(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_ownerWritableStream")?!1:o instanceof ar}function Zg(o,i){let c=o._ownerWritableStream;return Yo(c,i)}function Yl(o){let i=o._ownerWritableStream;return Kl(i)}function ey(o){let i=o._ownerWritableStream,c=i._state;return zt(i)||c==="closed"?d(void 0):c==="errored"?h(i._storedError):Yl(o)}function ty(o,i){o._closedPromiseState==="pending"?Da(o,i):ly(o,i)}function Xl(o,i){o._readyPromiseState==="pending"?uf(o,i):dy(o,i)}function ry(o){let i=o._ownerWritableStream,c=i._state;return c==="errored"||c==="erroring"?null:c==="closed"?0:rf(i._writableStreamController)}function Ql(o){let i=o._ownerWritableStream,c=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Xl(o,c),ty(o,c),i._writer=void 0,o._ownerWritableStream=void 0}function Zl(o,i){let c=o._ownerWritableStream,m=c._writableStreamController,A=sy(m,i);if(c!==o._ownerWritableStream)return h(to("write to"));let N=c._state;if(N==="errored")return h(c._storedError);if(zt(c)||N==="closed")return h(new TypeError("The stream is closing or closed and cannot be written to"));if(N==="erroring")return h(c._storedError);let U=Wg(c);return iy(m,i,A),U}let ef={};class mn{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Ea(this))throw Aa("abortReason");return this._abortReason}get signal(){if(!Ea(this))throw Aa("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(i=void 0){if(!Ea(this))throw Aa("error");this._controlledWritableStream._state==="writable"&&nf(this,i)}[j](i){let c=this._abortAlgorithm(i);return Qo(this),c}[G](){Ar(this)}}Object.defineProperties(mn.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(mn.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Ea(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledWritableStream")?!1:o instanceof mn}function tf(o,i,c,m,A,N,U,V){i._controlledWritableStream=o,o._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,Ar(i),i._abortReason=void 0,i._abortController=Hg(),i._started=!1,i._strategySizeAlgorithm=V,i._strategyHWM=U,i._writeAlgorithm=m,i._closeAlgorithm=A,i._abortAlgorithm=N;let ie=wa(i);ba(o,ie);let ee=c(),le=d(ee);w(le,()=>(i._started=!0,Zo(i),null),me=>(i._started=!0,ya(o,me),null))}function ny(o,i,c,m){let A=Object.create(mn.prototype),N,U,V,ie;i.start!==void 0?N=()=>i.start(A):N=()=>{},i.write!==void 0?U=ee=>i.write(ee,A):U=()=>d(void 0),i.close!==void 0?V=()=>i.close():V=()=>d(void 0),i.abort!==void 0?ie=ee=>i.abort(ee):ie=()=>d(void 0),tf(o,A,N,U,V,ie,c,m)}function Qo(o){o._writeAlgorithm=void 0,o._closeAlgorithm=void 0,o._abortAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function oy(o){ca(o,ef,0),Zo(o)}function sy(o,i){try{return o._strategySizeAlgorithm(i)}catch(c){return eo(o,c),1}}function rf(o){return o._strategyHWM-o._queueTotalSize}function iy(o,i,c){try{ca(o,i,c)}catch(A){eo(o,A);return}let m=o._controlledWritableStream;if(!zt(m)&&m._state==="writable"){let A=wa(o);ba(m,A)}Zo(o)}function Zo(o){let i=o._controlledWritableStream;if(!o._started||i._inFlightWriteRequest!==void 0)return;if(i._state==="erroring"){Ca(i);return}if(o._queue.length===0)return;let m=bg(o);m===ef?ay(o):uy(o,m)}function eo(o,i){o._controlledWritableStream._state==="writable"&&nf(o,i)}function ay(o){let i=o._controlledWritableStream;Xg(i),ua(o);let c=o._closeAlgorithm();Qo(o),w(c,()=>(Vg(i),null),m=>(Kg(i,m),null))}function uy(o,i){let c=o._controlledWritableStream;Qg(c);let m=o._writeAlgorithm(i);w(m,()=>{zg(c);let A=c._state;if(ua(o),!zt(c)&&A==="writable"){let N=wa(o);ba(c,N)}return Zo(o),null},A=>(c._state==="writable"&&Qo(o),Jg(c,A),null))}function wa(o){return rf(o)<=0}function nf(o,i){let c=o._controlledWritableStream;Qo(o),_a(c,i)}function es(o){return new TypeError(`WritableStream.prototype.${o} can only be used on a WritableStream`)}function Aa(o){return new TypeError(`WritableStreamDefaultController.prototype.${o} can only be used on a WritableStreamDefaultController`)}function zr(o){return new TypeError(`WritableStreamDefaultWriter.prototype.${o} can only be used on a WritableStreamDefaultWriter`)}function to(o){return new TypeError("Cannot "+o+" a stream using a released writer")}function ts(o){o._closedPromise=f((i,c)=>{o._closedPromise_resolve=i,o._closedPromise_reject=c,o._closedPromiseState="pending"})}function of(o,i){ts(o),Da(o,i)}function cy(o){ts(o),sf(o)}function Da(o,i){o._closedPromise_reject!==void 0&&(_(o._closedPromise),o._closedPromise_reject(i),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="rejected")}function ly(o,i){of(o,i)}function sf(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="resolved")}function rs(o){o._readyPromise=f((i,c)=>{o._readyPromise_resolve=i,o._readyPromise_reject=c}),o._readyPromiseState="pending"}function Sa(o,i){rs(o),uf(o,i)}function af(o){rs(o),va(o)}function uf(o,i){o._readyPromise_reject!==void 0&&(_(o._readyPromise),o._readyPromise_reject(i),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="rejected")}function fy(o){rs(o)}function dy(o,i){Sa(o,i)}function va(o){o._readyPromise_resolve!==void 0&&(o._readyPromise_resolve(void 0),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="fulfilled")}function hy(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Ta=hy();function py(o){if(!(typeof o=="function"||typeof o=="object")||o.name!=="DOMException")return!1;try{return new o,!0}catch{return!1}}function my(){let o=Ta?.DOMException;return py(o)?o:void 0}function gy(){let o=function(c,m){this.message=c||"",this.name=m||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return s(o,"DOMException"),o.prototype=Object.create(Error.prototype),Object.defineProperty(o.prototype,"constructor",{value:o,writable:!0,configurable:!0}),o}let yy=my()||gy();function cf(o,i,c,m,A,N){let U=q(o),V=Jl(i);o._disturbed=!0;let ie=!1,ee=d(void 0);return f((le,me)=>{let Te;if(N!==void 0){if(Te=()=>{let ne=N.reason!==void 0?N.reason:new yy("Aborted","AbortError"),ye=[];m||ye.push(()=>i._state==="writable"?Yo(i,ne):d(void 0)),A||ye.push(()=>o._state==="readable"?xt(o,ne):d(void 0)),nt(()=>Promise.all(ye.map(Re=>Re())),!0,ne)},N.aborted){Te();return}N.addEventListener("abort",Te)}function Bt(){return f((ne,ye)=>{function Re(ct){ct?ne():C(Cn(),Re,ye)}Re(!1)})}function Cn(){return ie?d(!0):C(V._readyPromise,()=>f((ne,ye)=>{X(U,{_chunkSteps:Re=>{ee=C(Zl(V,Re),void 0,e),ne(!1)},_closeSteps:()=>ne(!0),_errorSteps:ye})}))}if(cr(o,U._closedPromise,ne=>(m?wt(!0,ne):nt(()=>Yo(i,ne),!0,ne),null)),cr(i,V._closedPromise,ne=>(A?wt(!0,ne):nt(()=>xt(o,ne),!0,ne),null)),Ze(o,U._closedPromise,()=>(c?wt():nt(()=>ey(V)),null)),zt(i)||i._state==="closed"){let ne=new TypeError("the destination writable stream closed before all data could be piped to it");A?wt(!0,ne):nt(()=>xt(o,ne),!0,ne)}_(Bt());function kr(){let ne=ee;return C(ee,()=>ne!==ee?kr():void 0)}function cr(ne,ye,Re){ne._state==="errored"?Re(ne._storedError):S(ye,Re)}function Ze(ne,ye,Re){ne._state==="closed"?Re():I(ye,Re)}function nt(ne,ye,Re){if(ie)return;ie=!0,i._state==="writable"&&!zt(i)?I(kr(),ct):ct();function ct(){return w(ne(),()=>lr(ye,Re),bn=>lr(!0,bn)),null}}function wt(ne,ye){ie||(ie=!0,i._state==="writable"&&!zt(i)?I(kr(),()=>lr(ne,ye)):lr(ne,ye))}function lr(ne,ye){return Ql(V),ae(U),N!==void 0&&N.removeEventListener("abort",Te),ne?me(ye):le(void 0),null}})}class ur{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!ns(this))throw ss("desiredSize");return Ra(this)}close(){if(!ns(this))throw ss("close");if(!yn(this))throw new TypeError("The stream is not in a state that permits close");Jr(this)}enqueue(i=void 0){if(!ns(this))throw ss("enqueue");if(!yn(this))throw new TypeError("The stream is not in a state that permits enqueue");return gn(this,i)}error(i=void 0){if(!ns(this))throw ss("error");Pt(this,i)}[te](i){Ar(this);let c=this._cancelAlgorithm(i);return os(this),c}[W](i){let c=this._controlledReadableStream;if(this._queue.length>0){let m=ua(this);this._closeRequested&&this._queue.length===0?(os(this),oo(c)):ro(this),i._chunkSteps(m)}else D(c,i),ro(this)}[be](){}}Object.defineProperties(ur.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),s(ur.prototype.close,"close"),s(ur.prototype.enqueue,"enqueue"),s(ur.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ur.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function ns(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableStream")?!1:o instanceof ur}function ro(o){if(!lf(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;let c=o._pullAlgorithm();w(c,()=>(o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,ro(o)),null),m=>(Pt(o,m),null))}function lf(o){let i=o._controlledReadableStream;return!yn(o)||!o._started?!1:!!(Tr(i)&&B(i)>0||Ra(o)>0)}function os(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function Jr(o){if(!yn(o))return;let i=o._controlledReadableStream;o._closeRequested=!0,o._queue.length===0&&(os(o),oo(i))}function gn(o,i){if(!yn(o))return;let c=o._controlledReadableStream;if(Tr(c)&&B(c)>0)R(c,i,!1);else{let m;try{m=o._strategySizeAlgorithm(i)}catch(A){throw Pt(o,A),A}try{ca(o,i,m)}catch(A){throw Pt(o,A),A}}ro(o)}function Pt(o,i){let c=o._controlledReadableStream;c._state==="readable"&&(Ar(o),os(o),pf(c,i))}function Ra(o){let i=o._controlledReadableStream._state;return i==="errored"?null:i==="closed"?0:o._strategyHWM-o._queueTotalSize}function _y(o){return!lf(o)}function yn(o){let i=o._controlledReadableStream._state;return!o._closeRequested&&i==="readable"}function ff(o,i,c,m,A,N,U){i._controlledReadableStream=o,i._queue=void 0,i._queueTotalSize=void 0,Ar(i),i._started=!1,i._closeRequested=!1,i._pullAgain=!1,i._pulling=!1,i._strategySizeAlgorithm=U,i._strategyHWM=N,i._pullAlgorithm=m,i._cancelAlgorithm=A,o._readableStreamController=i;let V=c();w(d(V),()=>(i._started=!0,ro(i),null),ie=>(Pt(i,ie),null))}function Cy(o,i,c,m){let A=Object.create(ur.prototype),N,U,V;i.start!==void 0?N=()=>i.start(A):N=()=>{},i.pull!==void 0?U=()=>i.pull(A):U=()=>d(void 0),i.cancel!==void 0?V=ie=>i.cancel(ie):V=()=>d(void 0),ff(o,A,N,U,V,c,m)}function ss(o){return new TypeError(`ReadableStreamDefaultController.prototype.${o} can only be used on a ReadableStreamDefaultController`)}function by(o,i){return $r(o._readableStreamController)?wy(o):Ey(o)}function Ey(o,i){let c=q(o),m=!1,A=!1,N=!1,U=!1,V,ie,ee,le,me,Te=f(Ze=>{me=Ze});function Bt(){return m?(A=!0,d(void 0)):(m=!0,X(c,{_chunkSteps:nt=>{y(()=>{A=!1;let wt=nt,lr=nt;N||gn(ee._readableStreamController,wt),U||gn(le._readableStreamController,lr),m=!1,A&&Bt()})},_closeSteps:()=>{m=!1,N||Jr(ee._readableStreamController),U||Jr(le._readableStreamController),(!N||!U)&&me(void 0)},_errorSteps:()=>{m=!1}}),d(void 0))}function Cn(Ze){if(N=!0,V=Ze,U){let nt=De([V,ie]),wt=xt(o,nt);me(wt)}return Te}function kr(Ze){if(U=!0,ie=Ze,N){let nt=De([V,ie]),wt=xt(o,nt);me(wt)}return Te}function cr(){}return ee=no(cr,Bt,Cn),le=no(cr,Bt,kr),S(c._closedPromise,Ze=>(Pt(ee._readableStreamController,Ze),Pt(le._readableStreamController,Ze),(!N||!U)&&me(void 0),null)),[ee,le]}function wy(o){let i=q(o),c=!1,m=!1,A=!1,N=!1,U=!1,V,ie,ee,le,me,Te=f(ne=>{me=ne});function Bt(ne){S(ne._closedPromise,ye=>(ne!==i||(Et(ee._readableStreamController,ye),Et(le._readableStreamController,ye),(!N||!U)&&me(void 0)),null))}function Cn(){Gr(i)&&(ae(i),i=q(o),Bt(i)),X(i,{_chunkSteps:ye=>{y(()=>{m=!1,A=!1;let Re=ye,ct=ye;if(!N&&!U)try{ct=Rl(ye)}catch(bn){Et(ee._readableStreamController,bn),Et(le._readableStreamController,bn),me(xt(o,bn));return}N||Go(ee._readableStreamController,Re),U||Go(le._readableStreamController,ct),c=!1,m?cr():A&&Ze()})},_closeSteps:()=>{c=!1,N||Xn(ee._readableStreamController),U||Xn(le._readableStreamController),ee._readableStreamController._pendingPullIntos.length>0&&Wo(ee._readableStreamController,0),le._readableStreamController._pendingPullIntos.length>0&&Wo(le._readableStreamController,0),(!N||!U)&&me(void 0)},_errorSteps:()=>{c=!1}})}function kr(ne,ye){K(i)&&(ae(i),i=Ml(o),Bt(i));let Re=ye?le:ee,ct=ye?ee:le;Gl(i,ne,1,{_chunkSteps:En=>{y(()=>{m=!1,A=!1;let wn=ye?U:N;if(ye?N:U)wn||zo(Re._readableStreamController,En);else{let Tf;try{Tf=Rl(En)}catch(xa){Et(Re._readableStreamController,xa),Et(ct._readableStreamController,xa),me(xt(o,xa));return}wn||zo(Re._readableStreamController,En),Go(ct._readableStreamController,Tf)}c=!1,m?cr():A&&Ze()})},_closeSteps:En=>{c=!1;let wn=ye?U:N,hs=ye?N:U;wn||Xn(Re._readableStreamController),hs||Xn(ct._readableStreamController),En!==void 0&&(wn||zo(Re._readableStreamController,En),!hs&&ct._readableStreamController._pendingPullIntos.length>0&&Wo(ct._readableStreamController,0)),(!wn||!hs)&&me(void 0)},_errorSteps:()=>{c=!1}})}function cr(){if(c)return m=!0,d(void 0);c=!0;let ne=pa(ee._readableStreamController);return ne===null?Cn():kr(ne._view,!1),d(void 0)}function Ze(){if(c)return A=!0,d(void 0);c=!0;let ne=pa(le._readableStreamController);return ne===null?Cn():kr(ne._view,!0),d(void 0)}function nt(ne){if(N=!0,V=ne,U){let ye=De([V,ie]),Re=xt(o,ye);me(Re)}return Te}function wt(ne){if(U=!0,ie=ne,N){let ye=De([V,ie]),Re=xt(o,ye);me(Re)}return Te}function lr(){}return ee=hf(lr,cr,nt),le=hf(lr,Ze,wt),Bt(i),[ee,le]}function Ay(o){return t(o)&&typeof o.getReader<"u"}function Dy(o){return Ay(o)?vy(o.getReader()):Sy(o)}function Sy(o){let i,c=Tl(o,"async"),m=e;function A(){let U;try{U=gg(c)}catch(ie){return h(ie)}let V=d(U);return b(V,ie=>{if(!t(ie))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(yg(ie))Jr(i._readableStreamController);else{let le=_g(ie);gn(i._readableStreamController,le)}})}function N(U){let V=c.iterator,ie;try{ie=Mo(V,"return")}catch(me){return h(me)}if(ie===void 0)return d(void 0);let ee;try{ee=T(ie,V,[U])}catch(me){return h(me)}let le=d(ee);return b(le,me=>{if(!t(me))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return i=no(m,A,N,0),i}function vy(o){let i,c=e;function m(){let N;try{N=o.read()}catch(U){return h(U)}return b(N,U=>{if(!t(U))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(U.done)Jr(i._readableStreamController);else{let V=U.value;gn(i._readableStreamController,V)}})}function A(N){try{return d(o.cancel(N))}catch(U){return h(U)}}return i=no(c,m,A,0),i}function Ty(o,i){ge(o,i);let c=o,m=c?.autoAllocateChunkSize,A=c?.cancel,N=c?.pull,U=c?.start,V=c?.type;return{autoAllocateChunkSize:m===void 0?void 0:v(m,`${i} has member 'autoAllocateChunkSize' that`),cancel:A===void 0?void 0:Ry(A,c,`${i} has member 'cancel' that`),pull:N===void 0?void 0:ky(N,c,`${i} has member 'pull' that`),start:U===void 0?void 0:Fy(U,c,`${i} has member 'start' that`),type:V===void 0?void 0:Oy(V,`${i} has member 'type' that`)}}function Ry(o,i,c){return we(o,c),m=>F(o,i,[m])}function ky(o,i,c){return we(o,c),m=>F(o,i,[m])}function Fy(o,i,c){return we(o,c),m=>T(o,i,[m])}function Oy(o,i){if(o=`${o}`,o!=="bytes")throw new TypeError(`${i} '${o}' is not a valid enumeration value for ReadableStreamType`);return o}function Py(o,i){return ge(o,i),{preventCancel:!!o?.preventCancel}}function df(o,i){ge(o,i);let c=o?.preventAbort,m=o?.preventCancel,A=o?.preventClose,N=o?.signal;return N!==void 0&&xy(N,`${i} has member 'signal' that`),{preventAbort:!!c,preventCancel:!!m,preventClose:!!A,signal:N}}function xy(o,i){if(!Mg(o))throw new TypeError(`${i} is not an AbortSignal.`)}function By(o,i){ge(o,i);let c=o?.readable;p(c,"readable","ReadableWritablePair"),k(c,`${i} has member 'readable' that`);let m=o?.writable;return p(m,"writable","ReadableWritablePair"),zl(m,`${i} has member 'writable' that`),{readable:c,writable:m}}class Ye{constructor(i={},c={}){i===void 0?i=null:xe(i,"First parameter");let m=Ko(c,"Second parameter"),A=Ty(i,"First parameter");if(ka(this),A.type==="bytes"){if(m.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let N=Zn(m,0);Rg(this,A,N)}else{let N=Vo(m),U=Zn(m,1);Cy(this,A,U,N)}}get locked(){if(!vr(this))throw Vr("locked");return Tr(this)}cancel(i=void 0){return vr(this)?Tr(this)?h(new TypeError("Cannot cancel a stream that already has a reader")):xt(this,i):h(Vr("cancel"))}getReader(i=void 0){if(!vr(this))throw Vr("getReader");return Fg(i,"First parameter").mode===void 0?q(this):Ml(this)}pipeThrough(i,c={}){if(!vr(this))throw Vr("pipeThrough");Ie(i,1,"pipeThrough");let m=By(i,"First parameter"),A=df(c,"Second parameter");if(Tr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(pn(m.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let N=cf(this,m.writable,A.preventClose,A.preventAbort,A.preventCancel,A.signal);return _(N),m.readable}pipeTo(i,c={}){if(!vr(this))return h(Vr("pipeTo"));if(i===void 0)return h("Parameter 1 is required in 'pipeTo'.");if(!hn(i))return h(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let m;try{m=df(c,"Second parameter")}catch(A){return h(A)}return Tr(this)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):pn(i)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):cf(this,i,m.preventClose,m.preventAbort,m.preventCancel,m.signal)}tee(){if(!vr(this))throw Vr("tee");let i=by(this);return De(i)}values(i=void 0){if(!vr(this))throw Vr("values");let c=Py(i,"First parameter");return cn(this,c.preventCancel)}[aa](i){return this.values(i)}static from(i){return Dy(i)}}Object.defineProperties(Ye,{from:{enumerable:!0}}),Object.defineProperties(Ye.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),s(Ye.from,"from"),s(Ye.prototype.cancel,"cancel"),s(Ye.prototype.getReader,"getReader"),s(Ye.prototype.pipeThrough,"pipeThrough"),s(Ye.prototype.pipeTo,"pipeTo"),s(Ye.prototype.tee,"tee"),s(Ye.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ye.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(Ye.prototype,aa,{value:Ye.prototype.values,writable:!0,configurable:!0});function no(o,i,c,m=1,A=()=>1){let N=Object.create(Ye.prototype);ka(N);let U=Object.create(ur.prototype);return ff(N,U,o,i,c,m,A),N}function hf(o,i,c){let m=Object.create(Ye.prototype);ka(m);let A=Object.create(ir.prototype);return Ul(m,A,o,i,c,0,void 0),m}function ka(o){o._state="readable",o._reader=void 0,o._storedError=void 0,o._disturbed=!1}function vr(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readableStreamController")?!1:o instanceof Ye}function Tr(o){return o._reader!==void 0}function xt(o,i){if(o._disturbed=!0,o._state==="closed")return d(void 0);if(o._state==="errored")return h(o._storedError);oo(o);let c=o._reader;if(c!==void 0&&Gr(c)){let A=c._readIntoRequests;c._readIntoRequests=new P,A.forEach(N=>{N._closeSteps(void 0)})}let m=o._readableStreamController[te](i);return b(m,e)}function oo(o){o._state="closed";let i=o._reader;if(i!==void 0&&(ce(i),K(i))){let c=i._readRequests;i._readRequests=new P,c.forEach(m=>{m._closeSteps()})}}function pf(o,i){o._state="errored",o._storedError=i;let c=o._reader;c!==void 0&&(J(c,i),K(c)?Fe(c,i):Wl(c,i))}function Vr(o){return new TypeError(`ReadableStream.prototype.${o} can only be used on a ReadableStream`)}function mf(o,i){ge(o,i);let c=o?.highWaterMark;return p(c,"highWaterMark","QueuingStrategyInit"),{highWaterMark:g(c)}}let gf=o=>o.byteLength;s(gf,"size");class is{constructor(i){Ie(i,1,"ByteLengthQueuingStrategy"),i=mf(i,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!_f(this))throw yf("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!_f(this))throw yf("size");return gf}}Object.defineProperties(is.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(is.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function yf(o){return new TypeError(`ByteLengthQueuingStrategy.prototype.${o} can only be used on a ByteLengthQueuingStrategy`)}function _f(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_byteLengthQueuingStrategyHighWaterMark")?!1:o instanceof is}let Cf=()=>1;s(Cf,"size");class as{constructor(i){Ie(i,1,"CountQueuingStrategy"),i=mf(i,"First parameter"),this._countQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!Ef(this))throw bf("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Ef(this))throw bf("size");return Cf}}Object.defineProperties(as.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(as.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function bf(o){return new TypeError(`CountQueuingStrategy.prototype.${o} can only be used on a CountQueuingStrategy`)}function Ef(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_countQueuingStrategyHighWaterMark")?!1:o instanceof as}function Iy(o,i){ge(o,i);let c=o?.cancel,m=o?.flush,A=o?.readableType,N=o?.start,U=o?.transform,V=o?.writableType;return{cancel:c===void 0?void 0:Ly(c,o,`${i} has member 'cancel' that`),flush:m===void 0?void 0:Ny(m,o,`${i} has member 'flush' that`),readableType:A,start:N===void 0?void 0:qy(N,o,`${i} has member 'start' that`),transform:U===void 0?void 0:jy(U,o,`${i} has member 'transform' that`),writableType:V}}function Ny(o,i,c){return we(o,c),m=>F(o,i,[m])}function qy(o,i,c){return we(o,c),m=>T(o,i,[m])}function jy(o,i,c){return we(o,c),(m,A)=>F(o,i,[m,A])}function Ly(o,i,c){return we(o,c),m=>F(o,i,[m])}class us{constructor(i={},c={},m={}){i===void 0&&(i=null);let A=Ko(c,"Second parameter"),N=Ko(m,"Third parameter"),U=Iy(i,"First parameter");if(U.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(U.writableType!==void 0)throw new RangeError("Invalid writableType specified");let V=Zn(N,0),ie=Vo(N),ee=Zn(A,1),le=Vo(A),me,Te=f(Bt=>{me=Bt});Uy(this,Te,ee,le,V,ie),$y(this,U),U.start!==void 0?me(U.start(this._transformStreamController)):me(void 0)}get readable(){if(!wf(this))throw vf("readable");return this._readable}get writable(){if(!wf(this))throw vf("writable");return this._writable}}Object.defineProperties(us.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(us.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function Uy(o,i,c,m,A,N){function U(){return i}function V(Te){return Wy(o,Te)}function ie(Te){return zy(o,Te)}function ee(){return Jy(o)}o._writable=Gg(U,V,ee,ie,c,m);function le(){return Vy(o)}function me(Te){return Ky(o,Te)}o._readable=no(U,le,me,A,N),o._backpressure=void 0,o._backpressureChangePromise=void 0,o._backpressureChangePromise_resolve=void 0,cs(o,!0),o._transformStreamController=void 0}function wf(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_transformStreamController")?!1:o instanceof us}function Af(o,i){Pt(o._readable._readableStreamController,i),Fa(o,i)}function Fa(o,i){fs(o._transformStreamController),eo(o._writable._writableStreamController,i),Oa(o)}function Oa(o){o._backpressure&&cs(o,!1)}function cs(o,i){o._backpressureChangePromise!==void 0&&o._backpressureChangePromise_resolve(),o._backpressureChangePromise=f(c=>{o._backpressureChangePromise_resolve=c}),o._backpressure=i}class Rr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!ls(this))throw ds("desiredSize");let i=this._controlledTransformStream._readable._readableStreamController;return Ra(i)}enqueue(i=void 0){if(!ls(this))throw ds("enqueue");Df(this,i)}error(i=void 0){if(!ls(this))throw ds("error");Hy(this,i)}terminate(){if(!ls(this))throw ds("terminate");Gy(this)}}Object.defineProperties(Rr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Rr.prototype.enqueue,"enqueue"),s(Rr.prototype.error,"error"),s(Rr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Rr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function ls(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledTransformStream")?!1:o instanceof Rr}function My(o,i,c,m,A){i._controlledTransformStream=o,o._transformStreamController=i,i._transformAlgorithm=c,i._flushAlgorithm=m,i._cancelAlgorithm=A,i._finishPromise=void 0,i._finishPromise_resolve=void 0,i._finishPromise_reject=void 0}function $y(o,i){let c=Object.create(Rr.prototype),m,A,N;i.transform!==void 0?m=U=>i.transform(U,c):m=U=>{try{return Df(c,U),d(void 0)}catch(V){return h(V)}},i.flush!==void 0?A=()=>i.flush(c):A=()=>d(void 0),i.cancel!==void 0?N=U=>i.cancel(U):N=()=>d(void 0),My(o,c,m,A,N)}function fs(o){o._transformAlgorithm=void 0,o._flushAlgorithm=void 0,o._cancelAlgorithm=void 0}function Df(o,i){let c=o._controlledTransformStream,m=c._readable._readableStreamController;if(!yn(m))throw new TypeError("Readable side is not in a state that permits enqueue");try{gn(m,i)}catch(N){throw Fa(c,N),c._readable._storedError}_y(m)!==c._backpressure&&cs(c,!0)}function Hy(o,i){Af(o._controlledTransformStream,i)}function Sf(o,i){let c=o._transformAlgorithm(i);return b(c,void 0,m=>{throw Af(o._controlledTransformStream,m),m})}function Gy(o){let i=o._controlledTransformStream,c=i._readable._readableStreamController;Jr(c);let m=new TypeError("TransformStream terminated");Fa(i,m)}function Wy(o,i){let c=o._transformStreamController;if(o._backpressure){let m=o._backpressureChangePromise;return b(m,()=>{let A=o._writable;if(A._state==="erroring")throw A._storedError;return Sf(c,i)})}return Sf(c,i)}function zy(o,i){let c=o._transformStreamController;if(c._finishPromise!==void 0)return c._finishPromise;let m=o._readable;c._finishPromise=f((N,U)=>{c._finishPromise_resolve=N,c._finishPromise_reject=U});let A=c._cancelAlgorithm(i);return fs(c),w(A,()=>(m._state==="errored"?_n(c,m._storedError):(Pt(m._readableStreamController,i),Pa(c)),null),N=>(Pt(m._readableStreamController,N),_n(c,N),null)),c._finishPromise}function Jy(o){let i=o._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let c=o._readable;i._finishPromise=f((A,N)=>{i._finishPromise_resolve=A,i._finishPromise_reject=N});let m=i._flushAlgorithm();return fs(i),w(m,()=>(c._state==="errored"?_n(i,c._storedError):(Jr(c._readableStreamController),Pa(i)),null),A=>(Pt(c._readableStreamController,A),_n(i,A),null)),i._finishPromise}function Vy(o){return cs(o,!1),o._backpressureChangePromise}function Ky(o,i){let c=o._transformStreamController;if(c._finishPromise!==void 0)return c._finishPromise;let m=o._writable;c._finishPromise=f((N,U)=>{c._finishPromise_resolve=N,c._finishPromise_reject=U});let A=c._cancelAlgorithm(i);return fs(c),w(A,()=>(m._state==="errored"?_n(c,m._storedError):(eo(m._writableStreamController,i),Oa(o),Pa(c)),null),N=>(eo(m._writableStreamController,N),Oa(o),_n(c,N),null)),c._finishPromise}function ds(o){return new TypeError(`TransformStreamDefaultController.prototype.${o} can only be used on a TransformStreamDefaultController`)}function Pa(o){o._finishPromise_resolve!==void 0&&(o._finishPromise_resolve(),o._finishPromise_resolve=void 0,o._finishPromise_reject=void 0)}function _n(o,i){o._finishPromise_reject!==void 0&&(_(o._finishPromise),o._finishPromise_reject(i),o._finishPromise_resolve=void 0,o._finishPromise_reject=void 0)}function vf(o){return new TypeError(`TransformStream.prototype.${o} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=is,r.CountQueuingStrategy=as,r.ReadableByteStreamController=ir,r.ReadableStream=Ye,r.ReadableStreamBYOBReader=Dr,r.ReadableStreamBYOBRequest=Mr,r.ReadableStreamDefaultController=ur,r.ReadableStreamDefaultReader=M,r.TransformStream=us,r.TransformStreamDefaultController=Rr,r.WritableStream=Sr,r.WritableStreamDefaultController=mn,r.WritableStreamDefaultWriter=ar})});var Md=z(()=>{if(!globalThis.ReadableStream)try{let r=require("node:process"),{emitWarning:e}=r;try{r.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),r.emitWarning=e}catch(t){throw r.emitWarning=e,t}}catch{Object.assign(globalThis,Ud())}try{let{Blob:r}=require("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(t){let n=0,s=this;return new ReadableStream({type:"bytes",async pull(a){let l=await s.slice(n,Math.min(s.size,n+65536)).arrayBuffer();n+=l.byteLength,a.enqueue(new Uint8Array(l)),n===s.size&&a.close()}})})}catch{}});async function*iu(r,e=!0){for(let t of r)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let n=t.byteOffset,s=t.byteOffset+t.byteLength;for(;n!==s;){let a=Math.min(s-n,$d),u=t.buffer.slice(n,n+a);n+=u.byteLength,yield new Uint8Array(u)}}else yield t;else{let n=0,s=t;for(;n!==s.size;){let u=await s.slice(n,Math.min(s.size,n+$d)).arrayBuffer();n+=u.byteLength,yield new Uint8Array(u)}}}var QA,$d,Hd,y_,qt,co=Me(()=>{QA=qe(Md(),1);$d=65536;Hd=class au{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],t={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof t!="object"&&typeof t!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");t===null&&(t={});let n=new TextEncoder;for(let a of e){let u;ArrayBuffer.isView(a)?u=new Uint8Array(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)):a instanceof ArrayBuffer?u=new Uint8Array(a.slice(0)):a instanceof au?u=a:u=n.encode(`${a}`),this.#r+=ArrayBuffer.isView(u)?u.byteLength:u.size,this.#e.push(u)}this.#n=`${t.endings===void 0?"transparent":t.endings}`;let s=t.type===void 0?"":String(t.type);this.#t=/^[\x20-\x7E]*$/.test(s)?s:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,t="";for await(let n of iu(this.#e,!1))t+=e.decode(n,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let n of iu(this.#e,!1))e.set(n,t),t+=n.length;return e.buffer}stream(){let e=iu(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let n=await e.next();n.done?t.close():t.enqueue(n.value)},async cancel(){await e.return()}})}slice(e=0,t=this.size,n=""){let{size:s}=this,a=e<0?Math.max(s+e,0):Math.min(e,s),u=t<0?Math.max(s+t,0):Math.min(t,s),l=Math.max(u-a,0),f=this.#e,d=[],h=0;for(let w of f){if(h>=l)break;let I=ArrayBuffer.isView(w)?w.byteLength:w.size;if(a&&I<=a)a-=I,u-=I;else{let S;ArrayBuffer.isView(w)?(S=w.subarray(a,Math.min(I,u)),h+=S.byteLength):(S=w.slice(a,Math.min(I,u)),h+=S.size),u-=I,d.push(S),a=0}}let C=new au([],{type:String(n).toLowerCase()});return C.#r=l,C.#e=d,C}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Hd.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});y_=Hd,qt=y_});var __,C_,Pr,uu=Me(()=>{co();__=class extends qt{#e=0;#t="";constructor(e,t,n={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,n),n===null&&(n={});let s=n.lastModified===void 0?Date.now():Number(n.lastModified);Number.isNaN(s)||(this.#e=s),this.#t=String(t)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof qt&&/^(File)$/.test(e[Symbol.toStringTag])}},C_=__,Pr=C_});function zd(r,e=qt){var t=`${Gd()}${Gd()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),n=[],s=`--${t}\r
Content-Disposition: form-data; name="`;return r.forEach((a,u)=>typeof a=="string"?n.push(s+cu(u)+`"\r
\r
${a.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):n.push(s+cu(u)+`"; filename="${cu(a.name,1)}"\r
Content-Type: ${a.type||"application/octet-stream"}\r
\r
`,a,`\r
`)),n.push(`--${t}--`),new e(n,{type:"multipart/form-data; boundary="+t})}var lo,b_,E_,Gd,w_,Wd,cu,Qr,xr,Ls=Me(()=>{co();uu();({toStringTag:lo,iterator:b_,hasInstance:E_}=Symbol),Gd=Math.random,w_="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Wd=(r,e,t)=>(r+="",/^(Blob|File)$/.test(e&&e[lo])?[(t=t!==void 0?t+"":e[lo]=="File"?e.name:"blob",r),e.name!==t||e[lo]=="blob"?new Pr([e],t,e):e]:[r,e+""]),cu=(r,e)=>(e?r:r.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Qr=(r,e,t)=>{if(e.length<t)throw new TypeError(`Failed to execute '${r}' on 'FormData': ${t} arguments required, but only ${e.length} present.`)},xr=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[lo](){return"FormData"}[b_](){return this.entries()}static[E_](e){return e&&typeof e=="object"&&e[lo]==="FormData"&&!w_.some(t=>typeof e[t]!="function")}append(...e){Qr("append",arguments,2),this.#e.push(Wd(...e))}delete(e){Qr("delete",arguments,1),e+="",this.#e=this.#e.filter(([t])=>t!==e)}get(e){Qr("get",arguments,1),e+="";for(var t=this.#e,n=t.length,s=0;s<n;s++)if(t[s][0]===e)return t[s][1];return null}getAll(e,t){return Qr("getAll",arguments,1),t=[],e+="",this.#e.forEach(n=>n[0]===e&&t.push(n[1])),t}has(e){return Qr("has",arguments,1),e+="",this.#e.some(t=>t[0]===e)}forEach(e,t){Qr("forEach",arguments,1);for(var[n,s]of this)e.call(t,s,n,this)}set(...e){Qr("set",arguments,2);var t=[],n=!0;e=Wd(...e),this.#e.forEach(s=>{s[0]===e[0]?n&&(n=!t.push(e)):t.push(s)}),n&&t.push(e),this.#e=t}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var pr,Us=Me(()=>{pr=class extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var tt,lu=Me(()=>{Us();tt=class extends pr{constructor(e,t,n){super(e,t),n&&(this.code=this.errno=n.code,this.erroredSysCall=n.syscall)}}});var Ms,fu,fo,Jd,Vd,Kd,$s=Me(()=>{Ms=Symbol.toStringTag,fu=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[Ms]==="URLSearchParams",fo=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[Ms]),Jd=r=>typeof r=="object"&&(r[Ms]==="AbortSignal"||r[Ms]==="EventTarget"),Vd=(r,e)=>{let t=new URL(e).hostname,n=new URL(r).hostname;return t===n||t.endsWith(`.${n}`)},Kd=(r,e)=>{let t=new URL(e).protocol,n=new URL(r).protocol;return t===n}});var Xd=z((fD,Yd)=>{if(!globalThis.DOMException)try{let{MessageChannel:r}=require("worker_threads"),e=new r().port1,t=new ArrayBuffer;e.postMessage(t,[t,t])}catch(r){r.constructor.name==="DOMException"&&(globalThis.DOMException=r.constructor)}Yd.exports=globalThis.DOMException});var Zr,Qd,Zd,du,eh,th,rh,nh,oh,sh,Hs,hu=Me(()=>{Zr=require("node:fs"),Qd=require("node:path"),Zd=qe(Xd(),1);uu();co();({stat:du}=Zr.promises),eh=(r,e)=>oh((0,Zr.statSync)(r),r,e),th=(r,e)=>du(r).then(t=>oh(t,r,e)),rh=(r,e)=>du(r).then(t=>sh(t,r,e)),nh=(r,e)=>sh((0,Zr.statSync)(r),r,e),oh=(r,e,t="")=>new qt([new Hs({path:e,size:r.size,lastModified:r.mtimeMs,start:0})],{type:t}),sh=(r,e,t="")=>new Pr([new Hs({path:e,size:r.size,lastModified:r.mtimeMs,start:0})],(0,Qd.basename)(e),{type:t,lastModified:r.mtimeMs}),Hs=class r{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,t){return new r({path:this.#e,lastModified:this.lastModified,size:t-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await du(this.#e);if(e>this.lastModified)throw new Zd.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,Zr.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var ah={};Ba(ah,{toFormData:()=>k_});function R_(r){let e=r.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let t=e[2]||e[3]||"",n=t.slice(t.lastIndexOf("\\")+1);return n=n.replace(/%22/g,'"'),n=n.replace(/&#(\d{4});/g,(s,a)=>String.fromCharCode(a)),n}async function k_(r,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let t=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!t)throw new TypeError("no or bad content-type header, no multipart boundary");let n=new pu(t[1]||t[2]),s,a,u,l,f,d,h=[],C=new xr,w=y=>{u+=_.decode(y,{stream:!0})},I=y=>{h.push(y)},S=()=>{let y=new Pr(h,d,{type:f});C.append(l,y)},b=()=>{C.append(l,u)},_=new TextDecoder("utf-8");_.decode(),n.onPartBegin=function(){n.onPartData=w,n.onPartEnd=b,s="",a="",u="",l="",f="",d=null,h.length=0},n.onHeaderField=function(y){s+=_.decode(y,{stream:!0})},n.onHeaderValue=function(y){a+=_.decode(y,{stream:!0})},n.onHeaderEnd=function(){if(a+=_.decode(),s=s.toLowerCase(),s==="content-disposition"){let y=a.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);y&&(l=y[2]||y[3]||""),d=R_(a),d&&(n.onPartData=I,n.onPartEnd=S)}else s==="content-type"&&(f=a);a="",s=""};for await(let y of r)n.write(y);return n.end(),C}var Vt,ke,ih,Br,Gs,Ws,A_,ho,D_,S_,v_,T_,en,pu,uh=Me(()=>{hu();Ls();Vt=0,ke={START_BOUNDARY:Vt++,HEADER_FIELD_START:Vt++,HEADER_FIELD:Vt++,HEADER_VALUE_START:Vt++,HEADER_VALUE:Vt++,HEADER_VALUE_ALMOST_DONE:Vt++,HEADERS_ALMOST_DONE:Vt++,PART_DATA_START:Vt++,PART_DATA:Vt++,END:Vt++},ih=1,Br={PART_BOUNDARY:ih,LAST_BOUNDARY:ih*=2},Gs=10,Ws=13,A_=32,ho=45,D_=58,S_=97,v_=122,T_=r=>r|32,en=()=>{},pu=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=en,this.onHeaderField=en,this.onHeadersEnd=en,this.onHeaderValue=en,this.onPartBegin=en,this.onPartData=en,this.onPartEnd=en,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=ke.START_BOUNDARY}write(e){let t=0,n=e.length,s=this.index,{lookbehind:a,boundary:u,boundaryChars:l,index:f,state:d,flags:h}=this,C=this.boundary.length,w=C-1,I=e.length,S,b,_=L=>{this[L+"Mark"]=t},y=L=>{delete this[L+"Mark"]},T=(L,P,j,G)=>{(P===void 0||P!==j)&&this[L](G&&G.subarray(P,j))},F=(L,P)=>{let j=L+"Mark";j in this&&(P?(T(L,this[j],t,e),delete this[j]):(T(L,this[j],e.length,e),this[j]=0))};for(t=0;t<n;t++)switch(S=e[t],d){case ke.START_BOUNDARY:if(f===u.length-2){if(S===ho)h|=Br.LAST_BOUNDARY;else if(S!==Ws)return;f++;break}else if(f-1===u.length-2){if(h&Br.LAST_BOUNDARY&&S===ho)d=ke.END,h=0;else if(!(h&Br.LAST_BOUNDARY)&&S===Gs)f=0,T("onPartBegin"),d=ke.HEADER_FIELD_START;else return;break}S!==u[f+2]&&(f=-2),S===u[f+2]&&f++;break;case ke.HEADER_FIELD_START:d=ke.HEADER_FIELD,_("onHeaderField"),f=0;case ke.HEADER_FIELD:if(S===Ws){y("onHeaderField"),d=ke.HEADERS_ALMOST_DONE;break}if(f++,S===ho)break;if(S===D_){if(f===1)return;F("onHeaderField",!0),d=ke.HEADER_VALUE_START;break}if(b=T_(S),b<S_||b>v_)return;break;case ke.HEADER_VALUE_START:if(S===A_)break;_("onHeaderValue"),d=ke.HEADER_VALUE;case ke.HEADER_VALUE:S===Ws&&(F("onHeaderValue",!0),T("onHeaderEnd"),d=ke.HEADER_VALUE_ALMOST_DONE);break;case ke.HEADER_VALUE_ALMOST_DONE:if(S!==Gs)return;d=ke.HEADER_FIELD_START;break;case ke.HEADERS_ALMOST_DONE:if(S!==Gs)return;T("onHeadersEnd"),d=ke.PART_DATA_START;break;case ke.PART_DATA_START:d=ke.PART_DATA,_("onPartData");case ke.PART_DATA:if(s=f,f===0){for(t+=w;t<I&&!(e[t]in l);)t+=C;t-=w,S=e[t]}if(f<u.length)u[f]===S?(f===0&&F("onPartData",!0),f++):f=0;else if(f===u.length)f++,S===Ws?h|=Br.PART_BOUNDARY:S===ho?h|=Br.LAST_BOUNDARY:f=0;else if(f-1===u.length)if(h&Br.PART_BOUNDARY){if(f=0,S===Gs){h&=~Br.PART_BOUNDARY,T("onPartEnd"),T("onPartBegin"),d=ke.HEADER_FIELD_START;break}}else h&Br.LAST_BOUNDARY&&S===ho?(T("onPartEnd"),d=ke.END,h=0):f=0;if(f>0)a[f-1]=S;else if(s>0){let L=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);T("onPartData",0,s,L),s=0,_("onPartData"),t--}break;case ke.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}F("onHeaderField"),F("onHeaderValue"),F("onPartData"),this.index=f,this.state=d,this.flags=h}end(){if(this.state===ke.HEADER_FIELD_START&&this.index===0||this.state===ke.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==ke.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function mu(r){if(r[it].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[it].disturbed=!0,r[it].error)throw r[it].error;let{body:e}=r;if(e===null)return ft.Buffer.alloc(0);if(!(e instanceof vt.default))return ft.Buffer.alloc(0);let t=[],n=0;try{for await(let s of e){if(r.size>0&&n+s.length>r.size){let a=new tt(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw e.destroy(a),a}n+=s.length,t.push(s)}}catch(s){throw s instanceof pr?s:new tt(`Invalid response body while trying to fetch ${r.url}: ${s.message}`,"system",s)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(s=>typeof s=="string")?ft.Buffer.from(t.join("")):ft.Buffer.concat(t,n)}catch(s){throw new tt(`Could not create Buffer from response body for ${r.url}: ${s.message}`,"system",s)}else throw new tt(`Premature close of server response while trying to fetch ${r.url}`)}var vt,mr,ft,F_,it,Kt,Rn,O_,zs,ch,lh,Js=Me(()=>{vt=qe(require("node:stream"),1),mr=require("node:util"),ft=require("node:buffer");co();Ls();lu();Us();$s();F_=(0,mr.promisify)(vt.default.pipeline),it=Symbol("Body internals"),Kt=class{constructor(e,{size:t=0}={}){let n=null;e===null?e=null:fu(e)?e=ft.Buffer.from(e.toString()):fo(e)||ft.Buffer.isBuffer(e)||(mr.types.isAnyArrayBuffer(e)?e=ft.Buffer.from(e):ArrayBuffer.isView(e)?e=ft.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof vt.default||(e instanceof xr?(e=zd(e),n=e.type.split("=")[1]):e=ft.Buffer.from(String(e))));let s=e;ft.Buffer.isBuffer(e)?s=vt.default.Readable.from(e):fo(e)&&(s=vt.default.Readable.from(e.stream())),this[it]={body:e,stream:s,boundary:n,disturbed:!1,error:null},this.size=t,e instanceof vt.default&&e.on("error",a=>{let u=a instanceof pr?a:new tt(`Invalid response body while trying to fetch ${this.url}: ${a.message}`,"system",a);this[it].error=u})}get body(){return this[it].stream}get bodyUsed(){return this[it].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:n}=await mu(this);return e.slice(t,t+n)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let n=new xr,s=new URLSearchParams(await this.text());for(let[a,u]of s)n.append(a,u);return n}let{toFormData:t}=await Promise.resolve().then(()=>(uh(),ah));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[it].body&&this[it].body.type||"",t=await this.arrayBuffer();return new qt([t],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await mu(this);return new TextDecoder().decode(e)}buffer(){return mu(this)}};Kt.prototype.buffer=(0,mr.deprecate)(Kt.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(Kt.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,mr.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});Rn=(r,e)=>{let t,n,{body:s}=r[it];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof vt.default&&typeof s.getBoundary!="function"&&(t=new vt.PassThrough({highWaterMark:e}),n=new vt.PassThrough({highWaterMark:e}),s.pipe(t),s.pipe(n),r[it].stream=t,s=n),s},O_=(0,mr.deprecate)(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),zs=(r,e)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":fu(r)?"application/x-www-form-urlencoded;charset=UTF-8":fo(r)?r.type||null:ft.Buffer.isBuffer(r)||mr.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r instanceof xr?`multipart/form-data; boundary=${e[it].boundary}`:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${O_(r)}`:r instanceof vt.default?null:"text/plain;charset=UTF-8",ch=r=>{let{body:e}=r[it];return e===null?0:fo(e)?e.size:ft.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},lh=async(r,{body:e})=>{e===null?r.end():await F_(e,r)}});function fh(r=[]){return new at(r.reduce((e,t,n,s)=>(n%2===0&&e.push(s.slice(n,n+2)),e),[]).filter(([e,t])=>{try{return Vs(e),yu(e,String(t)),!0}catch{return!1}}))}var gu,po,Vs,yu,at,Ks=Me(()=>{gu=require("node:util"),po=qe(require("node:http"),1),Vs=typeof po.default.validateHeaderName=="function"?po.default.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let e=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},yu=typeof po.default.validateHeaderValue=="function"?po.default.validateHeaderValue:(r,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},at=class r extends URLSearchParams{constructor(e){let t=[];if(e instanceof r){let n=e.raw();for(let[s,a]of Object.entries(n))t.push(...a.map(u=>[s,u]))}else if(e!=null)if(typeof e=="object"&&!gu.types.isBoxedPrimitive(e)){let n=e[Symbol.iterator];if(n==null)t.push(...Object.entries(e));else{if(typeof n!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(s=>{if(typeof s!="object"||gu.types.isBoxedPrimitive(s))throw new TypeError("Each header pair must be an iterable object");return[...s]}).map(s=>{if(s.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...s]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([n,s])=>(Vs(n),yu(n,String(s)),[String(n).toLowerCase(),String(s)])):void 0,super(t),new Proxy(this,{get(n,s,a){switch(s){case"append":case"set":return(u,l)=>(Vs(u),yu(u,String(l)),URLSearchParams.prototype[s].call(n,String(u).toLowerCase(),String(l)));case"delete":case"has":case"getAll":return u=>(Vs(u),URLSearchParams.prototype[s].call(n,String(u).toLowerCase()));case"keys":return()=>(n.sort(),new Set(URLSearchParams.prototype.keys.call(n)).keys());default:return Reflect.get(n,s,a)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let n=t.join(", ");return/^content-encoding$/i.test(e)&&(n=n.toLowerCase()),n}forEach(e,t=void 0){for(let n of this.keys())Reflect.apply(e,t,[this.get(n),n,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let n=this.getAll(t);return t==="host"?e[t]=n[0]:e[t]=n.length>1?n:n[0],e},{})}};Object.defineProperties(at.prototype,["get","entries","forEach","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}))});var P_,mo,_u=Me(()=>{P_=new Set([301,302,303,307,308]),mo=r=>P_.has(r)});var jt,dt,dh=Me(()=>{Ks();Js();_u();jt=Symbol("Response internals"),dt=class r extends Kt{constructor(e=null,t={}){super(e,t);let n=t.status!=null?t.status:200,s=new at(t.headers);if(e!==null&&!s.has("Content-Type")){let a=zs(e,this);a&&s.append("Content-Type",a)}this[jt]={type:"default",url:t.url,status:n,statusText:t.statusText||"",headers:s,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[jt].type}get url(){return this[jt].url||""}get status(){return this[jt].status}get ok(){return this[jt].status>=200&&this[jt].status<300}get redirected(){return this[jt].counter>0}get statusText(){return this[jt].statusText}get headers(){return this[jt].headers}get highWaterMark(){return this[jt].highWaterMark}clone(){return new r(Rn(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!mo(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new r(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new r(null,{status:0,statusText:""});return e[jt].type="error",e}static json(e=void 0,t={}){let n=JSON.stringify(e);if(n===void 0)throw new TypeError("data is not JSON serializable");let s=new at(t&&t.headers);return s.has("content-type")||s.set("content-type","application/json"),new r(n,{...t,headers:s})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(dt.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var hh,ph=Me(()=>{hh=r=>{if(r.search)return r.search;let e=r.href.length-1,t=r.hash||(r.href[e]==="#"?"#":"");return r.href[e-t.length]==="?"?"?":""}});function mh(r,e=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",e&&(r.pathname="",r.search=""),r)}function Ch(r){if(!yh.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function x_(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;let e=r.host.replace(/(^\[)|(]$)/g,""),t=(0,gh.isIP)(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function kn(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:x_(r)}function bh(r,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;let n=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";let s=r.referrer,a=mh(s),u=mh(s,!0);a.toString().length>4096&&(a=u),e&&(a=e(a)),t&&(u=t(u));let l=new URL(r.url);switch(n){case"no-referrer":return"no-referrer";case"origin":return u;case"unsafe-url":return a;case"strict-origin":return kn(a)&&!kn(l)?"no-referrer":u.toString();case"strict-origin-when-cross-origin":return a.origin===l.origin?a:kn(a)&&!kn(l)?"no-referrer":u;case"same-origin":return a.origin===l.origin?a:"no-referrer";case"origin-when-cross-origin":return a.origin===l.origin?a:u;case"no-referrer-when-downgrade":return kn(a)&&!kn(l)?"no-referrer":a;default:throw new TypeError(`Invalid referrerPolicy: ${n}`)}}function Eh(r){let e=(r.get("referrer-policy")||"").split(/[,\s]+/),t="";for(let n of e)n&&yh.has(n)&&(t=n);return t}var gh,yh,_h,Cu=Me(()=>{gh=require("node:net");yh=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),_h="strict-origin-when-cross-origin"});var wh,Ah,We,go,B_,Ir,Dh,Sh=Me(()=>{wh=require("node:url"),Ah=require("node:util");Ks();Js();$s();ph();Cu();We=Symbol("Request internals"),go=r=>typeof r=="object"&&typeof r[We]=="object",B_=(0,Ah.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Ir=class r extends Kt{constructor(e,t={}){let n;if(go(e)?n=new URL(e.url):(n=new URL(e),e={}),n.username!==""||n.password!=="")throw new TypeError(`${n} is an url with embedded credentials.`);let s=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!go(t)&&"data"in t&&B_(),(t.body!=null||go(e)&&e.body!==null)&&(s==="GET"||s==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let a=t.body?t.body:go(e)&&e.body!==null?Rn(e):null;super(a,{size:t.size||e.size||0});let u=new at(t.headers||e.headers||{});if(a!==null&&!u.has("Content-Type")){let d=zs(a,this);d&&u.set("Content-Type",d)}let l=go(e)?e.signal:null;if("signal"in t&&(l=t.signal),l!=null&&!Jd(l))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let f=t.referrer==null?e.referrer:t.referrer;if(f==="")f="no-referrer";else if(f){let d=new URL(f);f=/^about:(\/\/)?client$/.test(d)?"client":d}else f=void 0;this[We]={method:s,redirect:t.redirect||e.redirect||"follow",headers:u,parsedURL:n,signal:l,referrer:f},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[We].method}get url(){return(0,wh.format)(this[We].parsedURL)}get headers(){return this[We].headers}get redirect(){return this[We].redirect}get signal(){return this[We].signal}get referrer(){if(this[We].referrer==="no-referrer")return"";if(this[We].referrer==="client")return"about:client";if(this[We].referrer)return this[We].referrer.toString()}get referrerPolicy(){return this[We].referrerPolicy}set referrerPolicy(e){this[We].referrerPolicy=Ch(e)}clone(){return new r(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Ir.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});Dh=r=>{let{parsedURL:e}=r[We],t=new at(r[We].headers);t.has("Accept")||t.set("Accept","*/*");let n=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(n="0"),r.body!==null){let l=ch(r);typeof l=="number"&&!Number.isNaN(l)&&(n=String(l))}n&&t.set("Content-Length",n),r.referrerPolicy===""&&(r.referrerPolicy=_h),r.referrer&&r.referrer!=="no-referrer"?r[We].referrer=bh(r):r[We].referrer="no-referrer",r[We].referrer instanceof URL&&t.set("Referer",r.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),r.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:s}=r;typeof s=="function"&&(s=s(e));let a=hh(e),u={path:e.pathname+a,method:r.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:s};return{parsedURL:e,options:u}}});var yo,vh=Me(()=>{Us();yo=class extends pr{constructor(e,t="aborted"){super(e,t)}}});var kh={};Ba(kh,{AbortError:()=>yo,Blob:()=>qt,FetchError:()=>tt,File:()=>Pr,FormData:()=>xr,Headers:()=>at,Request:()=>Ir,Response:()=>dt,blobFrom:()=>th,blobFromSync:()=>eh,default:()=>bu,fileFrom:()=>rh,fileFromSync:()=>nh,isRedirect:()=>mo});async function bu(r,e){return new Promise((t,n)=>{let s=new Ir(r,e),{parsedURL:a,options:u}=Dh(s);if(!I_.has(a.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${a.protocol.replace(/:$/,"")}" is not supported.`);if(a.protocol==="data:"){let S=qd(s.url),b=new dt(S,{headers:{"Content-Type":S.typeFull}});t(b);return}let l=(a.protocol==="https:"?Rh.default:Th.default).request,{signal:f}=s,d=null,h=()=>{let S=new yo("The operation was aborted.");n(S),s.body&&s.body instanceof ht.default.Readable&&s.body.destroy(S),!(!d||!d.body)&&d.body.emit("error",S)};if(f&&f.aborted){h();return}let C=()=>{h(),I()},w=l(a.toString(),u);f&&f.addEventListener("abort",C);let I=()=>{w.abort(),f&&f.removeEventListener("abort",C)};w.on("error",S=>{n(new tt(`request to ${s.url} failed, reason: ${S.message}`,"system",S)),I()}),N_(w,S=>{d&&d.body&&d.body.destroy(S)}),process.version<"v14"&&w.on("socket",S=>{let b;S.prependListener("end",()=>{b=S._eventsCount}),S.prependListener("close",_=>{if(d&&b<S._eventsCount&&!_){let y=new Error("Premature close");y.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",y)}})}),w.on("response",S=>{w.setTimeout(0);let b=fh(S.rawHeaders);if(mo(S.statusCode)){let L=b.get("Location"),P=null;try{P=L===null?null:new URL(L,s.url)}catch{if(s.redirect!=="manual"){n(new tt(`uri requested responds with an invalid redirect URL: ${L}`,"invalid-redirect")),I();return}}switch(s.redirect){case"error":n(new tt(`uri requested responds with a redirect, redirect mode is set to error: ${s.url}`,"no-redirect")),I();return;case"manual":break;case"follow":{if(P===null)break;if(s.counter>=s.follow){n(new tt(`maximum redirect reached at: ${s.url}`,"max-redirect")),I();return}let j={headers:new at(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:Rn(s),signal:s.signal,size:s.size,referrer:s.referrer,referrerPolicy:s.referrerPolicy};if(!Vd(s.url,P)||!Kd(s.url,P))for(let te of["authorization","www-authenticate","cookie","cookie2"])j.headers.delete(te);if(S.statusCode!==303&&s.body&&e.body instanceof ht.default.Readable){n(new tt("Cannot follow redirect with body being a readable stream","unsupported-redirect")),I();return}(S.statusCode===303||(S.statusCode===301||S.statusCode===302)&&s.method==="POST")&&(j.method="GET",j.body=void 0,j.headers.delete("content-length"));let G=Eh(b);G&&(j.referrerPolicy=G),t(bu(new Ir(P,j))),I();return}default:return n(new TypeError(`Redirect option '${s.redirect}' is not a valid value of RequestRedirect`))}}f&&S.once("end",()=>{f.removeEventListener("abort",C)});let _=(0,ht.pipeline)(S,new ht.PassThrough,L=>{L&&n(L)});process.version<"v12.10"&&S.on("aborted",C);let y={url:s.url,status:S.statusCode,statusText:S.statusMessage,headers:b,size:s.size,counter:s.counter,highWaterMark:s.highWaterMark},T=b.get("Content-Encoding");if(!s.compress||s.method==="HEAD"||T===null||S.statusCode===204||S.statusCode===304){d=new dt(_,y),t(d);return}let F={flush:tn.default.Z_SYNC_FLUSH,finishFlush:tn.default.Z_SYNC_FLUSH};if(T==="gzip"||T==="x-gzip"){_=(0,ht.pipeline)(_,tn.default.createGunzip(F),L=>{L&&n(L)}),d=new dt(_,y),t(d);return}if(T==="deflate"||T==="x-deflate"){let L=(0,ht.pipeline)(S,new ht.PassThrough,P=>{P&&n(P)});L.once("data",P=>{(P[0]&15)===8?_=(0,ht.pipeline)(_,tn.default.createInflate(),j=>{j&&n(j)}):_=(0,ht.pipeline)(_,tn.default.createInflateRaw(),j=>{j&&n(j)}),d=new dt(_,y),t(d)}),L.once("end",()=>{d||(d=new dt(_,y),t(d))});return}if(T==="br"){_=(0,ht.pipeline)(_,tn.default.createBrotliDecompress(),L=>{L&&n(L)}),d=new dt(_,y),t(d);return}d=new dt(_,y),t(d)}),lh(w,s).catch(n)})}function N_(r,e){let t=_o.Buffer.from(`0\r
\r
`),n=!1,s=!1,a;r.on("response",u=>{let{headers:l}=u;n=l["transfer-encoding"]==="chunked"&&!l["content-length"]}),r.on("socket",u=>{let l=()=>{if(n&&!s){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",e(d)}},f=d=>{s=_o.Buffer.compare(d.slice(-5),t)===0,!s&&a&&(s=_o.Buffer.compare(a.slice(-3),t.slice(0,3))===0&&_o.Buffer.compare(d.slice(-2),t.slice(3))===0),a=d};u.prependListener("close",l),u.on("data",f),r.on("close",()=>{u.removeListener("close",l),u.removeListener("data",f)})})}var Th,Rh,tn,ht,_o,I_,Fh=Me(()=>{Th=qe(require("node:http"),1),Rh=qe(require("node:https"),1),tn=qe(require("node:zlib"),1),ht=qe(require("node:stream"),1),_o=require("node:buffer");jd();Js();dh();Ks();Sh();lu();vh();_u();Ls();$s();Cu();hu();I_=new Set(["data:","http:","https:"])});var xh=z(On=>{"use strict";var q_=On&&On.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},Fn;Object.defineProperty(On,"__esModule",{value:!0});On.Gaxios=void 0;var j_=q_(Va()),L_=require("https"),rn=Xa(),U_=dd(),Oh=require("stream"),Ph=eu(),M_=async()=>globalThis.crypto?.randomUUID()||(await import("crypto")).randomUUID(),Ys=class{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new Ph.GaxiosInterceptorManager,response:new Ph.GaxiosInterceptorManager}}fetch(...e){let t=e[0],n=e[1],s,a=new Headers;return typeof t=="string"?s=new URL(t):t instanceof URL?s=t:t&&t.url&&(s=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&Fn.mergeHeaders(a,t.headers),n&&Fn.mergeHeaders(a,new Headers(n.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...n,...t,headers:a,url:s}):this.request({...n,headers:a,url:s})}async request(e={}){let t=await this.#n(e);return t=await this.#t(t),this.#r(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await Fn.#u(),n={...e};delete n.data;let s=await t(e.url,n),a=await this.getResponseData(e,s);return Object.getOwnPropertyDescriptor(s,"data")?.configurable||Object.defineProperties(s,{data:{configurable:!0,writable:!0,enumerable:!0,value:a}}),Object.assign(s,{config:e,data:a})}async _request(e){try{let t;if(e.adapter?t=await e.adapter(e,this._defaultAdapter.bind(this)):t=await this._defaultAdapter(e),!e.validateStatus(t.status)){if(e.responseType==="stream"){let s=[];for await(let a of e.data??[])s.push(a);t.data=s}let n=rn.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new rn.GaxiosError(n?.message,e,t,n)}return t}catch(t){let n;t instanceof rn.GaxiosError?n=t:t instanceof Error?n=new rn.GaxiosError(t.message,e,void 0,t):n=new rn.GaxiosError("Unexpected Gaxios Error",e,void 0,t);let{shouldRetry:s,config:a}=await(0,U_.getRetryConfig)(n);if(s&&a)return n.config.retryConfig.currentRetryAttempt=a.retryConfig.currentRetryAttempt,e.retryConfig=n.config?.retryConfig,this.#o(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(n),n}}async getResponseData(e,t){if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new rn.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":return t.json();case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#e(e,t=[]){let n=new URL(e),s=[...t],a=(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[];for(let u of a)s.push(u.trim());for(let u of s)if(u instanceof RegExp){if(u.test(n.toString()))return!1}else if(u instanceof URL){if(u.origin===n.origin)return!1}else if(u.startsWith("*.")||u.startsWith(".")){let l=u.replace(/^\*\./,".");if(n.hostname.endsWith(l))return!1}else if(u===n.origin||u===n.hostname||u===n.href)return!1;return!0}async#t(e){let t=Promise.resolve(e);for(let n of this.interceptors.request.values())n&&(t=t.then(n.resolved,n.rejected));return t}async#r(e){let t=Promise.resolve(e);for(let n of this.interceptors.response.values())n&&(t=t.then(n.resolved,n.rejected));return t}async#n(e){let t=new Headers(this.defaults.headers);Fn.mergeHeaders(t,e.headers);let n=(0,j_.default)(!0,{},this.defaults,e);if(!n.url)throw new Error("URL is required.");if(n.baseURL&&(n.url=new URL(n.url,n.baseURL)),n.url=new URL(n.url),n.params)if(n.paramsSerializer){let u=n.paramsSerializer(n.params);u.startsWith("?")&&(u=u.slice(1));let l=n.url.toString().includes("?")?"&":"?";n.url=n.url+l+u}else{let u=n.url instanceof URL?n.url:new URL(n.url);for(let[l,f]of new URLSearchParams(n.params))u.searchParams.append(l,f);n.url=u}typeof e.maxContentLength=="number"&&(n.size=e.maxContentLength),typeof e.maxRedirects=="number"&&(n.follow=e.maxRedirects);let s=typeof n.data=="string"||n.data instanceof ArrayBuffer||n.data instanceof Blob||globalThis.File&&n.data instanceof File||n.data instanceof FormData||n.data instanceof Oh.Readable||n.data instanceof ReadableStream||n.data instanceof String||n.data instanceof URLSearchParams||ArrayBuffer.isView(n.data)||["Blob","File","FormData"].includes(n.data?.constructor?.name||"");if(n.multipart?.length){let u=await M_();t.set("content-type",`multipart/related; boundary=${u}`),n.body=Oh.Readable.from(this.getMultipartRequest(n.multipart,u))}else s?n.body=n.data:typeof n.data=="object"?t.get("Content-Type")==="application/x-www-form-urlencoded"?n.body=n.paramsSerializer?n.paramsSerializer(n.data):new URLSearchParams(n.data):(t.has("content-type")||t.set("content-type","application/json"),n.body=JSON.stringify(n.data)):n.data&&(n.body=n.data);n.validateStatus=n.validateStatus||this.validateStatus,n.responseType=n.responseType||"unknown",!t.has("accept")&&n.responseType==="json"&&t.set("accept","application/json");let a=n.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(!n.agent)if(a&&this.#e(n.url,n.noProxy)){let u=await Fn.#a();this.agentCache.has(a)?n.agent=this.agentCache.get(a):(n.agent=new u(a,{cert:n.cert,key:n.key}),this.agentCache.set(a,n.agent))}else n.cert&&n.key&&(this.agentCache.has(n.key)?n.agent=this.agentCache.get(n.key):(n.agent=new L_.Agent({cert:n.cert,key:n.key}),this.agentCache.set(n.key,n.agent)));return typeof n.errorRedactor!="function"&&n.errorRedactor!==!1&&(n.errorRedactor=rn.defaultErrorRedactor),n.body&&!("duplex"in n)&&(n.duplex="half"),this.#o(n),Object.assign(n,{headers:t,url:n.url instanceof URL?n.url:new URL(n.url)})}#o(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(t===null)return e.text();if(t=t.toLowerCase(),t.includes("application/json")){let n=await e.text();try{n=JSON.parse(n)}catch{}return n}else return t.match(/^text\//)?e.text():e.blob()}async*getMultipartRequest(e,t){let n=`--${t}--`;for(let s of e){let a=s.headers.get("Content-Type")||"application/octet-stream";yield`--${t}\r
Content-Type: ${a}\r
\r
`,typeof s.content=="string"?yield s.content:yield*s.content,yield`\r
`}yield n}static#s;static#i;static async#a(){return this.#s||=(await Promise.resolve().then(()=>qe(Nd()))).HttpsProxyAgent,this.#s}static async#u(){let e=typeof window<"u"&&!!window;return this.#i||=e?window.fetch:(await Promise.resolve().then(()=>(Fh(),kh))).default,this.#i}static mergeHeaders(e,...t){e=e instanceof Headers?e:new Headers(e);for(let n of t)(n instanceof Headers?n:new Headers(n)).forEach((a,u)=>{u==="set-cookie"?e.append(u,a):e.set(u,a)});return e}};On.Gaxios=Ys;Fn=Ys});var Ve=z(rt=>{"use strict";var $_=rt&&rt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),H_=rt&&rt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&$_(e,r,t)};Object.defineProperty(rt,"__esModule",{value:!0});rt.instance=rt.Gaxios=rt.GaxiosError=void 0;rt.request=W_;var Bh=xh();Object.defineProperty(rt,"Gaxios",{enumerable:!0,get:function(){return Bh.Gaxios}});var G_=Xa();Object.defineProperty(rt,"GaxiosError",{enumerable:!0,get:function(){return G_.GaxiosError}});H_(eu(),rt);rt.instance=new Bh.Gaxios;async function W_(r){return rt.instance.request(r)}});var Eu=z((Ih,Xs)=>{(function(r){"use strict";var e,t=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,n=Math.ceil,s=Math.floor,a="[BigNumber Error] ",u=a+"Number primitive has more than 15 significant digits: ",l=1e14,f=14,d=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],C=1e7,w=1e9;function I(P){var j,G,te,W=H.prototype={constructor:H,toString:null,valueOf:null},be=new H(1),de=20,oe=4,ae=-7,Q=21,ue=-1e7,he=1e7,ve=!1,J=1,Y=0,ce={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Ne="0123456789abcdefghijklmnopqrstuvwxyz",ze=!0;function H(p,g){var E,x,v,k,q,D,R,B,O=this;if(!(O instanceof H))return new H(p,g);if(g==null){if(p&&p._isBigNumber===!0){O.s=p.s,!p.c||p.e>he?O.c=O.e=null:p.e<ue?O.c=[O.e=0]:(O.e=p.e,O.c=p.c.slice());return}if((D=typeof p=="number")&&p*0==0){if(O.s=1/p<0?(p=-p,-1):1,p===~~p){for(k=0,q=p;q>=10;q/=10,k++);k>he?O.c=O.e=null:(O.e=k,O.c=[p]);return}B=String(p)}else{if(!t.test(B=String(p)))return te(O,B,D);O.s=B.charCodeAt(0)==45?(B=B.slice(1),-1):1}(k=B.indexOf("."))>-1&&(B=B.replace(".","")),(q=B.search(/e/i))>0?(k<0&&(k=q),k+=+B.slice(q+1),B=B.substring(0,q)):k<0&&(k=B.length)}else{if(y(g,2,Ne.length,"Base"),g==10&&ze)return O=new H(p),xe(O,de+O.e+1,oe);if(B=String(p),D=typeof p=="number"){if(p*0!=0)return te(O,B,D,g);if(O.s=1/p<0?(B=B.slice(1),-1):1,H.DEBUG&&B.replace(/^0\.0*|\./,"").length>15)throw Error(u+p)}else O.s=B.charCodeAt(0)===45?(B=B.slice(1),-1):1;for(E=Ne.slice(0,g),k=q=0,R=B.length;q<R;q++)if(E.indexOf(x=B.charAt(q))<0){if(x=="."){if(q>k){k=R;continue}}else if(!v&&(B==B.toUpperCase()&&(B=B.toLowerCase())||B==B.toLowerCase()&&(B=B.toUpperCase()))){v=!0,q=-1,k=0;continue}return te(O,String(p),D,g)}D=!1,B=G(B,g,10,O.s),(k=B.indexOf("."))>-1?B=B.replace(".",""):k=B.length}for(q=0;B.charCodeAt(q)===48;q++);for(R=B.length;B.charCodeAt(--R)===48;);if(B=B.slice(q,++R)){if(R-=q,D&&H.DEBUG&&R>15&&(p>d||p!==s(p)))throw Error(u+O.s*p);if((k=k-q-1)>he)O.c=O.e=null;else if(k<ue)O.c=[O.e=0];else{if(O.e=k,O.c=[],q=(k+1)%f,k<0&&(q+=f),q<R){for(q&&O.c.push(+B.slice(0,q)),R-=f;q<R;)O.c.push(+B.slice(q,q+=f));q=f-(B=B.slice(q)).length}else q-=R;for(;q--;B+="0");O.c.push(+B)}}else O.c=[O.e=0]}H.clone=I,H.ROUND_UP=0,H.ROUND_DOWN=1,H.ROUND_CEIL=2,H.ROUND_FLOOR=3,H.ROUND_HALF_UP=4,H.ROUND_HALF_DOWN=5,H.ROUND_HALF_EVEN=6,H.ROUND_HALF_CEIL=7,H.ROUND_HALF_FLOOR=8,H.EUCLID=9,H.config=H.set=function(p){var g,E;if(p!=null)if(typeof p=="object"){if(p.hasOwnProperty(g="DECIMAL_PLACES")&&(E=p[g],y(E,0,w,g),de=E),p.hasOwnProperty(g="ROUNDING_MODE")&&(E=p[g],y(E,0,8,g),oe=E),p.hasOwnProperty(g="EXPONENTIAL_AT")&&(E=p[g],E&&E.pop?(y(E[0],-w,0,g),y(E[1],0,w,g),ae=E[0],Q=E[1]):(y(E,-w,w,g),ae=-(Q=E<0?-E:E))),p.hasOwnProperty(g="RANGE"))if(E=p[g],E&&E.pop)y(E[0],-w,-1,g),y(E[1],1,w,g),ue=E[0],he=E[1];else if(y(E,-w,w,g),E)ue=-(he=E<0?-E:E);else throw Error(a+g+" cannot be zero: "+E);if(p.hasOwnProperty(g="CRYPTO"))if(E=p[g],E===!!E)if(E)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))ve=E;else throw ve=!E,Error(a+"crypto unavailable");else ve=E;else throw Error(a+g+" not true or false: "+E);if(p.hasOwnProperty(g="MODULO_MODE")&&(E=p[g],y(E,0,9,g),J=E),p.hasOwnProperty(g="POW_PRECISION")&&(E=p[g],y(E,0,w,g),Y=E),p.hasOwnProperty(g="FORMAT"))if(E=p[g],typeof E=="object")ce=E;else throw Error(a+g+" not an object: "+E);if(p.hasOwnProperty(g="ALPHABET"))if(E=p[g],typeof E=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(E))ze=E.slice(0,10)=="0123456789",Ne=E;else throw Error(a+g+" invalid: "+E)}else throw Error(a+"Object expected: "+p);return{DECIMAL_PLACES:de,ROUNDING_MODE:oe,EXPONENTIAL_AT:[ae,Q],RANGE:[ue,he],CRYPTO:ve,MODULO_MODE:J,POW_PRECISION:Y,FORMAT:ce,ALPHABET:Ne}},H.isBigNumber=function(p){if(!p||p._isBigNumber!==!0)return!1;if(!H.DEBUG)return!0;var g,E,x=p.c,v=p.e,k=p.s;e:if({}.toString.call(x)=="[object Array]"){if((k===1||k===-1)&&v>=-w&&v<=w&&v===s(v)){if(x[0]===0){if(v===0&&x.length===1)return!0;break e}if(g=(v+1)%f,g<1&&(g+=f),String(x[0]).length==g){for(g=0;g<x.length;g++)if(E=x[g],E<0||E>=l||E!==s(E))break e;if(E!==0)return!0}}}else if(x===null&&v===null&&(k===null||k===1||k===-1))return!0;throw Error(a+"Invalid BigNumber: "+p)},H.maximum=H.max=function(){return we(arguments,-1)},H.minimum=H.min=function(){return we(arguments,1)},H.random=function(){var p=9007199254740992,g=Math.random()*p&2097151?function(){return s(Math.random()*p)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(E){var x,v,k,q,D,R=0,B=[],O=new H(be);if(E==null?E=de:y(E,0,w),q=n(E/f),ve)if(crypto.getRandomValues){for(x=crypto.getRandomValues(new Uint32Array(q*=2));R<q;)D=x[R]*131072+(x[R+1]>>>11),D>=9e15?(v=crypto.getRandomValues(new Uint32Array(2)),x[R]=v[0],x[R+1]=v[1]):(B.push(D%1e14),R+=2);R=q/2}else if(crypto.randomBytes){for(x=crypto.randomBytes(q*=7);R<q;)D=(x[R]&31)*281474976710656+x[R+1]*1099511627776+x[R+2]*4294967296+x[R+3]*16777216+(x[R+4]<<16)+(x[R+5]<<8)+x[R+6],D>=9e15?crypto.randomBytes(7).copy(x,R):(B.push(D%1e14),R+=7);R=q/7}else throw ve=!1,Error(a+"crypto unavailable");if(!ve)for(;R<q;)D=g(),D<9e15&&(B[R++]=D%1e14);for(q=B[--R],E%=f,q&&E&&(D=h[f-E],B[R]=s(q/D)*D);B[R]===0;B.pop(),R--);if(R<0)B=[k=0];else{for(k=-1;B[0]===0;B.splice(0,1),k-=f);for(R=1,D=B[0];D>=10;D/=10,R++);R<f&&(k-=f-R)}return O.e=k,O.c=B,O}}(),H.sum=function(){for(var p=1,g=arguments,E=new H(g[0]);p<g.length;)E=E.plus(g[p++]);return E},G=function(){var p="0123456789";function g(E,x,v,k){for(var q,D=[0],R,B=0,O=E.length;B<O;){for(R=D.length;R--;D[R]*=x);for(D[0]+=k.indexOf(E.charAt(B++)),q=0;q<D.length;q++)D[q]>v-1&&(D[q+1]==null&&(D[q+1]=0),D[q+1]+=D[q]/v|0,D[q]%=v)}return D.reverse()}return function(E,x,v,k,q){var D,R,B,O,M,K,X,Ee,Fe=E.indexOf("."),Be=de,Ce=oe;for(Fe>=0&&(O=Y,Y=0,E=E.replace(".",""),Ee=new H(x),K=Ee.pow(E.length-Fe),Y=O,Ee.c=g(L(b(K.c),K.e,"0"),10,v,p),Ee.e=Ee.c.length),X=g(E,x,v,q?(D=Ne,p):(D=p,Ne)),B=O=X.length;X[--O]==0;X.pop());if(!X[0])return D.charAt(0);if(Fe<0?--B:(K.c=X,K.e=B,K.s=k,K=j(K,Ee,Be,Ce,v),X=K.c,M=K.r,B=K.e),R=B+Be+1,Fe=X[R],O=v/2,M=M||R<0||X[R+1]!=null,M=Ce<4?(Fe!=null||M)&&(Ce==0||Ce==(K.s<0?3:2)):Fe>O||Fe==O&&(Ce==4||M||Ce==6&&X[R-1]&1||Ce==(K.s<0?8:7)),R<1||!X[0])E=M?L(D.charAt(1),-Be,D.charAt(0)):D.charAt(0);else{if(X.length=R,M)for(--v;++X[--R]>v;)X[R]=0,R||(++B,X=[1].concat(X));for(O=X.length;!X[--O];);for(Fe=0,E="";Fe<=O;E+=D.charAt(X[Fe++]));E=L(E,B,D.charAt(0))}return E}}(),j=function(){function p(x,v,k){var q,D,R,B,O=0,M=x.length,K=v%C,X=v/C|0;for(x=x.slice();M--;)R=x[M]%C,B=x[M]/C|0,q=X*R+B*K,D=K*R+q%C*C+O,O=(D/k|0)+(q/C|0)+X*B,x[M]=D%k;return O&&(x=[O].concat(x)),x}function g(x,v,k,q){var D,R;if(k!=q)R=k>q?1:-1;else for(D=R=0;D<k;D++)if(x[D]!=v[D]){R=x[D]>v[D]?1:-1;break}return R}function E(x,v,k,q){for(var D=0;k--;)x[k]-=D,D=x[k]<v[k]?1:0,x[k]=D*q+x[k]-v[k];for(;!x[0]&&x.length>1;x.splice(0,1));}return function(x,v,k,q,D){var R,B,O,M,K,X,Ee,Fe,Be,Ce,Ae,Le,cn,ln,fn,ut,or,Ke=x.s==v.s?1:-1,Ue=x.c,De=v.c;if(!Ue||!Ue[0]||!De||!De[0])return new H(!x.s||!v.s||(Ue?De&&Ue[0]==De[0]:!De)?NaN:Ue&&Ue[0]==0||!De?Ke*0:Ke/0);for(Fe=new H(Ke),Be=Fe.c=[],B=x.e-v.e,Ke=k+B+1,D||(D=l,B=S(x.e/f)-S(v.e/f),Ke=Ke/f|0),O=0;De[O]==(Ue[O]||0);O++);if(De[O]>(Ue[O]||0)&&B--,Ke<0)Be.push(1),M=!0;else{for(ln=Ue.length,ut=De.length,O=0,Ke+=2,K=s(D/(De[0]+1)),K>1&&(De=p(De,K,D),Ue=p(Ue,K,D),ut=De.length,ln=Ue.length),cn=ut,Ce=Ue.slice(0,ut),Ae=Ce.length;Ae<ut;Ce[Ae++]=0);or=De.slice(),or=[0].concat(or),fn=De[0],De[1]>=D/2&&fn++;do{if(K=0,R=g(De,Ce,ut,Ae),R<0){if(Le=Ce[0],ut!=Ae&&(Le=Le*D+(Ce[1]||0)),K=s(Le/fn),K>1)for(K>=D&&(K=D-1),X=p(De,K,D),Ee=X.length,Ae=Ce.length;g(X,Ce,Ee,Ae)==1;)K--,E(X,ut<Ee?or:De,Ee,D),Ee=X.length,R=1;else K==0&&(R=K=1),X=De.slice(),Ee=X.length;if(Ee<Ae&&(X=[0].concat(X)),E(Ce,X,Ae,D),Ae=Ce.length,R==-1)for(;g(De,Ce,ut,Ae)<1;)K++,E(Ce,ut<Ae?or:De,Ae,D),Ae=Ce.length}else R===0&&(K++,Ce=[0]);Be[O++]=K,Ce[0]?Ce[Ae++]=Ue[cn]||0:(Ce=[Ue[cn]],Ae=1)}while((cn++<ln||Ce[0]!=null)&&Ke--);M=Ce[0]!=null,Be[0]||Be.splice(0,1)}if(D==l){for(O=1,Ke=Be[0];Ke>=10;Ke/=10,O++);xe(Fe,k+(Fe.e=O+B*f-1)+1,q,M)}else Fe.e=B,Fe.r=+M;return Fe}}();function ge(p,g,E,x){var v,k,q,D,R;if(E==null?E=oe:y(E,0,8),!p.c)return p.toString();if(v=p.c[0],q=p.e,g==null)R=b(p.c),R=x==1||x==2&&(q<=ae||q>=Q)?F(R,q):L(R,q,"0");else if(p=xe(new H(p),g,E),k=p.e,R=b(p.c),D=R.length,x==1||x==2&&(g<=k||k<=ae)){for(;D<g;R+="0",D++);R=F(R,k)}else if(g-=q+(x===2&&k>q),R=L(R,k,"0"),k+1>D){if(--g>0)for(R+=".";g--;R+="0");}else if(g+=k-D,g>0)for(k+1==D&&(R+=".");g--;R+="0");return p.s<0&&v?"-"+R:R}function we(p,g){for(var E,x,v=1,k=new H(p[0]);v<p.length;v++)x=new H(p[v]),(!x.s||(E=_(k,x))===g||E===0&&k.s===g)&&(k=x);return k}function nr(p,g,E){for(var x=1,v=g.length;!g[--v];g.pop());for(v=g[0];v>=10;v/=10,x++);return(E=x+E*f-1)>he?p.c=p.e=null:E<ue?p.c=[p.e=0]:(p.e=E,p.c=g),p}te=function(){var p=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,E=/^\.([^.]+)$/,x=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(k,q,D,R){var B,O=D?q:q.replace(v,"");if(x.test(O))k.s=isNaN(O)?null:O<0?-1:1;else{if(!D&&(O=O.replace(p,function(M,K,X){return B=(X=X.toLowerCase())=="x"?16:X=="b"?2:8,!R||R==B?K:M}),R&&(B=R,O=O.replace(g,"$1").replace(E,"0.$1")),q!=O))return new H(O,B);if(H.DEBUG)throw Error(a+"Not a"+(R?" base "+R:"")+" number: "+q);k.s=null}k.c=k.e=null}}();function xe(p,g,E,x){var v,k,q,D,R,B,O,M=p.c,K=h;if(M){e:{for(v=1,D=M[0];D>=10;D/=10,v++);if(k=g-v,k<0)k+=f,q=g,R=M[B=0],O=s(R/K[v-q-1]%10);else if(B=n((k+1)/f),B>=M.length)if(x){for(;M.length<=B;M.push(0));R=O=0,v=1,k%=f,q=k-f+1}else break e;else{for(R=D=M[B],v=1;D>=10;D/=10,v++);k%=f,q=k-f+v,O=q<0?0:s(R/K[v-q-1]%10)}if(x=x||g<0||M[B+1]!=null||(q<0?R:R%K[v-q-1]),x=E<4?(O||x)&&(E==0||E==(p.s<0?3:2)):O>5||O==5&&(E==4||x||E==6&&(k>0?q>0?R/K[v-q]:0:M[B-1])%10&1||E==(p.s<0?8:7)),g<1||!M[0])return M.length=0,x?(g-=p.e+1,M[0]=K[(f-g%f)%f],p.e=-g||0):M[0]=p.e=0,p;if(k==0?(M.length=B,D=1,B--):(M.length=B+1,D=K[f-k],M[B]=q>0?s(R/K[v-q]%K[q])*D:0),x)for(;;)if(B==0){for(k=1,q=M[0];q>=10;q/=10,k++);for(q=M[0]+=D,D=1;q>=10;q/=10,D++);k!=D&&(p.e++,M[0]==l&&(M[0]=1));break}else{if(M[B]+=D,M[B]!=l)break;M[B--]=0,D=1}for(k=M.length;M[--k]===0;M.pop());}p.e>he?p.c=p.e=null:p.e<ue&&(p.c=[p.e=0])}return p}function Ie(p){var g,E=p.e;return E===null?p.toString():(g=b(p.c),g=E<=ae||E>=Q?F(g,E):L(g,E,"0"),p.s<0?"-"+g:g)}return W.absoluteValue=W.abs=function(){var p=new H(this);return p.s<0&&(p.s=1),p},W.comparedTo=function(p,g){return _(this,new H(p,g))},W.decimalPlaces=W.dp=function(p,g){var E,x,v,k=this;if(p!=null)return y(p,0,w),g==null?g=oe:y(g,0,8),xe(new H(k),p+k.e+1,g);if(!(E=k.c))return null;if(x=((v=E.length-1)-S(this.e/f))*f,v=E[v])for(;v%10==0;v/=10,x--);return x<0&&(x=0),x},W.dividedBy=W.div=function(p,g){return j(this,new H(p,g),de,oe)},W.dividedToIntegerBy=W.idiv=function(p,g){return j(this,new H(p,g),0,1)},W.exponentiatedBy=W.pow=function(p,g){var E,x,v,k,q,D,R,B,O,M=this;if(p=new H(p),p.c&&!p.isInteger())throw Error(a+"Exponent not an integer: "+Ie(p));if(g!=null&&(g=new H(g)),D=p.e>14,!M.c||!M.c[0]||M.c[0]==1&&!M.e&&M.c.length==1||!p.c||!p.c[0])return O=new H(Math.pow(+Ie(M),D?p.s*(2-T(p)):+Ie(p))),g?O.mod(g):O;if(R=p.s<0,g){if(g.c?!g.c[0]:!g.s)return new H(NaN);x=!R&&M.isInteger()&&g.isInteger(),x&&(M=M.mod(g))}else{if(p.e>9&&(M.e>0||M.e<-1||(M.e==0?M.c[0]>1||D&&M.c[1]>=24e7:M.c[0]<8e13||D&&M.c[0]<=9999975e7)))return k=M.s<0&&T(p)?-0:0,M.e>-1&&(k=1/k),new H(R?1/k:k);Y&&(k=n(Y/f+2))}for(D?(E=new H(.5),R&&(p.s=1),B=T(p)):(v=Math.abs(+Ie(p)),B=v%2),O=new H(be);;){if(B){if(O=O.times(M),!O.c)break;k?O.c.length>k&&(O.c.length=k):x&&(O=O.mod(g))}if(v){if(v=s(v/2),v===0)break;B=v%2}else if(p=p.times(E),xe(p,p.e+1,1),p.e>14)B=T(p);else{if(v=+Ie(p),v===0)break;B=v%2}M=M.times(M),k?M.c&&M.c.length>k&&(M.c.length=k):x&&(M=M.mod(g))}return x?O:(R&&(O=be.div(O)),g?O.mod(g):k?xe(O,Y,oe,q):O)},W.integerValue=function(p){var g=new H(this);return p==null?p=oe:y(p,0,8),xe(g,g.e+1,p)},W.isEqualTo=W.eq=function(p,g){return _(this,new H(p,g))===0},W.isFinite=function(){return!!this.c},W.isGreaterThan=W.gt=function(p,g){return _(this,new H(p,g))>0},W.isGreaterThanOrEqualTo=W.gte=function(p,g){return(g=_(this,new H(p,g)))===1||g===0},W.isInteger=function(){return!!this.c&&S(this.e/f)>this.c.length-2},W.isLessThan=W.lt=function(p,g){return _(this,new H(p,g))<0},W.isLessThanOrEqualTo=W.lte=function(p,g){return(g=_(this,new H(p,g)))===-1||g===0},W.isNaN=function(){return!this.s},W.isNegative=function(){return this.s<0},W.isPositive=function(){return this.s>0},W.isZero=function(){return!!this.c&&this.c[0]==0},W.minus=function(p,g){var E,x,v,k,q=this,D=q.s;if(p=new H(p,g),g=p.s,!D||!g)return new H(NaN);if(D!=g)return p.s=-g,q.plus(p);var R=q.e/f,B=p.e/f,O=q.c,M=p.c;if(!R||!B){if(!O||!M)return O?(p.s=-g,p):new H(M?q:NaN);if(!O[0]||!M[0])return M[0]?(p.s=-g,p):new H(O[0]?q:oe==3?-0:0)}if(R=S(R),B=S(B),O=O.slice(),D=R-B){for((k=D<0)?(D=-D,v=O):(B=R,v=M),v.reverse(),g=D;g--;v.push(0));v.reverse()}else for(x=(k=(D=O.length)<(g=M.length))?D:g,D=g=0;g<x;g++)if(O[g]!=M[g]){k=O[g]<M[g];break}if(k&&(v=O,O=M,M=v,p.s=-p.s),g=(x=M.length)-(E=O.length),g>0)for(;g--;O[E++]=0);for(g=l-1;x>D;){if(O[--x]<M[x]){for(E=x;E&&!O[--E];O[E]=g);--O[E],O[x]+=l}O[x]-=M[x]}for(;O[0]==0;O.splice(0,1),--B);return O[0]?nr(p,O,B):(p.s=oe==3?-1:1,p.c=[p.e=0],p)},W.modulo=W.mod=function(p,g){var E,x,v=this;return p=new H(p,g),!v.c||!p.s||p.c&&!p.c[0]?new H(NaN):!p.c||v.c&&!v.c[0]?new H(v):(J==9?(x=p.s,p.s=1,E=j(v,p,0,3),p.s=x,E.s*=x):E=j(v,p,0,J),p=v.minus(E.times(p)),!p.c[0]&&J==1&&(p.s=v.s),p)},W.multipliedBy=W.times=function(p,g){var E,x,v,k,q,D,R,B,O,M,K,X,Ee,Fe,Be,Ce=this,Ae=Ce.c,Le=(p=new H(p,g)).c;if(!Ae||!Le||!Ae[0]||!Le[0])return!Ce.s||!p.s||Ae&&!Ae[0]&&!Le||Le&&!Le[0]&&!Ae?p.c=p.e=p.s=null:(p.s*=Ce.s,!Ae||!Le?p.c=p.e=null:(p.c=[0],p.e=0)),p;for(x=S(Ce.e/f)+S(p.e/f),p.s*=Ce.s,R=Ae.length,M=Le.length,R<M&&(Ee=Ae,Ae=Le,Le=Ee,v=R,R=M,M=v),v=R+M,Ee=[];v--;Ee.push(0));for(Fe=l,Be=C,v=M;--v>=0;){for(E=0,K=Le[v]%Be,X=Le[v]/Be|0,q=R,k=v+q;k>v;)B=Ae[--q]%Be,O=Ae[q]/Be|0,D=X*B+O*K,B=K*B+D%Be*Be+Ee[k]+E,E=(B/Fe|0)+(D/Be|0)+X*O,Ee[k--]=B%Fe;Ee[k]=E}return E?++x:Ee.splice(0,1),nr(p,Ee,x)},W.negated=function(){var p=new H(this);return p.s=-p.s||null,p},W.plus=function(p,g){var E,x=this,v=x.s;if(p=new H(p,g),g=p.s,!v||!g)return new H(NaN);if(v!=g)return p.s=-g,x.minus(p);var k=x.e/f,q=p.e/f,D=x.c,R=p.c;if(!k||!q){if(!D||!R)return new H(v/0);if(!D[0]||!R[0])return R[0]?p:new H(D[0]?x:v*0)}if(k=S(k),q=S(q),D=D.slice(),v=k-q){for(v>0?(q=k,E=R):(v=-v,E=D),E.reverse();v--;E.push(0));E.reverse()}for(v=D.length,g=R.length,v-g<0&&(E=R,R=D,D=E,g=v),v=0;g;)v=(D[--g]=D[g]+R[g]+v)/l|0,D[g]=l===D[g]?0:D[g]%l;return v&&(D=[v].concat(D),++q),nr(p,D,q)},W.precision=W.sd=function(p,g){var E,x,v,k=this;if(p!=null&&p!==!!p)return y(p,1,w),g==null?g=oe:y(g,0,8),xe(new H(k),p,g);if(!(E=k.c))return null;if(v=E.length-1,x=v*f+1,v=E[v]){for(;v%10==0;v/=10,x--);for(v=E[0];v>=10;v/=10,x++);}return p&&k.e+1>x&&(x=k.e+1),x},W.shiftedBy=function(p){return y(p,-d,d),this.times("1e"+p)},W.squareRoot=W.sqrt=function(){var p,g,E,x,v,k=this,q=k.c,D=k.s,R=k.e,B=de+4,O=new H("0.5");if(D!==1||!q||!q[0])return new H(!D||D<0&&(!q||q[0])?NaN:q?k:1/0);if(D=Math.sqrt(+Ie(k)),D==0||D==1/0?(g=b(q),(g.length+R)%2==0&&(g+="0"),D=Math.sqrt(+g),R=S((R+1)/2)-(R<0||R%2),D==1/0?g="5e"+R:(g=D.toExponential(),g=g.slice(0,g.indexOf("e")+1)+R),E=new H(g)):E=new H(D+""),E.c[0]){for(R=E.e,D=R+B,D<3&&(D=0);;)if(v=E,E=O.times(v.plus(j(k,v,B,1))),b(v.c).slice(0,D)===(g=b(E.c)).slice(0,D))if(E.e<R&&--D,g=g.slice(D-3,D+1),g=="9999"||!x&&g=="4999"){if(!x&&(xe(v,v.e+de+2,0),v.times(v).eq(k))){E=v;break}B+=4,D+=4,x=1}else{(!+g||!+g.slice(1)&&g.charAt(0)=="5")&&(xe(E,E.e+de+2,1),p=!E.times(E).eq(k));break}}return xe(E,E.e+de+1,oe,p)},W.toExponential=function(p,g){return p!=null&&(y(p,0,w),p++),ge(this,p,g,1)},W.toFixed=function(p,g){return p!=null&&(y(p,0,w),p=p+this.e+1),ge(this,p,g)},W.toFormat=function(p,g,E){var x,v=this;if(E==null)p!=null&&g&&typeof g=="object"?(E=g,g=null):p&&typeof p=="object"?(E=p,p=g=null):E=ce;else if(typeof E!="object")throw Error(a+"Argument not an object: "+E);if(x=v.toFixed(p,g),v.c){var k,q=x.split("."),D=+E.groupSize,R=+E.secondaryGroupSize,B=E.groupSeparator||"",O=q[0],M=q[1],K=v.s<0,X=K?O.slice(1):O,Ee=X.length;if(R&&(k=D,D=R,R=k,Ee-=k),D>0&&Ee>0){for(k=Ee%D||D,O=X.substr(0,k);k<Ee;k+=D)O+=B+X.substr(k,D);R>0&&(O+=B+X.slice(k)),K&&(O="-"+O)}x=M?O+(E.decimalSeparator||"")+((R=+E.fractionGroupSize)?M.replace(new RegExp("\\d{"+R+"}\\B","g"),"$&"+(E.fractionGroupSeparator||"")):M):O}return(E.prefix||"")+x+(E.suffix||"")},W.toFraction=function(p){var g,E,x,v,k,q,D,R,B,O,M,K,X=this,Ee=X.c;if(p!=null&&(D=new H(p),!D.isInteger()&&(D.c||D.s!==1)||D.lt(be)))throw Error(a+"Argument "+(D.isInteger()?"out of range: ":"not an integer: ")+Ie(D));if(!Ee)return new H(X);for(g=new H(be),B=E=new H(be),x=R=new H(be),K=b(Ee),k=g.e=K.length-X.e-1,g.c[0]=h[(q=k%f)<0?f+q:q],p=!p||D.comparedTo(g)>0?k>0?g:B:D,q=he,he=1/0,D=new H(K),R.c[0]=0;O=j(D,g,0,1),v=E.plus(O.times(x)),v.comparedTo(p)!=1;)E=x,x=v,B=R.plus(O.times(v=B)),R=v,g=D.minus(O.times(v=g)),D=v;return v=j(p.minus(E),x,0,1),R=R.plus(v.times(B)),E=E.plus(v.times(x)),R.s=B.s=X.s,k=k*2,M=j(B,x,k,oe).minus(X).abs().comparedTo(j(R,E,k,oe).minus(X).abs())<1?[B,x]:[R,E],he=q,M},W.toNumber=function(){return+Ie(this)},W.toPrecision=function(p,g){return p!=null&&y(p,1,w),ge(this,p,g,2)},W.toString=function(p){var g,E=this,x=E.s,v=E.e;return v===null?x?(g="Infinity",x<0&&(g="-"+g)):g="NaN":(p==null?g=v<=ae||v>=Q?F(b(E.c),v):L(b(E.c),v,"0"):p===10&&ze?(E=xe(new H(E),de+v+1,oe),g=L(b(E.c),E.e,"0")):(y(p,2,Ne.length,"Base"),g=G(L(b(E.c),v,"0"),10,p,x,!0)),x<0&&E.c[0]&&(g="-"+g)),g},W.valueOf=W.toJSON=function(){return Ie(this)},W._isBigNumber=!0,P!=null&&H.set(P),H}function S(P){var j=P|0;return P>0||P===j?j:j-1}function b(P){for(var j,G,te=1,W=P.length,be=P[0]+"";te<W;){for(j=P[te++]+"",G=f-j.length;G--;j="0"+j);be+=j}for(W=be.length;be.charCodeAt(--W)===48;);return be.slice(0,W+1||1)}function _(P,j){var G,te,W=P.c,be=j.c,de=P.s,oe=j.s,ae=P.e,Q=j.e;if(!de||!oe)return null;if(G=W&&!W[0],te=be&&!be[0],G||te)return G?te?0:-oe:de;if(de!=oe)return de;if(G=de<0,te=ae==Q,!W||!be)return te?0:!W^G?1:-1;if(!te)return ae>Q^G?1:-1;for(oe=(ae=W.length)<(Q=be.length)?ae:Q,de=0;de<oe;de++)if(W[de]!=be[de])return W[de]>be[de]^G?1:-1;return ae==Q?0:ae>Q^G?1:-1}function y(P,j,G,te){if(P<j||P>G||P!==s(P))throw Error(a+(te||"Argument")+(typeof P=="number"?P<j||P>G?" out of range: ":" not an integer: ":" not a primitive number: ")+String(P))}function T(P){var j=P.c.length-1;return S(P.e/f)==j&&P.c[j]%2!=0}function F(P,j){return(P.length>1?P.charAt(0)+"."+P.slice(1):P)+(j<0?"e":"e+")+j}function L(P,j,G){var te,W;if(j<0){for(W=G+".";++j;W+=G);P=W+P}else if(te=P.length,++j>te){for(W=G,j-=te;--j;W+=G);P+=W}else j<te&&(P=P.slice(0,j)+"."+P.slice(j));return P}e=I(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof Xs<"u"&&Xs.exports?Xs.exports=e:(r||(r=typeof self<"u"&&self?self:window),r.BigNumber=e)})(Ih)});var Lh=z((ZD,jh)=>{var Nh=Eu(),qh=jh.exports;(function(){"use strict";function r(d){return d<10?"0"+d:d}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,s,a={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},u;function l(d){return t.lastIndex=0,t.test(d)?'"'+d.replace(t,function(h){var C=a[h];return typeof C=="string"?C:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+d+'"'}function f(d,h){var C,w,I,S,b=n,_,y=h[d],T=y!=null&&(y instanceof Nh||Nh.isBigNumber(y));switch(y&&typeof y=="object"&&typeof y.toJSON=="function"&&(y=y.toJSON(d)),typeof u=="function"&&(y=u.call(h,d,y)),typeof y){case"string":return T?y:l(y);case"number":return isFinite(y)?String(y):"null";case"boolean":case"null":case"bigint":return String(y);case"object":if(!y)return"null";if(n+=s,_=[],Object.prototype.toString.apply(y)==="[object Array]"){for(S=y.length,C=0;C<S;C+=1)_[C]=f(C,y)||"null";return I=_.length===0?"[]":n?`[
`+n+_.join(`,
`+n)+`
`+b+"]":"["+_.join(",")+"]",n=b,I}if(u&&typeof u=="object")for(S=u.length,C=0;C<S;C+=1)typeof u[C]=="string"&&(w=u[C],I=f(w,y),I&&_.push(l(w)+(n?": ":":")+I));else Object.keys(y).forEach(function(F){var L=f(F,y);L&&_.push(l(F)+(n?": ":":")+L)});return I=_.length===0?"{}":n?`{
`+n+_.join(`,
`+n)+`
`+b+"}":"{"+_.join(",")+"}",n=b,I}}typeof qh.stringify!="function"&&(qh.stringify=function(d,h,C){var w;if(n="",s="",typeof C=="number")for(w=0;w<C;w+=1)s+=" ";else typeof C=="string"&&(s=C);if(u=h,h&&typeof h!="function"&&(typeof h!="object"||typeof h.length!="number"))throw new Error("JSON.stringify");return f("",{"":d})})})()});var Mh=z((eS,Uh)=>{var Qs=null,z_=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,J_=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,V_=function(r){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(r!=null){if(r.strict===!0&&(e.strict=!0),r.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=r.alwaysParseAsBig===!0?r.alwaysParseAsBig:!1,e.useNativeBigInt=r.useNativeBigInt===!0?r.useNativeBigInt:!1,typeof r.constructorAction<"u")if(r.constructorAction==="error"||r.constructorAction==="ignore"||r.constructorAction==="preserve")e.constructorAction=r.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${r.constructorAction}`);if(typeof r.protoAction<"u")if(r.protoAction==="error"||r.protoAction==="ignore"||r.protoAction==="preserve")e.protoAction=r.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${r.protoAction}`)}var t,n,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},a,u=function(b){throw{name:"SyntaxError",message:b,at:t,text:a}},l=function(b){return b&&b!==n&&u("Expected '"+b+"' instead of '"+n+"'"),n=a.charAt(t),t+=1,n},f=function(){var b,_="";for(n==="-"&&(_="-",l("-"));n>="0"&&n<="9";)_+=n,l();if(n===".")for(_+=".";l()&&n>="0"&&n<="9";)_+=n;if(n==="e"||n==="E")for(_+=n,l(),(n==="-"||n==="+")&&(_+=n,l());n>="0"&&n<="9";)_+=n,l();if(b=+_,!isFinite(b))u("Bad number");else return Qs==null&&(Qs=Eu()),_.length>15?e.storeAsString?_:e.useNativeBigInt?BigInt(_):new Qs(_):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(b):new Qs(b):b},d=function(){var b,_,y="",T;if(n==='"')for(var F=t;l();){if(n==='"')return t-1>F&&(y+=a.substring(F,t-1)),l(),y;if(n==="\\"){if(t-1>F&&(y+=a.substring(F,t-1)),l(),n==="u"){for(T=0,_=0;_<4&&(b=parseInt(l(),16),!!isFinite(b));_+=1)T=T*16+b;y+=String.fromCharCode(T)}else if(typeof s[n]=="string")y+=s[n];else break;F=t}}u("Bad string")},h=function(){for(;n&&n<=" ";)l()},C=function(){switch(n){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}u("Unexpected '"+n+"'")},w,I=function(){var b=[];if(n==="["){if(l("["),h(),n==="]")return l("]"),b;for(;n;){if(b.push(w()),h(),n==="]")return l("]"),b;l(","),h()}}u("Bad array")},S=function(){var b,_=Object.create(null);if(n==="{"){if(l("{"),h(),n==="}")return l("}"),_;for(;n;){if(b=d(),h(),l(":"),e.strict===!0&&Object.hasOwnProperty.call(_,b)&&u('Duplicate key "'+b+'"'),z_.test(b)===!0?e.protoAction==="error"?u("Object contains forbidden prototype property"):e.protoAction==="ignore"?w():_[b]=w():J_.test(b)===!0?e.constructorAction==="error"?u("Object contains forbidden constructor property"):e.constructorAction==="ignore"?w():_[b]=w():_[b]=w(),h(),n==="}")return l("}"),_;l(","),h()}}u("Bad object")};return w=function(){switch(h(),n){case"{":return S();case"[":return I();case'"':return d();case"-":return f();default:return n>="0"&&n<="9"?f():C()}},function(b,_){var y;return a=b+"",t=0,n=" ",y=w(),h(),n&&u("Syntax error"),typeof _=="function"?function T(F,L){var P,j,G=F[L];return G&&typeof G=="object"&&Object.keys(G).forEach(function(te){j=T(G,te),j!==void 0?G[te]=j:delete G[te]}),_.call(F,L,G)}({"":y},""):y}};Uh.exports=V_});var Gh=z((tS,Zs)=>{var $h=Lh().stringify,Hh=Mh();Zs.exports=function(r){return{parse:Hh(r),stringify:$h}};Zs.exports.parse=Hh();Zs.exports.stringify=$h});var wu=z(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.GCE_LINUX_BIOS_PATHS=void 0;Lt.isGoogleCloudServerless=Jh;Lt.isGoogleComputeEngineLinux=Vh;Lt.isGoogleComputeEngineMACAddress=Kh;Lt.isGoogleComputeEngine=Yh;Lt.detectGCPResidency=Y_;var Wh=require("fs"),zh=require("os");Lt.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};var K_=/^42:01/;function Jh(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function Vh(){if((0,zh.platform)()!=="linux")return!1;try{(0,Wh.statSync)(Lt.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let r=(0,Wh.readFileSync)(Lt.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(r)}catch{return!1}}function Kh(){let r=(0,zh.networkInterfaces)();for(let e of Object.values(r))if(e){for(let{mac:t}of e)if(K_.test(t))return!0}return!1}function Yh(){return Vh()||Kh()}function Y_(){return Jh()||Yh()}});var Xh=z(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.Colours=void 0;var Qe=class r{static isEnabled(e){return e&&e.isTTY&&(typeof e.getColorDepth=="function"?e.getColorDepth()>2:!0)}static refresh(){r.enabled=r.isEnabled(process==null?void 0:process.stderr),this.enabled?(r.reset="\x1B[0m",r.bright="\x1B[1m",r.dim="\x1B[2m",r.red="\x1B[31m",r.green="\x1B[32m",r.yellow="\x1B[33m",r.blue="\x1B[34m",r.magenta="\x1B[35m",r.cyan="\x1B[36m",r.white="\x1B[37m",r.grey="\x1B[90m"):(r.reset="",r.bright="",r.dim="",r.red="",r.green="",r.yellow="",r.blue="",r.magenta="",r.cyan="",r.white="",r.grey="")}};ei.Colours=Qe;Qe.enabled=!1;Qe.reset="";Qe.bright="";Qe.dim="";Qe.red="";Qe.green="";Qe.yellow="";Qe.blue="";Qe.magenta="";Qe.cyan="";Qe.white="";Qe.grey="";Qe.refresh()});var tp=z(Se=>{"use strict";var X_=Se&&Se.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Q_=Se&&Se.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Qh=Se&&Se.__importStar||function(){var r=function(e){return r=Object.getOwnPropertyNames||function(t){var n=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[n.length]=s);return n},r(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=r(e),s=0;s<n.length;s++)n[s]!=="default"&&X_(t,e,n[s]);return Q_(t,e),t}}();Object.defineProperty(Se,"__esModule",{value:!0});Se.env=Se.DebugLogBackendBase=Se.placeholder=Se.AdhocDebugLogger=Se.LogSeverity=void 0;Se.getNodeBackend=Du;Se.getDebugBackend=eC;Se.getStructuredBackend=tC;Se.setBackend=rC;Se.log=ep;var Z_=require("events"),Co=Qh(require("process")),Zh=Qh(require("util")),pt=Xh(),Ut;(function(r){r.DEFAULT="DEFAULT",r.DEBUG="DEBUG",r.INFO="INFO",r.WARNING="WARNING",r.ERROR="ERROR"})(Ut||(Se.LogSeverity=Ut={}));var bo=class extends Z_.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(n,s)=>this.on(n,s)}),this.func.debug=(...n)=>this.invokeSeverity(Ut.DEBUG,...n),this.func.info=(...n)=>this.invokeSeverity(Ut.INFO,...n),this.func.warn=(...n)=>this.invokeSeverity(Ut.WARNING,...n),this.func.error=(...n)=>this.invokeSeverity(Ut.ERROR,...n),this.func.sublog=n=>ep(n,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch{}try{this.emit("log",e,t)}catch{}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}};Se.AdhocDebugLogger=bo;Se.placeholder=new bo("",()=>{}).func;var Pn=class{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let t=(e=Co.env[Se.env.nodeEnables])!==null&&e!==void 0?e:"*";t==="all"&&(t="*"),this.filters=t.split(",")}log(e,t,...n){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let s=this.cached.get(e);s||(s=this.makeLogger(e),this.cached.set(e,s)),s(t,...n)}catch(s){console.error(s)}}};Se.DebugLogBackendBase=Pn;var Au=class extends Pn{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...n)=>{var s;let a=`${pt.Colours.green}${e}${pt.Colours.reset}`,u=`${pt.Colours.yellow}${Co.pid}${pt.Colours.reset}`,l;switch(t.severity){case Ut.ERROR:l=`${pt.Colours.red}${t.severity}${pt.Colours.reset}`;break;case Ut.INFO:l=`${pt.Colours.magenta}${t.severity}${pt.Colours.reset}`;break;case Ut.WARNING:l=`${pt.Colours.yellow}${t.severity}${pt.Colours.reset}`;break;default:l=(s=t.severity)!==null&&s!==void 0?s:Ut.DEFAULT;break}let f=Zh.formatWithOptions({colors:pt.Colours.enabled},...n),d=Object.assign({},t);delete d.severity;let h=Object.getOwnPropertyNames(d).length?JSON.stringify(d):"",C=h?`${pt.Colours.grey}${h}${pt.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",u,a,l,f,h?` ${C}`:"")}:()=>{}}setFilters(){let t=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=new RegExp(`^${t}$`,"i")}};function Du(){return new Au}var Su=class extends Pn{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(n,...s)=>{t(s[0],...s.slice(1))}}setFilters(){var e;let t=(e=Co.env.NODE_DEBUG)!==null&&e!==void 0?e:"";Co.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}};function eC(r){return new Su(r)}var vu=class extends Pn{constructor(e){var t;super(),this.upstream=(t=e)!==null&&t!==void 0?t:void 0}makeLogger(e){var t;let n=(t=this.upstream)===null||t===void 0?void 0:t.makeLogger(e);return(s,...a)=>{var u;let l=(u=s.severity)!==null&&u!==void 0?u:Ut.INFO,f=Object.assign({severity:l,message:Zh.format(...a)},s),d=JSON.stringify(f);n?n(s,d):console.log("%s",d)}}setFilters(){var e;(e=this.upstream)===null||e===void 0||e.setFilters()}};function tC(r){return new vu(r)}Se.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};var Tu=new Map,mt;function rC(r){mt=r,Tu.clear()}function ep(r,e){if(!mt&&!Co.env[Se.env.nodeEnables]||!r)return Se.placeholder;e&&(r=`${e.instance.namespace}:${r}`);let t=Tu.get(r);if(t)return t.func;if(mt===null)return Se.placeholder;mt===void 0&&(mt=Du());let n=(()=>{let s;return new bo(r,(u,...l)=>{if(s!==mt){if(mt===null)return;mt===void 0&&(mt=Du()),s=mt}mt?.log(r,u,...l)})})();return Tu.set(r,n),n.func}});var Ru=z(nn=>{"use strict";var nC=nn&&nn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),oC=nn&&nn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&nC(e,r,t)};Object.defineProperty(nn,"__esModule",{value:!0});oC(tp(),nn)});var wo=z(se=>{"use strict";var np=se&&se.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),sC=se&&se.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),iC=se&&se.__importStar||function(){var r=function(e){return r=Object.getOwnPropertyNames||function(t){var n=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[n.length]=s);return n},r(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=r(e),s=0;s<n.length;s++)n[s]!=="default"&&np(t,e,n[s]);return sC(t,e),t}}(),aC=se&&se.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&np(e,r,t)};Object.defineProperty(se,"__esModule",{value:!0});se.gcpResidencyCache=se.METADATA_SERVER_DETECTION=se.HEADERS=se.HEADER_VALUE=se.HEADER_NAME=se.SECONDARY_HOST_ADDRESS=se.HOST_ADDRESS=se.BASE_PATH=void 0;se.instance=hC;se.project=pC;se.universe=mC;se.bulk=gC;se.isAvailable=_C;se.resetIsAvailableCache=CC;se.getGCPResidency=Ou;se.setGCPResidency=op;se.requestTimeout=sp;var ku=Ve(),uC=Gh(),cC=wu(),lC=iC(Ru());se.BASE_PATH="/computeMetadata/v1";se.HOST_ADDRESS="http://169.254.169.254";se.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.";se.HEADER_NAME="Metadata-Flavor";se.HEADER_VALUE="Google";se.HEADERS=Object.freeze({[se.HEADER_NAME]:se.HEADER_VALUE});var rp=lC.log("gcp-metadata");se.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"});function Fu(r){return r||(r=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||se.HOST_ADDRESS),/^https?:\/\//.test(r)||(r=`http://${r}`),new URL(se.BASE_PATH,r).href}function fC(r){Object.keys(r).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw new Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw new Error(`'${e}' is not a valid configuration option.`)}})}async function Eo(r,e={},t=3,n=!1){let s=new Headers(se.HEADERS),a="",u={};if(typeof r=="object"){let C=r;new Headers(C.headers).forEach((w,I)=>s.set(I,w)),a=C.metadataKey,u=C.params||u,t=C.noResponseRetries||t,n=C.fastFail||n}else a=r;typeof e=="string"?a+=`/${e}`:(fC(e),e.property&&(a+=`/${e.property}`),new Headers(e.headers).forEach((C,w)=>s.set(w,C)),u=e.params||u);let l=n?dC:ku.request,f={url:`${Fu()}/${a}`,headers:s,retryConfig:{noResponseRetries:t},params:u,responseType:"text",timeout:sp()};rp.info("instance request %j",f);let d=await l(f);rp.info("instance metadata is %s",d.data);let h=d.headers.get(se.HEADER_NAME);if(h!==se.HEADER_VALUE)throw new RangeError(`Invalid response from metadata service: incorrect ${se.HEADER_NAME} header. Expected '${se.HEADER_VALUE}', got ${h?`'${h}'`:"no header"}`);if(typeof d.data=="string")try{return uC.parse(d.data)}catch{}return d.data}async function dC(r){let e={...r,url:r.url?.toString().replace(Fu(),Fu(se.SECONDARY_HOST_ADDRESS))},t=(0,ku.request)(r),n=(0,ku.request)(e);return Promise.any([t,n])}function hC(r){return Eo("instance",r)}function pC(r){return Eo("project",r)}function mC(r){return Eo("universe",r)}async function gC(r){let e={};return await Promise.all(r.map(t=>(async()=>{let n=await Eo(t),s=t.metadataKey;e[s]=n})())),e}function yC(){return process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0}var ti;async function _C(){if(process.env.METADATA_SERVER_DETECTION){let r=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(r in se.METADATA_SERVER_DETECTION))throw new RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${r}\`, but it should be \`${Object.keys(se.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(r){case"assume-present":return!0;case"none":return!1;case"bios-only":return Ou();case"ping-only":}}try{return ti===void 0&&(ti=Eo("instance",void 0,yC(),!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await ti,!0}catch(r){let e=r;if(process.env.DEBUG_AUTH&&console.info(e),e.type==="request-timeout"||e.response&&e.response.status===404)return!1;if(!(e.response&&e.response.status===404)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function CC(){ti=void 0}se.gcpResidencyCache=null;function Ou(){return se.gcpResidencyCache===null&&op(),se.gcpResidencyCache}function op(r=null){se.gcpResidencyCache=r!==null?r:(0,cC.detectGCPResidency)()}function sp(){return Ou()?0:3e3}aC(wu(),se)});var up=z(ri=>{"use strict";ri.byteLength=EC;ri.toByteArray=AC;ri.fromByteArray=vC;var Yt=[],Tt=[],bC=typeof Uint8Array<"u"?Uint8Array:Array,Pu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(on=0,ip=Pu.length;on<ip;++on)Yt[on]=Pu[on],Tt[Pu.charCodeAt(on)]=on;var on,ip;Tt[45]=62;Tt[95]=63;function ap(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function EC(r){var e=ap(r),t=e[0],n=e[1];return(t+n)*3/4-n}function wC(r,e,t){return(e+t)*3/4-t}function AC(r){var e,t=ap(r),n=t[0],s=t[1],a=new bC(wC(r,n,s)),u=0,l=s>0?n-4:n,f;for(f=0;f<l;f+=4)e=Tt[r.charCodeAt(f)]<<18|Tt[r.charCodeAt(f+1)]<<12|Tt[r.charCodeAt(f+2)]<<6|Tt[r.charCodeAt(f+3)],a[u++]=e>>16&255,a[u++]=e>>8&255,a[u++]=e&255;return s===2&&(e=Tt[r.charCodeAt(f)]<<2|Tt[r.charCodeAt(f+1)]>>4,a[u++]=e&255),s===1&&(e=Tt[r.charCodeAt(f)]<<10|Tt[r.charCodeAt(f+1)]<<4|Tt[r.charCodeAt(f+2)]>>2,a[u++]=e>>8&255,a[u++]=e&255),a}function DC(r){return Yt[r>>18&63]+Yt[r>>12&63]+Yt[r>>6&63]+Yt[r&63]}function SC(r,e,t){for(var n,s=[],a=e;a<t;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),s.push(DC(n));return s.join("")}function vC(r){for(var e,t=r.length,n=t%3,s=[],a=16383,u=0,l=t-n;u<l;u+=a)s.push(SC(r,u,u+a>l?l:u+a));return n===1?(e=r[t-1],s.push(Yt[e>>2]+Yt[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(Yt[e>>10]+Yt[e>>4&63]+Yt[e<<2&63]+"=")),s.join("")}});var Bu=z(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});xu.fromArrayBufferToHex=TC;function TC(r){return Array.from(new Uint8Array(r)).map(t=>t.toString(16).padStart(2,"0")).join("")}});var cp=z(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.BrowserCrypto=void 0;var xn=up(),RC=Bu(),Iu=class r{constructor(){if(typeof window>"u"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return xn.fromByteArray(new Uint8Array(n))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),xn.fromByteArray(t)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,t,n){let s={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},a=new TextEncoder().encode(t),u=xn.toByteArray(r.padBase64(n)),l=await window.crypto.subtle.importKey("jwk",e,s,!0,["verify"]);return await window.crypto.subtle.verify(s,l,u,a)}async sign(e,t){let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),a=await window.crypto.subtle.importKey("jwk",e,n,!0,["sign"]),u=await window.crypto.subtle.sign(n,a,s);return xn.fromByteArray(new Uint8Array(u))}decodeBase64StringUtf8(e){let t=xn.toByteArray(r.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return xn.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return(0,RC.fromArrayBufferToHex)(n)}async signWithHmacSha256(e,t){let n=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),s=new TextEncoder,a=await window.crypto.subtle.importKey("raw",s.encode(n),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",a,s.encode(t))}};ni.BrowserCrypto=Iu});var lp=z(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.NodeCrypto=void 0;var Bn=require("crypto"),Nu=class{async sha256DigestBase64(e){return Bn.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return Bn.randomBytes(e).toString("base64")}async verify(e,t,n){let s=Bn.createVerify("RSA-SHA256");return s.update(t),s.end(),s.verify(e,n,"base64")}async sign(e,t){let n=Bn.createSign("RSA-SHA256");return n.update(t),n.end(),n.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return Bn.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){let n=typeof e=="string"?e:FC(e);return kC(Bn.createHmac("sha256",n).update(t).digest())}};oi.NodeCrypto=Nu;function kC(r){return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function FC(r){return Buffer.from(r)}});var Ao=z(gr=>{"use strict";var OC=gr&&gr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),PC=gr&&gr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&OC(e,r,t)};Object.defineProperty(gr,"__esModule",{value:!0});gr.createCrypto=IC;gr.hasBrowserCrypto=fp;var xC=cp(),BC=lp();PC(Bu(),gr);function IC(){return fp()?new xC.BrowserCrypto:new BC.NodeCrypto}function fp(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}});var In=z((qu,hp)=>{var si=require("buffer"),Xt=si.Buffer;function dp(r,e){for(var t in r)e[t]=r[t]}Xt.from&&Xt.alloc&&Xt.allocUnsafe&&Xt.allocUnsafeSlow?hp.exports=si:(dp(si,qu),qu.Buffer=sn);function sn(r,e,t){return Xt(r,e,t)}sn.prototype=Object.create(Xt.prototype);dp(Xt,sn);sn.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return Xt(r,e,t)};sn.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=Xt(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};sn.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Xt(r)};sn.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return si.SlowBuffer(r)}});var mp=z((dS,pp)=>{"use strict";function ju(r){var e=(r/8|0)+(r%8===0?0:1);return e}var NC={ES256:ju(256),ES384:ju(384),ES512:ju(521)};function qC(r){var e=NC[r];if(e)return e;throw new Error('Unknown algorithm "'+r+'"')}pp.exports=qC});var Lu=z((hS,Ep)=>{"use strict";var ii=In().Buffer,yp=mp(),ai=128,_p=0,jC=32,LC=16,UC=2,Cp=LC|jC|_p<<6,ui=UC|_p<<6;function MC(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function bp(r){if(ii.isBuffer(r))return r;if(typeof r=="string")return ii.from(r,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function $C(r,e){r=bp(r);var t=yp(e),n=t+1,s=r.length,a=0;if(r[a++]!==Cp)throw new Error('Could not find expected "seq"');var u=r[a++];if(u===(ai|1)&&(u=r[a++]),s-a<u)throw new Error('"seq" specified length of "'+u+'", only "'+(s-a)+'" remaining');if(r[a++]!==ui)throw new Error('Could not find expected "int" for "r"');var l=r[a++];if(s-a-2<l)throw new Error('"r" specified length of "'+l+'", only "'+(s-a-2)+'" available');if(n<l)throw new Error('"r" specified length of "'+l+'", max of "'+n+'" is acceptable');var f=a;if(a+=l,r[a++]!==ui)throw new Error('Could not find expected "int" for "s"');var d=r[a++];if(s-a!==d)throw new Error('"s" specified length of "'+d+'", expected "'+(s-a)+'"');if(n<d)throw new Error('"s" specified length of "'+d+'", max of "'+n+'" is acceptable');var h=a;if(a+=d,a!==s)throw new Error('Expected to consume entire buffer, but "'+(s-a)+'" bytes remain');var C=t-l,w=t-d,I=ii.allocUnsafe(C+l+w+d);for(a=0;a<C;++a)I[a]=0;r.copy(I,a,f+Math.max(-C,0),f+l),a=t;for(var S=a;a<S+w;++a)I[a]=0;return r.copy(I,a,h+Math.max(-w,0),h+d),I=I.toString("base64"),I=MC(I),I}function gp(r,e,t){for(var n=0;e+n<t&&r[e+n]===0;)++n;var s=r[e+n]>=ai;return s&&--n,n}function HC(r,e){r=bp(r);var t=yp(e),n=r.length;if(n!==t*2)throw new TypeError('"'+e+'" signatures must be "'+t*2+'" bytes, saw "'+n+'"');var s=gp(r,0,t),a=gp(r,t,r.length),u=t-s,l=t-a,f=2+u+1+1+l,d=f<ai,h=ii.allocUnsafe((d?2:3)+f),C=0;return h[C++]=Cp,d?h[C++]=f:(h[C++]=ai|1,h[C++]=f&255),h[C++]=ui,h[C++]=u,s<0?(h[C++]=0,C+=r.copy(h,C,0,t)):C+=r.copy(h,C,s,t),h[C++]=ui,h[C++]=l,a<0?(h[C++]=0,r.copy(h,C,t)):r.copy(h,C,t+a),h}Ep.exports={derToJose:$C,joseToDer:HC}});var Mt=z(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.LRUCache=void 0;yr.snakeToCamel=Ap;yr.originalOrCamelOptions=JC;yr.removeUndefinedValuesInObject=VC;yr.isValidFile=KC;yr.getWellKnownCertificateConfigFileLocation=YC;var GC=require("fs"),WC=require("os"),Uu=require("path"),zC="certificate_config.json",wp="gcloud";function Ap(r){return r.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}function JC(r){function e(t){let n=r||{};return n[t]??n[Ap(t)]}return{get:e}}var Mu=class{capacity;#e=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#t(e,t){this.#e.delete(e),this.#e.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#t(e,t),this.#r()}get(e){let t=this.#e.get(e);if(t)return this.#t(e,t.value),this.#r(),t.value}#r(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#e.entries().next();for(;!t.done&&(this.#e.size>this.capacity||t.value[1].lastAccessed<e);)this.#e.delete(t.value[0]),t=this.#e.entries().next()}};yr.LRUCache=Mu;function VC(r){return Object.entries(r).forEach(([e,t])=>{(t===void 0||t==="undefined")&&delete r[e]}),r}async function KC(r){try{return(await GC.promises.lstat(r)).isFile()}catch{return!1}}function YC(){let r=process.env.CLOUDSDK_CONFIG||(XC()?Uu.join(process.env.APPDATA||"",wp):Uu.join(process.env.HOME||"",".config",wp));return Uu.join(r,zC)}function XC(){return WC.platform().startsWith("win")}});var Dp=z((mS,QC)=>{QC.exports={name:"google-auth-library",version:"10.2.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^7.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^4.0.0","jsdoc-region-tag":"^3.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",linkinator:"^6.1.2",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.1","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"^5.1.6",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"linkinator docs","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"}});var $u=z(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.USER_AGENT=Nr.PRODUCT_NAME=Nr.pkg=void 0;var Sp=Dp();Nr.pkg=Sp;var vp="google-api-nodejs-client";Nr.PRODUCT_NAME=vp;var ZC=`${vp}/${Sp.version}`;Nr.USER_AGENT=ZC});var gt=z($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.AuthClient=$t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=$t.DEFAULT_UNIVERSE=void 0;var eb=require("events"),Hu=Ve(),tb=Mt(),rb=Ru(),Gu=$u();$t.DEFAULT_UNIVERSE="googleapis.com";$t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=5*60*1e3;var Wu=class r extends eb.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=$t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=$t.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let t=(0,tb.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=t.get("project_id")??null,this.quotaProjectId=t.get("quota_project_id"),this.credentials=t.get("credentials")??{},this.universeDomain=t.get("universe_domain")??$t.DEFAULT_UNIVERSE,this.transporter=e.transporter??new Hu.Gaxios(e.transporterOptions),t.get("useAuthRequestParameters")!==!1&&(this.transporter.interceptors.request.add(r.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(r.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t=e[0],n=e[1],s,a=new Headers;return typeof t=="string"?s=new URL(t):t instanceof URL?s=t:t&&t.url&&(s=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&Hu.Gaxios.mergeHeaders(a,t.headers),n&&Hu.Gaxios.mergeHeaders(a,new Headers(n.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...n,...t,headers:a,url:s}):this.request({...n,headers:a,url:s})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let n=t.get("x-goog-user-project"),s=t.get("authorization");return n&&e.set("x-goog-user-project",n),s&&e.set("authorization",s),e}static log=(0,rb.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let n=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${n}`)}let t=e.headers.get("User-Agent");t?t.includes(`${Gu.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${Gu.USER_AGENT}`):e.headers.set("User-Agent",Gu.USER_AGENT);try{let n=e,s=n[r.RequestMethodNameSymbol],a=`${Math.floor(Math.random()*1e3)}`;n[r.RequestLogIdSymbol]=a;let u={url:e.url,headers:e.headers};s?r.log.info("%s [%s] request %j",s,a,u):r.log.info("[%s] request %j",a,u)}catch{}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,n=t[r.RequestMethodNameSymbol],s=t[r.RequestLogIdSymbol];n?r.log.info("%s [%s] response %j",n,s,e.data):r.log.info("[%s] response %j",s,e.data)}catch{}return e},rejected:async e=>{try{let t=e.config,n=t[r.RequestMethodNameSymbol],s=t[r.RequestLogIdSymbol];n?r.log.info("%s [%s] error %j",n,s,e.response?.data):r.log.error("[%s] error %j",s,e.response?.data)}catch{}throw e}};static setMethodName(e,t){try{let n=e;n[r.RequestMethodNameSymbol]=t}catch{}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};$t.AuthClient=Wu});var Ju=z(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.LoginTicket=void 0;var zu=class{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};ci.LoginTicket=zu});var an=z(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.OAuth2Client=Qt.ClientAuthentication=Qt.CertificateFormat=Qt.CodeChallengeMethod=void 0;var Tp=Ve(),nb=require("querystring"),ob=require("stream"),sb=Lu(),Rp=Mt(),Vu=Ao(),Nn=gt(),ib=Ju(),kp;(function(r){r.Plain="plain",r.S256="S256"})(kp||(Qt.CodeChallengeMethod=kp={}));var _r;(function(r){r.PEM="PEM",r.JWK="JWK"})(_r||(Qt.CertificateFormat=_r={}));var Do;(function(r){r.ClientSecretPost="ClientSecretPost",r.ClientSecretBasic="ClientSecretBasic",r.None="None"})(Do||(Qt.ClientAuthentication=Do={}));var Ku=class r extends Nn.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=_r.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,n){super(typeof e=="object"?e:{}),typeof e!="object"&&(e={clientId:e,clientSecret:t,redirectUri:n}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||Do.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+nb.stringify(e)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,Vu.createCrypto)(),n=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),a=(await e.sha256DigestBase64(n)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:n,codeChallenge:a}}getToken(e,t){let n=typeof e=="string"?{code:e}:e;if(t)this.getTokenAsync(n).then(s=>t(null,s.tokens,s.res),s=>t(s,null,s.response));else return this.getTokenAsync(n)}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),n=new Headers,s={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===Do.ClientSecretBasic){let f=Buffer.from(`${this._clientId}:${this._clientSecret}`);n.set("authorization",`Basic ${f.toString("base64")}`)}this.clientAuthentication===Do.ClientSecretPost&&(s.client_secret=this._clientSecret);let a={...r.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,Rp.removeUndefinedValuesInObject)(s)),headers:n};Nn.AuthClient.setMethodName(a,"getTokenAsync");let u=await this.transporter.request(a),l=u.data;return u.data&&u.data.expires_in&&(l.expiry_date=new Date().getTime()+u.data.expires_in*1e3,delete l.expires_in),this.emit("tokens",l),{tokens:l,res:u}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(n=>(this.refreshTokenPromises.delete(e),n),n=>{throw this.refreshTokenPromises.delete(e),n});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){if(!e)throw new Error("No refresh token is set.");let t=this.endpoints.oauth2TokenUrl.toString(),n={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},s;try{let u={...r.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,Rp.removeUndefinedValuesInObject)(n))};Nn.AuthClient.setMethodName(u,"refreshTokenNoCache"),s=await this.transporter.request(u)}catch(u){throw u instanceof Tp.GaxiosError&&u.message==="invalid_grant"&&u.response?.data&&/ReAuth/i.test(u.response.data.error_description)&&(u.message=JSON.stringify(u.response.data)),u}let a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+s.data.expires_in*1e3,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}refreshAccessToken(e){if(e)this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(e)this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let n=await this.processAndValidateRefreshHandler();if(n?.access_token)return this.setCredentials(n),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let t=await this.refreshAccessTokenAsync();if(!t.credentials||t.credentials&&!t.credentials.access_token)throw new Error("Could not refresh access token.");return{token:t.credentials.access_token,res:t.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let l=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(l)}}if(this.refreshHandler){let l=await this.processAndValidateRefreshHandler();if(l?.access_token){this.setCredentials(l);let f=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(f)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let n=null,s=null;try{n=await this.refreshToken(t.refresh_token),s=n.tokens}catch(l){let f=l;throw f.response&&(f.response.status===403||f.response.status===404)&&(f.message=`Could not refresh access token: ${f.message}`),f}let a=this.credentials;a.token_type=a.token_type||"Bearer",s.refresh_token=a.refresh_token,this.credentials=s;let u=new Headers({authorization:a.token_type+" "+s.access_token});return{headers:this.addSharedMetadataHeaders(u),res:n.res}}static getRevokeTokenUrl(e){return new r().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let n={...r.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(Nn.AuthClient.setMethodName(n,"revokeToken"),t)this.transporter.request(n).then(s=>t(null,s),t);else return this.transporter.request(n)}revokeCredentials(e){if(e)this.revokeCredentialsAsync().then(t=>e(null,t),e);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw new Error("No access token to revoke.")}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){try{let n=await this.getRequestMetadataAsync();return e.headers=Tp.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,n.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(n){let s=n.response;if(s){let a=s.status,u=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),l=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,f=s.config.data instanceof ob.Readable,d=a===401||a===403;if(!t&&d&&!f&&u)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&d&&!f&&l){let h=await this.processAndValidateRefreshHandler();return h?.access_token&&this.setCredentials(h),this.requestAsync(e,!0)}}throw n}}verifyIdToken(e,t){if(t&&typeof t!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(t)this.verifyIdTokenAsync(e).then(n=>t(null,n),t);else return this.verifyIdTokenAsync(e)}async verifyIdTokenAsync(e){if(!e.idToken)throw new Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...r.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),n=Object.assign({expiry_date:new Date().getTime()+t.expires_in*1e3,scopes:t.scope.split(" ")},t);return delete n.expires_in,delete n.scope,n}getFederatedSignonCerts(e){if(e)this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){let e=new Date().getTime(),t=(0,Vu.hasBrowserCrypto)()?_r.JWK:_r.PEM;if(this.certificateExpiry&&e<this.certificateExpiry.getTime()&&this.certificateCacheFormat===t)return{certs:this.certificateCache,format:t};let n,s;switch(t){case _r.PEM:s=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case _r.JWK:s=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${t}`)}try{let d={...r.RETRY_CONFIG,url:s};Nn.AuthClient.setMethodName(d,"getFederatedSignonCertsAsync"),n=await this.transporter.request(d)}catch(d){throw d instanceof Error&&(d.message=`Failed to retrieve verification certificates: ${d.message}`),d}let a=n?.headers.get("cache-control"),u=-1;if(a){let d=/max-age=(?<maxAge>[0-9]+)/.exec(a)?.groups?.maxAge;d&&(u=Number(d)*1e3)}let l={};switch(t){case _r.PEM:l=n.data;break;case _r.JWK:for(let d of n.data.keys)l[d.kid]=d;break;default:throw new Error(`Unsupported certificate format ${t}`)}let f=new Date;return this.certificateExpiry=u===-1?null:new Date(f.getTime()+u),this.certificateCache=l,this.certificateCacheFormat=t,{certs:l,format:t,res:n}}getIapPublicKeys(e){if(e)this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let e,t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let n={...r.RETRY_CONFIG,url:t};Nn.AuthClient.setMethodName(n,"getIapPublicKeysAsync"),e=await this.transporter.request(n)}catch(n){throw n instanceof Error&&(n.message=`Failed to retrieve verification certificates: ${n.message}`),n}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,n,s,a){let u=(0,Vu.createCrypto)();a||(a=r.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(l.length!==3)throw new Error("Wrong number of segments in token: "+e);let f=l[0]+"."+l[1],d=l[2],h,C;try{h=JSON.parse(u.decodeBase64StringUtf8(l[0]))}catch(F){throw F instanceof Error&&(F.message=`Can't parse token envelope: ${l[0]}': ${F.message}`),F}if(!h)throw new Error("Can't parse token envelope: "+l[0]);try{C=JSON.parse(u.decodeBase64StringUtf8(l[1]))}catch(F){throw F instanceof Error&&(F.message=`Can't parse token payload '${l[0]}`),F}if(!C)throw new Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,h.kid))throw new Error("No pem found for envelope: "+JSON.stringify(h));let w=t[h.kid];if(h.alg==="ES256"&&(d=sb.joseToDer(d,"ES256").toString("base64")),!await u.verify(w,f,d))throw new Error("Invalid token signature: "+e);if(!C.iat)throw new Error("No issue time in token: "+JSON.stringify(C));if(!C.exp)throw new Error("No expiration time in token: "+JSON.stringify(C));let S=Number(C.iat);if(isNaN(S))throw new Error("iat field using invalid format");let b=Number(C.exp);if(isNaN(b))throw new Error("exp field using invalid format");let _=new Date().getTime()/1e3;if(b>=_+a)throw new Error("Expiration time too far in future: "+JSON.stringify(C));let y=S-r.CLOCK_SKEW_SECS_,T=b+r.CLOCK_SKEW_SECS_;if(_<y)throw new Error("Token used too early, "+_+" < "+y+": "+JSON.stringify(C));if(_>T)throw new Error("Token used too late, "+_+" > "+T+": "+JSON.stringify(C));if(s&&s.indexOf(C.iss)<0)throw new Error("Invalid issuer, expected one of ["+s+"], but got "+C.iss);if(typeof n<"u"&&n!==null){let F=C.aud,L=!1;if(n.constructor===Array?L=n.indexOf(F)>-1:L=F===n,!L)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new ib.LoginTicket(h,C)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return e?e<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};Qt.OAuth2Client=Ku});var Xu=z(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.Compute=void 0;var ab=Ve(),Fp=wo(),ub=an(),Yu=class extends ub.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e=`service-accounts/${this.serviceAccountEmail}/token`,t;try{let s={property:e};this.scopes.length>0&&(s.params={scopes:this.scopes.join(",")}),t=await Fp.instance(s)}catch(s){throw s instanceof ab.GaxiosError&&(s.message=`Could not refresh access token: ${s.message}`,this.wrapError(s)),s}let n=t;return t&&t.expires_in&&(n.expiry_date=new Date().getTime()+t.expires_in*1e3,delete n.expires_in),this.emit("tokens",n),{tokens:n,res:null}}async fetchIdToken(e){let t=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`,n;try{let s={property:t};n=await Fp.instance(s)}catch(s){throw s instanceof Error&&(s.message=`Could not fetch ID token: ${s.message}`),s}return n}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,t.status===403?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:t.status===404&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}};li.Compute=Yu});var Zu=z(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.IdTokenClient=void 0;var cb=an(),Qu=class extends cb.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let t=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:t,expiry_date:this.getIdTokenExpiryDate(t)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp*1e3}};fi.IdTokenClient=Qu});var ec=z(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.GCPEnv=void 0;qn.clear=lb;qn.getEnv=fb;var Op=wo(),Cr;(function(r){r.APP_ENGINE="APP_ENGINE",r.KUBERNETES_ENGINE="KUBERNETES_ENGINE",r.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",r.COMPUTE_ENGINE="COMPUTE_ENGINE",r.CLOUD_RUN="CLOUD_RUN",r.NONE="NONE"})(Cr||(qn.GCPEnv=Cr={}));var So;function lb(){So=void 0}async function fb(){return So||(So=db(),So)}async function db(){let r=Cr.NONE;return hb()?r=Cr.APP_ENGINE:pb()?r=Cr.CLOUD_FUNCTIONS:await yb()?await gb()?r=Cr.KUBERNETES_ENGINE:mb()?r=Cr.CLOUD_RUN:r=Cr.COMPUTE_ENGINE:r=Cr.NONE,r}function hb(){return!!(process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME)}function pb(){return!!(process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET)}function mb(){return!!process.env.K_CONFIGURATION}async function gb(){try{return await Op.instance("attributes/cluster-name"),!0}catch{return!1}}async function yb(){return Op.isAvailable()}});var tc=z((AS,Pp)=>{var di=In().Buffer,_b=require("stream"),Cb=require("util");function hi(r){if(this.buffer=null,this.writable=!0,this.readable=!0,!r)return this.buffer=di.alloc(0),this;if(typeof r.pipe=="function")return this.buffer=di.alloc(0),r.pipe(this),this;if(r.length||typeof r=="object")return this.buffer=r,this.writable=!1,process.nextTick(function(){this.emit("end",r),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof r+")")}Cb.inherits(hi,_b);hi.prototype.write=function(e){this.buffer=di.concat([this.buffer,di.from(e)]),this.emit("data",e)};hi.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};Pp.exports=hi});var Bp=z((DS,xp)=>{"use strict";var vo=require("buffer").Buffer,rc=require("buffer").SlowBuffer;xp.exports=pi;function pi(r,e){if(!vo.isBuffer(r)||!vo.isBuffer(e)||r.length!==e.length)return!1;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}pi.install=function(){vo.prototype.equal=rc.prototype.equal=function(e){return pi(this,e)}};var bb=vo.prototype.equal,Eb=rc.prototype.equal;pi.restore=function(){vo.prototype.equal=bb,rc.prototype.equal=Eb}});var ic=z((SS,Hp)=>{var Ln=In().Buffer,Rt=require("crypto"),Np=Lu(),Ip=require("util"),wb=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,To="secret must be a string or buffer",jn="key must be a string or a buffer",Ab="key must be a string, a buffer or an object",oc=typeof Rt.createPublicKey=="function";oc&&(jn+=" or a KeyObject",To+="or a KeyObject");function qp(r){if(!Ln.isBuffer(r)&&typeof r!="string"&&(!oc||typeof r!="object"||typeof r.type!="string"||typeof r.asymmetricKeyType!="string"||typeof r.export!="function"))throw Ht(jn)}function jp(r){if(!Ln.isBuffer(r)&&typeof r!="string"&&typeof r!="object")throw Ht(Ab)}function Db(r){if(!Ln.isBuffer(r)){if(typeof r=="string")return r;if(!oc||typeof r!="object"||r.type!=="secret"||typeof r.export!="function")throw Ht(To)}}function sc(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Lp(r){r=r.toString();var e=4-r.length%4;if(e!==4)for(var t=0;t<e;++t)r+="=";return r.replace(/\-/g,"+").replace(/_/g,"/")}function Ht(r){var e=[].slice.call(arguments,1),t=Ip.format.bind(Ip,r).apply(null,e);return new TypeError(t)}function Sb(r){return Ln.isBuffer(r)||typeof r=="string"}function Ro(r){return Sb(r)||(r=JSON.stringify(r)),r}function Up(r){return function(t,n){Db(n),t=Ro(t);var s=Rt.createHmac("sha"+r,n),a=(s.update(t),s.digest("base64"));return sc(a)}}var nc,vb="timingSafeEqual"in Rt?function(e,t){return e.byteLength!==t.byteLength?!1:Rt.timingSafeEqual(e,t)}:function(e,t){return nc||(nc=Bp()),nc(e,t)};function Tb(r){return function(t,n,s){var a=Up(r)(t,s);return vb(Ln.from(n),Ln.from(a))}}function Mp(r){return function(t,n){jp(n),t=Ro(t);var s=Rt.createSign("RSA-SHA"+r),a=(s.update(t),s.sign(n,"base64"));return sc(a)}}function $p(r){return function(t,n,s){qp(s),t=Ro(t),n=Lp(n);var a=Rt.createVerify("RSA-SHA"+r);return a.update(t),a.verify(s,n,"base64")}}function Rb(r){return function(t,n){jp(n),t=Ro(t);var s=Rt.createSign("RSA-SHA"+r),a=(s.update(t),s.sign({key:n,padding:Rt.constants.RSA_PKCS1_PSS_PADDING,saltLength:Rt.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return sc(a)}}function kb(r){return function(t,n,s){qp(s),t=Ro(t),n=Lp(n);var a=Rt.createVerify("RSA-SHA"+r);return a.update(t),a.verify({key:s,padding:Rt.constants.RSA_PKCS1_PSS_PADDING,saltLength:Rt.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function Fb(r){var e=Mp(r);return function(){var n=e.apply(null,arguments);return n=Np.derToJose(n,"ES"+r),n}}function Ob(r){var e=$p(r);return function(n,s,a){s=Np.joseToDer(s,"ES"+r).toString("base64");var u=e(n,s,a);return u}}function Pb(){return function(){return""}}function xb(){return function(e,t){return t===""}}Hp.exports=function(e){var t={hs:Up,rs:Mp,ps:Rb,es:Fb,none:Pb},n={hs:Tb,rs:$p,ps:kb,es:Ob,none:xb},s=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!s)throw Ht(wb,e);var a=(s[1]||s[3]).toLowerCase(),u=s[2];return{sign:t[a](u),verify:n[a](u)}}});var ac=z((vS,Gp)=>{var Bb=require("buffer").Buffer;Gp.exports=function(e){return typeof e=="string"?e:typeof e=="number"||Bb.isBuffer(e)?e.toString():JSON.stringify(e)}});var Yp=z((TS,Kp)=>{var Ib=In().Buffer,Wp=tc(),Nb=ic(),qb=require("stream"),zp=ac(),uc=require("util");function Jp(r,e){return Ib.from(r,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function jb(r,e,t){t=t||"utf8";var n=Jp(zp(r),"binary"),s=Jp(zp(e),t);return uc.format("%s.%s",n,s)}function Vp(r){var e=r.header,t=r.payload,n=r.secret||r.privateKey,s=r.encoding,a=Nb(e.alg),u=jb(e,t,s),l=a.sign(u,n);return uc.format("%s.%s",u,l)}function mi(r){var e=r.secret||r.privateKey||r.key,t=new Wp(e);this.readable=!0,this.header=r.header,this.encoding=r.encoding,this.secret=this.privateKey=this.key=t,this.payload=new Wp(r.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}uc.inherits(mi,qb);mi.prototype.sign=function(){try{var e=Vp({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(t){this.readable=!1,this.emit("error",t),this.emit("close")}};mi.sign=Vp;Kp.exports=mi});var im=z((RS,sm)=>{var Qp=In().Buffer,Xp=tc(),Lb=ic(),Ub=require("stream"),Zp=ac(),Mb=require("util"),$b=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function Hb(r){return Object.prototype.toString.call(r)==="[object Object]"}function Gb(r){if(Hb(r))return r;try{return JSON.parse(r)}catch{return}}function em(r){var e=r.split(".",1)[0];return Gb(Qp.from(e,"base64").toString("binary"))}function Wb(r){return r.split(".",2).join(".")}function tm(r){return r.split(".")[2]}function zb(r,e){e=e||"utf8";var t=r.split(".")[1];return Qp.from(t,"base64").toString(e)}function rm(r){return $b.test(r)&&!!em(r)}function nm(r,e,t){if(!e){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}r=Zp(r);var s=tm(r),a=Wb(r),u=Lb(e);return u.verify(a,s,t)}function om(r,e){if(e=e||{},r=Zp(r),!rm(r))return null;var t=em(r);if(!t)return null;var n=zb(r);return(t.typ==="JWT"||e.json)&&(n=JSON.parse(n,e.encoding)),{header:t,payload:n,signature:tm(r)}}function Un(r){r=r||{};var e=r.secret||r.publicKey||r.key,t=new Xp(e);this.readable=!0,this.algorithm=r.algorithm,this.encoding=r.encoding,this.secret=this.publicKey=this.key=t,this.signature=new Xp(r.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}Mb.inherits(Un,Ub);Un.prototype.verify=function(){try{var e=nm(this.signature.buffer,this.algorithm,this.key.buffer),t=om(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(n){this.readable=!1,this.emit("error",n),this.emit("close")}};Un.decode=om;Un.isValid=rm;Un.verify=nm;sm.exports=Un});var cc=z(qr=>{var am=Yp(),gi=im(),Jb=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];qr.ALGORITHMS=Jb;qr.sign=am.sign;qr.verify=gi.verify;qr.decode=gi.decode;qr.isValid=gi.isValid;qr.createSign=function(e){return new am(e)};qr.createVerify=function(e){return new gi(e)}});var wm=z(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.GoogleToken=void 0;var um=yi(require("fs")),Vb=Ve(),Kb=yi(cc()),Yb=yi(require("path")),Xb=require("util");function yi(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(yi=function(a,u){if(!u&&a&&a.__esModule)return a;var l,f,d={__proto__:null,default:a};if(a===null||br(a)!="object"&&typeof a!="function")return d;if(l=u?n:t){if(l.has(a))return l.get(a);l.set(a,d)}for(var h in a)h!=="default"&&{}.hasOwnProperty.call(a,h)&&((f=(l=Object.defineProperty)&&Object.getOwnPropertyDescriptor(a,h))&&(f.get||f.set)?l(d,h,f):d[h]=a[h]);return d})(r,e)}function br(r){"@babel/helpers - typeof";return br=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},br(r)}function Qb(r,e){ym(r,e),e.add(r)}function Zb(r,e,t){ym(r,e),e.set(r,t)}function ym(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function cm(r,e,t){return r.set(Gt(r,e),t),t}function lm(r,e){return r.get(Gt(r,e))}function Gt(r,e,t){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function fm(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,bm(n.key),n)}}function _m(r,e,t){return e&&fm(r.prototype,e),t&&fm(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Cm(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function eE(r,e,t){return e=Po(e),tE(r,mc()?Reflect.construct(e,t||[],Po(r).constructor):e.apply(r,t))}function tE(r,e){if(e&&(br(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rE(r)}function rE(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function nE(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Oo(r,e)}function lc(r){var e=typeof Map=="function"?new Map:void 0;return lc=function(n){if(n===null||!sE(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,s)}function s(){return oE(n,arguments,Po(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Oo(s,n)},lc(r)}function oE(r,e,t){if(mc())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return t&&Oo(s,t.prototype),s}function mc(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mc=function(){return!!r})()}function sE(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function Oo(r,e){return Oo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Oo(r,e)}function Po(r){return Po=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Po(r)}function yt(r,e,t){return(e=bm(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function bm(r){var e=iE(r,"string");return br(e)=="symbol"?e:e+""}function iE(r,e){if(br(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(br(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Ct(){var r,e,t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",s=t.toStringTag||"@@toStringTag";function a(I,S,b,_){var y=S&&S.prototype instanceof l?S:l,T=Object.create(y.prototype);return _t(T,"_invoke",function(F,L,P){var j,G,te,W=0,be=P||[],de=!1,oe={p:0,n:0,v:r,a:ae,f:ae.bind(r,4),d:function(ue,he){return j=ue,G=0,te=r,oe.n=he,u}};function ae(Q,ue){for(G=Q,te=ue,e=0;!de&&W&&!he&&e<be.length;e++){var he,ve=be[e],J=oe.p,Y=ve[2];Q>3?(he=Y===ue)&&(te=ve[(G=ve[4])?5:(G=3,3)],ve[4]=ve[5]=r):ve[0]<=J&&((he=Q<2&&J<ve[1])?(G=0,oe.v=ue,oe.n=ve[1]):J<Y&&(he=Q<3||ve[0]>ue||ue>Y)&&(ve[4]=Q,ve[5]=ue,oe.n=Y,G=0))}if(he||Q>1)return u;throw de=!0,ue}return function(Q,ue,he){if(W>1)throw TypeError("Generator is already running");for(de&&ue===1&&ae(ue,he),G=ue,te=he;(e=G<2?r:te)||!de;){j||(G?G<3?(G>1&&(oe.n=-1),ae(G,te)):oe.n=te:oe.v=te);try{if(W=2,j){if(G||(Q="next"),e=j[Q]){if(!(e=e.call(j,te)))throw TypeError("iterator result is not an object");if(!e.done)return e;te=e.value,G<2&&(G=0)}else G===1&&(e=j.return)&&e.call(j),G<2&&(te=TypeError("The iterator does not provide a '"+Q+"' method"),G=1);j=r}else if((e=(de=oe.n<0)?te:F.call(L,oe))!==u)break}catch(ve){j=r,G=1,te=ve}finally{W=1}}return{value:e,done:de}}}(I,b,_),!0),T}var u={};function l(){}function f(){}function d(){}e=Object.getPrototypeOf;var h=[][n]?e(e([][n]())):(_t(e={},n,function(){return this}),e),C=d.prototype=l.prototype=Object.create(h);function w(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,d):(I.__proto__=d,_t(I,s,"GeneratorFunction")),I.prototype=Object.create(C),I}return f.prototype=d,_t(C,"constructor",d),_t(d,"constructor",f),f.displayName="GeneratorFunction",_t(d,s,"GeneratorFunction"),_t(C),_t(C,s,"Generator"),_t(C,n,function(){return this}),_t(C,"toString",function(){return"[object Generator]"}),(Ct=function(){return{w:a,m:w}})()}function _t(r,e,t,n){var s=Object.defineProperty;try{s({},"",{})}catch{s=0}_t=function(u,l,f,d){if(l)s?s(u,l,{value:f,enumerable:!d,configurable:!d,writable:!d}):u[l]=f;else{var h=function(w,I){_t(u,w,function(S){return this._invoke(w,I,S)})};h("next",0),h("throw",1),h("return",2)}},_t(r,e,t,n)}function dm(r,e,t,n,s,a,u){try{var l=r[a](u),f=l.value}catch(d){return void t(d)}l.done?e(f):Promise.resolve(f).then(n,s)}function Mn(r){return function(){var e=this,t=arguments;return new Promise(function(n,s){var a=r.apply(e,t);function u(f){dm(a,n,s,u,l,"next",f)}function l(f){dm(a,n,s,u,l,"throw",f)}u(void 0)})}}var hm=um.readFile?(0,Xb.promisify)(um.readFile):Mn(Ct().m(function r(){return Ct().w(function(e){for(;;)switch(e.n){case 0:throw new Fo("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},r)})),pm="https://oauth2.googleapis.com/token",aE="https://oauth2.googleapis.com/revoke?token=",Fo=function(r){function e(t,n){var s;return Cm(this,e),s=eE(this,e,[t]),yt(s,"code",void 0),s.code=n,s}return nE(e,r),_m(e)}(lc(Error)),ko=new WeakMap,Zt=new WeakSet,FS=_i.GoogleToken=function(){function r(e){Cm(this,r),Qb(this,Zt),yt(this,"expiresAt",void 0),yt(this,"key",void 0),yt(this,"keyFile",void 0),yt(this,"iss",void 0),yt(this,"sub",void 0),yt(this,"scope",void 0),yt(this,"rawToken",void 0),yt(this,"tokenExpires",void 0),yt(this,"email",void 0),yt(this,"additionalClaims",void 0),yt(this,"eagerRefreshThresholdMillis",void 0),yt(this,"transporter",{request:function(n){return(0,Vb.request)(n)}}),Zb(this,ko,void 0),Gt(Zt,this,Em).call(this,e)}return _m(r,[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var t=new Date().getTime();return this.rawToken&&this.expiresAt?t>=this.expiresAt:!0}},{key:"isTokenExpiring",value:function(){var t,n=new Date().getTime(),s=(t=this.eagerRefreshThresholdMillis)!==null&&t!==void 0?t:0;return this.rawToken&&this.expiresAt?this.expiresAt<=n+s:!0}},{key:"getToken",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(br(t)==="object"&&(n=t,t=void 0),n=Object.assign({forceRefresh:!1},n),t){var s=t;Gt(Zt,this,mm).call(this,n).then(function(a){return s(null,a)},t);return}return Gt(Zt,this,mm).call(this,n)}},{key:"getCredentials",value:function(){var e=Mn(Ct().m(function n(s){var a,u,l,f,d,h,C;return Ct().w(function(w){for(;;)switch(w.n){case 0:a=Yb.extname(s),C=a,w.n=C===".json"?1:C===".der"||C===".crt"||C===".pem"?4:C===".p12"||C===".pfx"?6:7;break;case 1:return w.n=2,hm(s,"utf8");case 2:if(u=w.v,l=JSON.parse(u),f=l.private_key,d=l.client_email,!(!f||!d)){w.n=3;break}throw new Fo("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return w.a(2,{privateKey:f,clientEmail:d});case 4:return w.n=5,hm(s,"utf8");case 5:return h=w.v,w.a(2,{privateKey:h});case 6:throw new Fo("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new Fo("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return w.a(2)}},n)}));function t(n){return e.apply(this,arguments)}return t}()},{key:"revokeToken",value:function(t){if(t){Gt(Zt,this,gm).call(this).then(function(){return t()},t);return}return Gt(Zt,this,gm).call(this)}}])}();function mm(r){return fc.apply(this,arguments)}function fc(){return fc=Mn(Ct().m(function r(e){return Ct().w(function(t){for(;;)switch(t.n){case 0:if(!(lm(ko,this)&&!e.forceRefresh)){t.n=1;break}return t.a(2,lm(ko,this));case 1:return t.p=1,t.n=2,cm(ko,this,Gt(Zt,this,uE).call(this,e));case 2:return t.a(2,t.v);case 3:return t.p=3,cm(ko,this,void 0),t.f(3);case 4:return t.a(2)}},r,this,[[1,,3,4]])})),fc.apply(this,arguments)}function uE(r){return dc.apply(this,arguments)}function dc(){return dc=Mn(Ct().m(function r(e){var t;return Ct().w(function(n){for(;;)switch(n.n){case 0:if(!(this.isTokenExpiring()===!1&&e.forceRefresh===!1)){n.n=1;break}return n.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){n.n=2;break}throw new Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){n.n=4;break}return n.n=3,this.getCredentials(this.keyFile);case 3:t=n.v,this.key=t.privateKey,this.iss=t.clientEmail||this.iss,t.clientEmail||Gt(Zt,this,cE).call(this);case 4:return n.a(2,Gt(Zt,this,lE).call(this))}},r,this)})),dc.apply(this,arguments)}function cE(){if(!this.iss)throw new Fo("email is required.","MISSING_CREDENTIALS")}function gm(){return hc.apply(this,arguments)}function hc(){return hc=Mn(Ct().m(function r(){var e;return Ct().w(function(t){for(;;)switch(t.n){case 0:if(this.accessToken){t.n=1;break}throw new Error("No token to revoke.");case 1:return e=aE+this.accessToken,t.n=2,this.transporter.request({url:e,retry:!0});case 2:Gt(Zt,this,Em).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return t.a(2)}},r,this)})),hc.apply(this,arguments)}function Em(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.keyFile=r.keyFile,this.key=r.key,this.rawToken=void 0,this.iss=r.email||r.iss,this.sub=r.sub,this.additionalClaims=r.additionalClaims,br(r.scope)==="object"?this.scope=r.scope.join(" "):this.scope=r.scope,this.eagerRefreshThresholdMillis=r.eagerRefreshThresholdMillis,r.transporter&&(this.transporter=r.transporter)}function lE(){return pc.apply(this,arguments)}function pc(){return pc=Mn(Ct().m(function r(){var e,t,n,s,a,u,l,f,d,h;return Ct().w(function(C){for(;;)switch(C.n){case 0:return e=Math.floor(new Date().getTime()/1e3),t=this.additionalClaims||{},n=Object.assign({iss:this.iss,scope:this.scope,aud:pm,exp:e+3600,iat:e,sub:this.sub},t),s=Kb.sign({header:{alg:"RS256"},payload:n,secret:this.key}),C.p=1,C.n=2,this.transporter.request({method:"POST",url:pm,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:s}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return a=C.v,this.rawToken=a.data,this.expiresAt=a.data.expires_in===null||a.data.expires_in===void 0?void 0:(e+a.data.expires_in)*1e3,C.a(2,this.rawToken);case 3:throw C.p=3,h=C.v,this.rawToken=void 0,this.tokenExpires=void 0,f=h.response&&(u=h.response)!==null&&u!==void 0&&u.data?(l=h.response)===null||l===void 0?void 0:l.data:{},f.error&&(d=f.error_description?": ".concat(f.error_description):"",h.message="".concat(f.error).concat(d)),h;case 4:return C.a(2)}},r,this,[[1,3]])})),pc.apply(this,arguments)}});var yc=z(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.JWTAccess=void 0;var fE=cc(),dE=Mt(),Am={alg:"RS256",typ:"JWT"},gc=class r{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new dE.LRUCache({capacity:500,maxAge:60*60*1e3});constructor(e,t,n,s){this.email=e,this.key=t,this.keyId=n,this.eagerRefreshThresholdMillis=s??5*60*1e3}getCachedKey(e,t){let n=e;if(t&&Array.isArray(t)&&t.length?n=e?`${e}_${t.join("_")}`:`${t.join("_")}`:typeof t=="string"&&(n=e?`${e}_${t}`:t),!n)throw Error("Scopes or url must be provided");return n}getRequestHeaders(e,t,n){let s=this.getCachedKey(e,n),a=this.cache.get(s),u=Date.now();if(a&&a.expiration-u>this.eagerRefreshThresholdMillis)return new Headers(a.headers);let l=Math.floor(Date.now()/1e3),f=r.getExpirationTime(l),d;if(Array.isArray(n)&&(n=n.join(" ")),n?d={iss:this.email,sub:this.email,scope:n,exp:f,iat:l}:d={iss:this.email,sub:this.email,aud:e,exp:f,iat:l},t){for(let S in d)if(t[S])throw new Error(`The '${S}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...Am,kid:this.keyId}:Am,C=Object.assign(d,t),w=fE.sign({header:h,payload:C,secret:this.key}),I=new Headers({authorization:`Bearer ${w}`});return this.cache.set(s,{expiration:f*1e3,headers:I}),I}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,n)=>{e||n(new Error("Must pass in a stream containing the service account auth settings."));let s="";e.setEncoding("utf8").on("data",a=>s+=a).on("error",n).on("end",()=>{try{let a=JSON.parse(s);this.fromJSON(a),t()}catch(a){n(a)}})})}};Ci.JWTAccess=gc});var Cc=z(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.JWT=void 0;var Dm=wm(),hE=yc(),pE=an(),bi=gt(),_c=class r extends pE.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new r(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==bi.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==bi.DEFAULT_UNIVERSE)throw new RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${bi.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:n}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${n.id_token}`}))}}else{this.access||(this.access=new hE.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let n;this.hasUserScopes()?n=this.scopes:e||(n=this.defaultScopes);let s=this.useJWTAccessWithScope||this.universeDomain!==bi.DEFAULT_UNIVERSE,a=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,s?n:void 0);return{headers:this.addSharedMetadataHeaders(a)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new Dm.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw new Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(e){if(e)this.authorizeAsync().then(t=>e(null,t),e);else return this.authorizeAsync()}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw new Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),n={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",n),{res:null,tokens:n}}createGToken(){return this.gtoken||(this.gtoken=new Dm.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,n)=>{if(!e)throw new Error("Must pass in a stream containing the service account auth settings.");let s="";e.setEncoding("utf8").on("error",n).on("data",a=>s+=a).on("end",()=>{try{let a=JSON.parse(s);this.fromJSON(a),t()}catch(a){n(a)}})})}fromAPIKey(e){if(typeof e!="string")throw new Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let t=await this.createGToken().getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};Ei.JWT=_c});var Ec=z($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.UserRefreshClient=$n.USER_REFRESH_ACCOUNT_TYPE=void 0;var mE=an(),gE=gt();$n.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var bc=class r extends mE.OAuth2Client{_refreshToken;constructor(e,t,n,s,a){let u=e&&typeof e=="object"?e:{clientId:e,clientSecret:t,refreshToken:n,eagerRefreshThresholdMillis:s,forceRefreshOnFailure:a};super(u),this._refreshToken=u.refreshToken,this.credentials.refresh_token=u.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...r.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return gE.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the user refresh token");if(e.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}async fromStreamAsync(e){return new Promise((t,n)=>{if(!e)return n(new Error("Must pass in a stream containing the user refresh token."));let s="";e.setEncoding("utf8").on("error",n).on("data",a=>s+=a).on("end",()=>{try{let a=JSON.parse(s);return this.fromJSON(a),t()}catch(a){return n(a)}})})}static fromJSON(e){let t=new r;return t.fromJSON(e),t}};$n.UserRefreshClient=bc});var Ac=z(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.Impersonated=Hn.IMPERSONATED_ACCOUNT_TYPE=void 0;var Sm=an(),yE=Ve(),_E=Mt();Hn.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var wc=class r extends Sm.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new Sm.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,!!!(0,_E.originalOrCamelOptions)(e).get("universe_domain"))this.universeDomain=this.sourceClient.universeDomain;else if(this.sourceClient.universeDomain!==this.universeDomain)throw new RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`);this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${t}:signBlob`,s={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...r.RETRY_CONFIG,url:n,data:s,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,n={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},s=await this.sourceClient.request({...r.RETRY_CONFIG,url:t,data:n,method:"POST"}),a=s.data;return this.credentials.access_token=a.accessToken,this.credentials.expiry_date=Date.parse(a.expireTime),{tokens:this.credentials,res:s}}catch(e){if(!(e instanceof Error))throw e;let t=0,n="";throw e instanceof yE.GaxiosError&&(t=e?.response?.data?.error?.status,n=e?.response?.data?.error?.message),t&&n?(e.message=`${t}: unable to impersonate: ${n}`,e):(e.message=`unable to impersonate: ${e}`,e)}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let n=`projects/-/serviceAccounts/${this.targetPrincipal}`,s=`${this.endpoint}/v1/${n}:generateIdToken`,a={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...r.RETRY_CONFIG,url:s,data:a,method:"POST"})).data.token}};Hn.Impersonated=wc});var Sc=z(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.OAuthClientAuthHandler=void 0;xo.getErrorFromOAuthErrorResponse=EE;var Gn=Ve(),CE=Ao(),bE=["PUT","POST","PATCH"],Dc=class{#e=(0,CE.createCrypto)();#t;transporter;constructor(e){e&&"clientId"in e?(this.#t=e,this.transporter=new Gn.Gaxios):(this.#t=e?.clientAuthentication,this.transporter=e?.transporter||new Gn.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=Gn.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=Gn.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#t?.confidentialClientType==="basic"){e.headers=Gn.Gaxios.mergeHeaders(e.headers);let n=this.#t.clientId,s=this.#t.clientSecret||"",a=this.#e.encodeBase64StringUtf8(`${n}:${s}`);Gn.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${a}`})}}injectAuthenticatedRequestBody(e){if(this.#t?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!bE.includes(t))throw new Error(`${t} HTTP method does not support ${this.#t.confidentialClientType} client authentication`);let s=new Headers(e.headers).get("content-type");if(s?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let a=new URLSearchParams(e.data??"");a.append("client_id",this.#t.clientId),a.append("client_secret",this.#t.clientSecret||""),e.data=a}else if(s?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#t.clientId,client_secret:this.#t.clientSecret||""});else throw new Error(`${s} content-types are not supported with ${this.#t.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};xo.OAuthClientAuthHandler=Dc;function EE(r,e){let t=r.error,n=r.error_description,s=r.error_uri,a=`Error code ${t}`;typeof n<"u"&&(a+=`: ${n}`),typeof s<"u"&&(a+=` - ${s}`);let u=new Error(a);if(e){let l=Object.keys(e);e.stack&&l.push("stack"),l.forEach(f=>{f!=="message"&&Object.defineProperty(u,f,{value:e[f],writable:!1,enumerable:!0})})}return u}});var Ai=z(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.StsCredentials=void 0;var wE=Ve(),AE=gt(),vm=Sc(),DE=Mt(),vc=class r extends vm.OAuthClientAuthHandler{#e;constructor(e={tokenExchangeEndpoint:""},t){(typeof e!="object"||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#e=e.tokenExchangeEndpoint}async exchangeToken(e,t,n){let s={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:n&&JSON.stringify(n)},a={...r.RETRY_CONFIG,url:this.#e.toString(),method:"POST",headers:t,data:new URLSearchParams((0,DE.removeUndefinedValuesInObject)(s))};AE.AuthClient.setMethodName(a,"exchangeToken"),this.applyClientAuthenticationOptions(a);try{let u=await this.transporter.request(a),l=u.data;return l.res=u,l}catch(u){throw u instanceof wE.GaxiosError&&u.response?(0,vm.getErrorFromOAuthErrorResponse)(u.response.data,u):u}}};wi.StsCredentials=vc});var jr=z(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.BaseExternalAccountClient=kt.CLOUD_RESOURCE_MANAGER=kt.EXTERNAL_ACCOUNT_TYPE=kt.EXPIRATION_TIME_OFFSET=void 0;var SE=Ve(),vE=require("stream"),Tc=gt(),TE=Ai(),Tm=Mt(),RE=$u(),kE="urn:ietf:params:oauth:grant-type:token-exchange",FE="urn:ietf:params:oauth:token-type:access_token",Rc="https://www.googleapis.com/auth/cloud-platform",OE=3600;kt.EXPIRATION_TIME_OFFSET=5*60*1e3;kt.EXTERNAL_ACCOUNT_TYPE="external_account";kt.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var PE="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",xE="https://sts.{universeDomain}/v1/token",kc=class r extends Tc.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#e=null;constructor(e){super(e);let t=(0,Tm.originalOrCamelOptions)(e),n=t.get("type");if(n&&n!==kt.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${kt.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let s=t.get("client_id"),a=t.get("client_secret");this.tokenUrl=t.get("token_url")??xE.replace("{universeDomain}",this.universeDomain);let u=t.get("subject_token_type"),l=t.get("workforce_pool_user_project"),f=t.get("service_account_impersonation_url"),d=t.get("service_account_impersonation"),h=(0,Tm.originalOrCamelOptions)(d).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(t.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),s&&(this.clientAuth={confidentialClientType:"basic",clientId:s,clientSecret:a}),this.stsCredential=new TE.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=t.get("scopes")||[Rc],this.cachedAccessToken=null,this.audience=t.get("audience"),this.subjectTokenType=u,this.workforcePoolUserProject=l;let C=new RegExp(PE);if(this.workforcePoolUserProject&&!this.audience.match(C))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=f,this.serviceAccountImpersonationLifetime=h,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=OE),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);return/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl)?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),n={...r.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};Tc.AuthClient.setMethodName(n,"getProjectId");let s=await this.transporter.request(n);return this.projectId=s.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=SE.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let u=a.status,l=a.config.data instanceof vE.Readable;if(!t&&(u===401||u===403)&&!l&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){this.#e=this.#e||this.#t();try{return await this.#e}finally{this.#e=null}}async#t(){let e=await this.retrieveSubjectToken(),t={grantType:kE,audience:this.audience,requestedTokenType:FE,subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[Rc]:this.getScopesArray()},n=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,s=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),a=await this.stsCredential.exchangeToken(t,s,n);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(a.access_token):a.expires_in?this.cachedAccessToken={access_token:a.access_token,expiry_date:new Date().getTime()+a.expires_in*1e3,res:a.res}:this.cachedAccessToken={access_token:a.access_token,res:a.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...r.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};Tc.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let n=await this.transporter.request(t),s=n.data;return{access_token:s.accessToken,expiry_date:new Date(s.expireTime).getTime(),res:n}}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:this.scopes||[Rc]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=this.serviceAccountImpersonationUrl!==void 0,n=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${RE.pkg.version} google-byoid-sdk source/${n} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}};kt.BaseExternalAccountClient=kc});var Rm=z(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.FileSubjectTokenSupplier=void 0;var Oc=require("util"),Pc=require("fs"),BE=(0,Oc.promisify)(Pc.readFile??(()=>{})),IE=(0,Oc.promisify)(Pc.realpath??(()=>{})),NE=(0,Oc.promisify)(Pc.lstat??(()=>{})),Fc=class{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e=this.filePath;try{if(e=await IE(e),!(await NE(e)).isFile())throw new Error}catch(s){throw s instanceof Error&&(s.message=`The file at ${e} does not exist, or it is not a file. ${s.message}`),s}let t,n=await BE(e,{encoding:"utf8"});if(this.formatType==="text"?t=n:this.formatType==="json"&&this.subjectTokenFieldName&&(t=JSON.parse(n)[this.subjectTokenFieldName]),!t)throw new Error("Unable to parse the subject_token from the credential_source file");return t}};Di.FileSubjectTokenSupplier=Fc});var km=z(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});Si.UrlSubjectTokenSupplier=void 0;var qE=gt(),xc=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};qE.AuthClient.setMethodName(t,"getSubjectToken");let n;if(this.formatType==="text"?n=(await e.transporter.request(t)).data:this.formatType==="json"&&this.subjectTokenFieldName&&(n=(await e.transporter.request(t)).data[this.subjectTokenFieldName]),!n)throw new Error("Unable to parse the subject_token from the credential_source URL");return n}};Si.UrlSubjectTokenSupplier=xc});var Fm=z(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.CertificateSubjectTokenSupplier=bt.InvalidConfigurationError=bt.CertificateSourceUnavailableError=bt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;var vi=Mt(),Ti=require("fs"),Ri=require("crypto"),jE=require("https");bt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";var er=class extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}};bt.CertificateSourceUnavailableError=er;var Ft=class extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}};bt.InvalidConfigurationError=Ft;var Bc=class{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new Ft("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new Ft("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new Ft("Cannot create mTLS Agent with missing certificate or key");return new jE.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#e();let{certPath:e,keyPath:t}=await this.#t();return{cert:this.cert,key:this.key}=await this.#r(e,t),await this.#n(this.cert)}async#e(){let e=this.certificateConfigPath;if(e){if(await(0,vi.isValidFile)(e))return e;throw new er(`Provided certificate config path is invalid: ${e}`)}let t=process.env[bt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(t){if(await(0,vi.isValidFile)(t))return t;throw new er(`Path from environment variable "${bt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${t}`)}let n=(0,vi.getWellKnownCertificateConfigFileLocation)();if(await(0,vi.isValidFile)(n))return n;throw new er(`Could not find certificate configuration file. Searched override path, the "${bt.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${n}).`)}async#t(){let e=this.certificateConfigPath,t;try{t=await Ti.promises.readFile(e,"utf8")}catch{throw new er(`Failed to read certificate config file at: ${e}`)}try{let n=JSON.parse(t),s=n?.cert_configs?.workload?.cert_path,a=n?.cert_configs?.workload?.key_path;if(!s||!a)throw new Ft(`Certificate config file (${e}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:s,keyPath:a}}catch(n){throw n instanceof Ft?n:new Ft(`Failed to parse certificate config from ${e}: ${n.message}`)}}async#r(e,t){let n,s;try{n=await Ti.promises.readFile(e),new Ri.X509Certificate(n)}catch(a){let u=a instanceof Error?a.message:String(a);throw new er(`Failed to read certificate file at ${e}: ${u}`)}try{s=await Ti.promises.readFile(t),(0,Ri.createPrivateKey)(s)}catch(a){let u=a instanceof Error?a.message:String(a);throw new er(`Failed to read private key file at ${t}: ${u}`)}return{cert:n,key:s}}async#n(e){let t=new Ri.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let a=((await Ti.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((f,d)=>{try{return new Ri.X509Certificate(f)}catch(h){let C=h instanceof Error?h.message:String(h);throw new Ft(`Failed to parse certificate at index ${d} in trust chain file ${this.trustChainPath}: ${C}`)}}),u=a.findIndex(f=>t.raw.equals(f.raw)),l;if(u===-1)l=[t,...a];else if(u===0)l=a;else throw new Ft(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${u}).`);return JSON.stringify(l.map(f=>f.raw.toString("base64")))}catch(n){if(n instanceof Ft)throw n;let s=n instanceof Error?n.message:String(n);throw new er(`Failed to process certificate chain from ${this.trustChainPath}: ${s}`)}}};bt.CertificateSubjectTokenSupplier=Bc});var qc=z(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.IdentityPoolClient=void 0;var LE=jr(),Ic=Mt(),UE=Rm(),ME=km(),Om=Fm(),$E=Ai(),Pm=Ve(),Nc=class r extends LE.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let t=(0,Ic.originalOrCamelOptions)(e),n=t.get("credential_source"),s=t.get("subject_token_supplier");if(!n&&!s)throw new Error("A credential source or subject token supplier must be specified.");if(n&&s)throw new Error("Only one of credential source or subject token supplier can be specified.");if(s)this.subjectTokenSupplier=s,this.credentialSourceType="programmatic";else{let a=(0,Ic.originalOrCamelOptions)(n),u=(0,Ic.originalOrCamelOptions)(a.get("format")),l=u.get("type")||"text",f=u.get("subject_token_field_name");if(l!=="json"&&l!=="text")throw new Error(`Invalid credential_source format "${l}"`);if(l==="json"&&!f)throw new Error("Missing subject_token_field_name for JSON credential_source format");let d=a.get("file"),h=a.get("url"),C=a.get("certificate"),w=a.get("headers");if(d&&h||h&&C||d&&C)throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(d)this.credentialSourceType="file",this.subjectTokenSupplier=new UE.FileSubjectTokenSupplier({filePath:d,formatType:l,subjectTokenFieldName:f});else if(h)this.credentialSourceType="url",this.subjectTokenSupplier=new ME.UrlSubjectTokenSupplier({url:h,formatType:l,subjectTokenFieldName:f,headers:w,additionalGaxiosOptions:r.RETRY_CONFIG});else if(C){this.credentialSourceType="certificate";let I=new Om.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:C.use_default_certificate_config,certificateConfigLocation:C.certificate_config_location,trustChainPath:C.trust_chain_path});this.subjectTokenSupplier=I}else throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof Om.CertificateSubjectTokenSupplier){let t=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new $E.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new Pm.Gaxios({agent:t})}),this.transporter=new Pm.Gaxios({...this.transporter.defaults||{},agent:t})}return e}};ki.IdentityPoolClient=Nc});var Lc=z(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.AwsRequestSigner=void 0;var Fi=Ve(),Bm=Ao(),xm="AWS4-HMAC-SHA256",HE="aws4_request",jc=class{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,Bm.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new RangeError('"url" is required in "amzOptions"');let t=typeof e.data=="object"?JSON.stringify(e.data):e.data,n=e.url,s=e.method||"GET",a=e.body||t,u=e.headers,l=await this.getCredentials(),f=new URL(n);if(typeof a!="string"&&a!==void 0)throw new TypeError(`'requestPayload' is expected to be a string if provided. Got: ${a}`);let d=await WE({crypto:this.crypto,host:f.host,canonicalUri:f.pathname,canonicalQuerystring:f.search.slice(1),method:s,region:this.region,securityCredentials:l,requestPayload:a,additionalAmzHeaders:u}),h=Fi.Gaxios.mergeHeaders(d.amzDate?{"x-amz-date":d.amzDate}:{},{authorization:d.authorizationHeader,host:f.host},u||{});l.token&&Fi.Gaxios.mergeHeaders(h,{"x-amz-security-token":l.token});let C={url:n,method:s,headers:h};return a!==void 0&&(C.body=a),C}};Oi.AwsRequestSigner=jc;async function Bo(r,e,t){return await r.signWithHmacSha256(e,t)}async function GE(r,e,t,n,s){let a=await Bo(r,`AWS4${e}`,t),u=await Bo(r,a,n),l=await Bo(r,u,s);return await Bo(r,l,"aws4_request")}async function WE(r){let e=Fi.Gaxios.mergeHeaders(r.additionalAmzHeaders),t=r.requestPayload||"",n=r.host.split(".")[0],s=new Date,a=s.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),u=s.toISOString().replace(/[-]/g,"").replace(/T.*/,"");r.securityCredentials.token&&e.set("x-amz-security-token",r.securityCredentials.token);let l=Fi.Gaxios.mergeHeaders({host:r.host},e.has("date")?{}:{"x-amz-date":a},e),f="",d=[...l.keys()].sort();d.forEach(T=>{f+=`${T}:${l.get(T)}
`});let h=d.join(";"),C=await r.crypto.sha256DigestHex(t),w=`${r.method.toUpperCase()}
${r.canonicalUri}
${r.canonicalQuerystring}
${f}
${h}
${C}`,I=`${u}/${r.region}/${n}/${HE}`,S=`${xm}
${a}
${I}
`+await r.crypto.sha256DigestHex(w),b=await GE(r.crypto,r.securityCredentials.secretAccessKey,u,r.region,n),_=await Bo(r.crypto,b,S),y=`${xm} Credential=${r.securityCredentials.accessKeyId}/${I}, SignedHeaders=${h}, Signature=${(0,Bm.fromArrayBufferToHex)(_)}`;return{amzDate:e.has("date")?void 0:a,authorizationHeader:y,canonicalQuerystring:r.canonicalQuerystring}}});var Im=z(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.DefaultAwsSecurityCredentialsSupplier=void 0;var Pi=gt(),Uc=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#n)return this.#n;let t=new Headers;if(!this.#n&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#e(e.transporter)),!this.regionUrl)throw new RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let n={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};Pi.AuthClient.setMethodName(n,"getAwsRegion");let s=await e.transporter.request(n);return s.data.substr(0,s.data.length-1)}async getAwsSecurityCredentials(e){if(this.#o)return this.#o;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#e(e.transporter));let n=await this.#t(t,e.transporter),s=await this.#r(n,t,e.transporter);return{accessKeyId:s.AccessKeyId,secretAccessKey:s.SecretAccessKey,token:s.Token}}async#e(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return Pi.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async#t(e,t){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let n={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return Pi.AuthClient.setMethodName(n,"#getAwsRoleName"),(await t.request(n)).data}async#r(e,t,n){let s={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return Pi.AuthClient.setMethodName(s,"#retrieveAwsSecurityCredentials"),(await n.request(s)).data}get#n(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get#o(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}};xi.DefaultAwsSecurityCredentialsSupplier=Uc});var $c=z(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.AwsClient=void 0;var zE=Lc(),JE=jr(),VE=Im(),Nm=Mt(),KE=Ve(),Mc=class r extends JE.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static#e="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let t=(0,Nm.originalOrCamelOptions)(e),n=t.get("credential_source"),s=t.get("aws_security_credentials_supplier");if(!n&&!s)throw new Error("A credential source or AWS security credentials supplier must be specified.");if(n&&s)throw new Error("Only one of credential source or AWS security credentials supplier can be specified.");if(s)this.awsSecurityCredentialsSupplier=s,this.regionalCredVerificationUrl=r.#e,this.credentialSourceType="programmatic";else{let a=(0,Nm.originalOrCamelOptions)(n);this.environmentId=a.get("environment_id");let u=a.get("region_url"),l=a.get("url"),f=a.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new VE.DefaultAwsSecurityCredentialsSupplier({regionUrl:u,securityCredentialsUrl:l,imdsV2SessionTokenUrl:f}),this.regionalCredVerificationUrl=a.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(!e||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(e[2],10)!==1)throw new Error(`aws version "${e[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new zE.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...r.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return KE.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((s,a)=>t.push({key:a,value:s})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}};Bi.AwsClient=Mc});var Jc=z(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.InvalidSubjectTokenError=je.InvalidMessageFieldError=je.InvalidCodeFieldError=je.InvalidTokenTypeFieldError=je.InvalidExpirationTimeFieldError=je.InvalidSuccessFieldError=je.InvalidVersionFieldError=je.ExecutableResponseError=je.ExecutableResponse=void 0;var Ii="urn:ietf:params:oauth:token-type:saml2",Hc="urn:ietf:params:oauth:token-type:id_token",Gc="urn:ietf:params:oauth:token-type:jwt",Wc=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new Ni("Executable response must contain a 'version' field.");if(e.success===void 0)throw new qi("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==Ii&&this.tokenType!==Hc&&this.tokenType!==Gc)throw new ji(`Executable response must contain a 'token_type' field when successful and it must be one of ${Hc}, ${Gc}, or ${Ii}.`);if(this.tokenType===Ii){if(!e.saml_response)throw new Io(`Executable response must contain a 'saml_response' field when token_type=${Ii}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new Io(`Executable response must contain a 'id_token' field when token_type=${Hc} or ${Gc}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new Li("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new Ui("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};je.ExecutableResponse=Wc;var tr=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};je.ExecutableResponseError=tr;var Ni=class extends tr{};je.InvalidVersionFieldError=Ni;var qi=class extends tr{};je.InvalidSuccessFieldError=qi;var zc=class extends tr{};je.InvalidExpirationTimeFieldError=zc;var ji=class extends tr{};je.InvalidTokenTypeFieldError=ji;var Li=class extends tr{};je.InvalidCodeFieldError=Li;var Ui=class extends tr{};je.InvalidMessageFieldError=Ui;var Io=class extends tr{};je.InvalidSubjectTokenError=Io});var Yc=z(Wn=>{"use strict";Object.defineProperty(Wn,"__esModule",{value:!0});Wn.PluggableAuthHandler=Wn.ExecutableError=void 0;var un=Jc(),YE=require("child_process"),Vc=require("fs"),Mi=class extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}};Wn.ExecutableError=Mi;var Kc=class r{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw new Error("No command provided.");if(this.commandComponents=r.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,n)=>{let s=YE.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";s.stdout.on("data",l=>{a+=l}),s.stderr.on("data",l=>{a+=l});let u=setTimeout(()=>(s.removeAllListeners(),s.kill(),n(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);s.on("close",l=>{if(clearTimeout(u),l===0)try{let f=JSON.parse(a),d=new un.ExecutableResponse(f);return t(d)}catch(f){return f instanceof un.ExecutableResponseError?n(f):n(new un.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}else return n(new Mi(a,l.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await Vc.promises.realpath(this.outputFile)}catch{return}if(!(await Vc.promises.lstat(e)).isFile())return;let t=await Vc.promises.readFile(e,{encoding:"utf8"});if(t!=="")try{let n=JSON.parse(t);return new un.ExecutableResponse(n).isValid()?new un.ExecutableResponse(n):void 0}catch(n){throw n instanceof un.ExecutableResponseError?n:new un.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let n=0;n<t.length;n++)t[n][0]==='"'&&t[n].slice(-1)==='"'&&(t[n]=t[n].slice(1,-1));return t}};Wn.PluggableAuthHandler=Kc});var Qc=z(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.PluggableAuthClient=zn.ExecutableError=void 0;var XE=jr(),QE=Jc(),qm=Yc(),ZE=Yc();Object.defineProperty(zn,"ExecutableError",{enumerable:!0,get:function(){return ZE.ExecutableError}});var ew=30*1e3,jm=5*1e3,Lm=120*1e3,tw="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",Um=1,Xc=class extends XE.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=e.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(e.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=ew;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<jm||this.timeoutMillis>Lm)throw new Error(`Timeout must be between ${jm} and ${Lm} milliseconds.`);this.outputFile=e.credential_source.executable.output_file,this.handler=new qm.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(process.env[tw]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let e;if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let n=this.getServiceAccountEmail();n&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",n),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>Um)throw new Error(`Version of executable is not currently supported, maximum supported version is ${Um}.`);if(!e.success)throw new qm.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new QE.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw new Error("Executable response is expired.");return e.subjectToken}};zn.PluggableAuthClient=Xc});var el=z($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.ExternalAccountClient=void 0;var rw=jr(),nw=qc(),ow=$c(),sw=Qc(),Zc=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===rw.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new ow.AwsClient(e):e.credential_source?.executable?new sw.PluggableAuthClient(e):new nw.IdentityPoolClient(e):null}};$i.ExternalAccountClient=Zc});var Gm=z(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.ExternalAccountAuthorizedUserClient=Jn.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var $m=gt(),Mm=Sc(),Hm=Ve(),iw=require("stream"),aw=jr();Jn.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var uw="https://sts.{universeDomain}/v1/oauthtoken",tl=class r extends Mm.OAuthClientAuthHandler{#e;constructor(e){super(e),this.#e=e.tokenRefreshEndpoint}async refreshToken(e,t){let n={...r.RETRY_CONFIG,url:this.#e,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};$m.AuthClient.setMethodName(n,"refreshToken"),this.applyClientAuthenticationOptions(n);try{let s=await this.transporter.request(n),a=s.data;return a.res=s,a}catch(s){throw s instanceof Hm.GaxiosError&&s.response?(0,Mm.getErrorFromOAuthErrorResponse)(s.response.data,s):s}}},rl=class extends $m.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new tl({tokenRefreshEndpoint:e.token_url??uw.replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,typeof e?.eagerRefreshThresholdMillis!="number"?this.eagerRefreshThresholdMillis=aw.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=Hm.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let u=a.status,l=a.config.data instanceof iw.Readable;if(!t&&(u===401||u===403)&&!l&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+e.expires_in*1e3,res:e.res},e.refresh_token!==void 0&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};Jn.ExternalAccountAuthorizedUserClient=rl});var Vm=z(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.GoogleAuth=Wt.GoogleAuthExceptionMessages=void 0;var cw=require("child_process"),No=require("fs"),lw=Ve(),qo=wo(),fw=require("os"),nl=require("path"),dw=Ao(),hw=Xu(),pw=Zu(),mw=ec(),Vn=Cc(),Wm=Ec(),Kn=Ac(),gw=el(),jo=jr(),ol=gt(),zm=Gm(),Jm=Mt();Wt.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_CREDENTIALS_FOUND:`Unable to find credentials in current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:`Unable to detect a Universe Domain in the current environment.
To learn more about Universe Domain retrieval, visit: 
https://cloud.google.com/compute/docs/metadata/predefined-metadata-keys`};var sl=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#e=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw new RangeError(Wt.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(t=>e(null,t),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===Wt.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId(),e)return this._cachedProjectId=e,e;throw new Error(Wt.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await qo.universe("universe-domain"),e||=ol.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=ol.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,Jm.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=ol.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let n;if(typeof e=="function"?t=e:n=e,t)this.getApplicationDefaultAsync(n).then(s=>t(null,s.credential,s.projectId),t);else return this.getApplicationDefaultAsync(n)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await this.#t(this.cachedCredential,null);let t;if(t=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),t)return t instanceof Vn.JWT?t.scopes=this.scopes:t instanceof jo.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await this.#t(t);if(t=await this._tryGetApplicationCredentialsFromWellKnownFile(e),t)return t instanceof Vn.JWT?t.scopes=this.scopes:t instanceof jo.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await this.#t(t);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#t(new hw.Compute(e));throw new Error(Wt.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async#t(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let n=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:n}}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=qo.getGCPResidency()||await qo.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||t.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(n){throw n instanceof Error&&(n.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${n.message}`),n}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let s=process.env.HOME;s&&(t=nl.join(s,".config"))}return t&&(t=nl.join(t,"gcloud","application_default_credentials.json"),No.existsSync(t)||(t=null)),t?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=No.realpathSync(e),!No.lstatSync(e).isFile())throw new Error}catch(s){throw s instanceof Error&&(s.message=`The file at ${e} does not exist, or it is not a file. ${s.message}`),s}let n=No.createReadStream(e);return this.fromStream(n,t)}fromImpersonatedJSON(e){if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==Kn.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${Kn.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let n=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!n)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let s=this.getAnyScopes()??[];return new Kn.Impersonated({...e,sourceClient:t,targetPrincipal:n,targetScopes:Array.isArray(s)?s:[s]})}fromJSON(e,t={}){let n,s=(0,Jm.originalOrCamelOptions)(t).get("universe_domain");return e.type===Wm.USER_REFRESH_ACCOUNT_TYPE?(n=new Wm.UserRefreshClient(t),n.fromJSON(e)):e.type===Kn.IMPERSONATED_ACCOUNT_TYPE?n=this.fromImpersonatedJSON(e):e.type===jo.EXTERNAL_ACCOUNT_TYPE?(n=gw.ExternalAccountClient.fromJSON({...e,...t}),n.scopes=this.getAnyScopes()):e.type===zm.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?n=new zm.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,n=new Vn.JWT(t),this.setGapicJWTValues(n),n.fromJSON(e)),s&&(n.universeDomain=s),n}_cacheClientFromJSON(e,t){let n=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=n,n}fromStream(e,t={},n){let s={};if(typeof t=="function"?n=t:s=t,n)this.fromStreamAsync(e,s).then(a=>n(null,a),n);else return this.fromStreamAsync(e,s)}fromStreamAsync(e,t){return new Promise((n,s)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let a=[];e.setEncoding("utf8").on("error",s).on("data",u=>a.push(u)).on("end",()=>{try{try{let u=JSON.parse(a.join("")),l=this._cacheClientFromJSON(u,t);return n(l)}catch(u){if(!this.keyFilename)throw u;let l=new Vn.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=l,this.setGapicJWTValues(l),n(l)}}catch(u){return s(u)}})})}fromAPIKey(e,t={}){return new Vn.JWT({...t,apiKey:e})}_isWindows(){let e=fw.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,cw.exec)("gcloud config config-helper --format json",(t,n)=>{if(!t&&n)try{let s=JSON.parse(n).configuration.properties.core.project;e(s);return}catch{}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let t=await this.getClient();if(t&&t.projectId)return t.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==jo.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await qo.project("project-id")}catch{return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(t=>e(null,t),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof Kn.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof jo.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[t,n]=await Promise.all([qo.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:t,universe_domain:n}}throw new Error(Wt.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#e=this.#e||this.#r();try{return await this.#e}finally{this.#e=null}}async#r(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=nl.resolve(this.keyFilename),t=No.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}else if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#t(e);return t}else{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new pw.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,s=await(await this.getClient()).getRequestHeaders(t);return e.headers=lw.Gaxios.mergeHeaders(e.headers,s),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,mw.getEnv)()}async sign(e,t){let n=await this.getClient(),s=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${s}/v1/projects/-/serviceAccounts/`,n instanceof Kn.Impersonated)return(await n.sign(e)).signedBlob;let a=(0,dw.createCrypto)();if(n instanceof Vn.JWT&&n.key)return await a.sign(n.key,e);let u=await this.getCredentials();if(!u.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(a,u.client_email,e,t)}async signBlob(e,t,n,s){let a=new URL(s+`${t}:signBlob`);return(await this.request({method:"POST",url:a.href,data:{payload:e.encodeBase64StringUtf8(n)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}};Wt.GoogleAuth=sl});var Km=z(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});Hi.IAMAuth=void 0;var il=class{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};Hi.IAMAuth=il});var Ym=z(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.DownscopedClient=rr.EXPIRATION_TIME_OFFSET=rr.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var yw=Ve(),_w=require("stream"),al=gt(),Cw=Ai(),bw="urn:ietf:params:oauth:grant-type:token-exchange",Ew="urn:ietf:params:oauth:token-type:access_token",ww="urn:ietf:params:oauth:token-type:access_token";rr.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;rr.EXPIRATION_TIME_OFFSET=5*60*1e3;var ul=class extends al.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,t={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof al.AuthClient?{}:e),e instanceof al.AuthClient?(this.authClient=e,this.credentialAccessBoundary=t):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>rr.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${rr.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let n of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(n.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new Cw.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=yw.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let u=a.status,l=a.config.data instanceof _w.Readable;if(!t&&(u===401||u===403)&&!l&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t={grantType:bw,requestedTokenType:Ew,subjectToken:e,subjectTokenType:ww},n=await this.stsCredential.exchangeToken(t,void 0,this.credentialAccessBoundary),s=this.authClient.credentials?.expiry_date||null,a=n.expires_in?new Date().getTime()+n.expires_in*1e3:s;return this.cachedDownscopedAccessToken={access_token:n.access_token,expiry_date:a,res:n.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};rr.DownscopedClient=ul});var Xm=z(Gi=>{"use strict";Object.defineProperty(Gi,"__esModule",{value:!0});Gi.PassThroughClient=void 0;var Aw=gt(),cl=class extends Aw.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}};Gi.PassThroughClient=cl});var fl=z(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.GoogleAuth=Z.auth=Z.PassThroughClient=Z.ExecutableError=Z.PluggableAuthClient=Z.DownscopedClient=Z.BaseExternalAccountClient=Z.ExternalAccountClient=Z.IdentityPoolClient=Z.AwsRequestSigner=Z.AwsClient=Z.UserRefreshClient=Z.LoginTicket=Z.ClientAuthentication=Z.OAuth2Client=Z.CodeChallengeMethod=Z.Impersonated=Z.JWT=Z.JWTAccess=Z.IdTokenClient=Z.IAMAuth=Z.GCPEnv=Z.Compute=Z.DEFAULT_UNIVERSE=Z.AuthClient=Z.gaxios=Z.gcpMetadata=void 0;var Qm=Vm();Object.defineProperty(Z,"GoogleAuth",{enumerable:!0,get:function(){return Qm.GoogleAuth}});Z.gcpMetadata=wo();Z.gaxios=Ve();var Zm=gt();Object.defineProperty(Z,"AuthClient",{enumerable:!0,get:function(){return Zm.AuthClient}});Object.defineProperty(Z,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return Zm.DEFAULT_UNIVERSE}});var Dw=Xu();Object.defineProperty(Z,"Compute",{enumerable:!0,get:function(){return Dw.Compute}});var Sw=ec();Object.defineProperty(Z,"GCPEnv",{enumerable:!0,get:function(){return Sw.GCPEnv}});var vw=Km();Object.defineProperty(Z,"IAMAuth",{enumerable:!0,get:function(){return vw.IAMAuth}});var Tw=Zu();Object.defineProperty(Z,"IdTokenClient",{enumerable:!0,get:function(){return Tw.IdTokenClient}});var Rw=yc();Object.defineProperty(Z,"JWTAccess",{enumerable:!0,get:function(){return Rw.JWTAccess}});var kw=Cc();Object.defineProperty(Z,"JWT",{enumerable:!0,get:function(){return kw.JWT}});var Fw=Ac();Object.defineProperty(Z,"Impersonated",{enumerable:!0,get:function(){return Fw.Impersonated}});var ll=an();Object.defineProperty(Z,"CodeChallengeMethod",{enumerable:!0,get:function(){return ll.CodeChallengeMethod}});Object.defineProperty(Z,"OAuth2Client",{enumerable:!0,get:function(){return ll.OAuth2Client}});Object.defineProperty(Z,"ClientAuthentication",{enumerable:!0,get:function(){return ll.ClientAuthentication}});var Ow=Ju();Object.defineProperty(Z,"LoginTicket",{enumerable:!0,get:function(){return Ow.LoginTicket}});var Pw=Ec();Object.defineProperty(Z,"UserRefreshClient",{enumerable:!0,get:function(){return Pw.UserRefreshClient}});var xw=$c();Object.defineProperty(Z,"AwsClient",{enumerable:!0,get:function(){return xw.AwsClient}});var Bw=Lc();Object.defineProperty(Z,"AwsRequestSigner",{enumerable:!0,get:function(){return Bw.AwsRequestSigner}});var Iw=qc();Object.defineProperty(Z,"IdentityPoolClient",{enumerable:!0,get:function(){return Iw.IdentityPoolClient}});var Nw=el();Object.defineProperty(Z,"ExternalAccountClient",{enumerable:!0,get:function(){return Nw.ExternalAccountClient}});var qw=jr();Object.defineProperty(Z,"BaseExternalAccountClient",{enumerable:!0,get:function(){return qw.BaseExternalAccountClient}});var jw=Ym();Object.defineProperty(Z,"DownscopedClient",{enumerable:!0,get:function(){return jw.DownscopedClient}});var eg=Qc();Object.defineProperty(Z,"PluggableAuthClient",{enumerable:!0,get:function(){return eg.PluggableAuthClient}});Object.defineProperty(Z,"ExecutableError",{enumerable:!0,get:function(){return eg.ExecutableError}});var Lw=Xm();Object.defineProperty(Z,"PassThroughClient",{enumerable:!0,get:function(){return Lw.PassThroughClient}});var Uw=new Qm.GoogleAuth;Z.auth=Uw});var Kw={};Ba(Kw,{default:()=>Vw});module.exports=t0(Kw);var hg=qe(require("fastify"),1),pg=qe(require("@fastify/cors"),1);var ao=require("fs"),Ga=require("path"),Lf=require("dotenv"),Uf=qe(Ha(),1),Cs=class{config={};options;constructor(e={jsonPath:"./config.json"}){this.options={envPath:e.envPath||".env",jsonPath:e.jsonPath,useEnvFile:!1,useJsonFile:e.useJsonFile!==!1,useEnvironmentVariables:e.useEnvironmentVariables!==!1,...e},this.loadConfig()}loadConfig(){this.options.useJsonFile&&this.options.jsonPath&&this.loadJsonConfig(),this.options.initialConfig&&(this.config={...this.config,...this.options.initialConfig}),this.options.useEnvFile&&this.loadEnvConfig(),this.config.LOG_FILE&&(process.env.LOG_FILE=this.config.LOG_FILE),this.config.LOG&&(process.env.LOG=this.config.LOG)}loadJsonConfig(){if(!this.options.jsonPath)return;let e=this.isAbsolutePath(this.options.jsonPath)?this.options.jsonPath:(0,Ga.join)(process.cwd(),this.options.jsonPath);if((0,ao.existsSync)(e))try{let t=(0,ao.readFileSync)(e,"utf-8"),n=Uf.default.parse(t);this.config={...this.config,...n},console.log(`Loaded JSON config from: ${e}`)}catch(t){console.warn(`Failed to load JSON config from ${e}:`,t)}else console.warn(`JSON config file not found: ${e}`)}loadEnvConfig(){let e=this.isAbsolutePath(this.options.envPath)?this.options.envPath:(0,Ga.join)(process.cwd(),this.options.envPath);if((0,ao.existsSync)(e))try{let t=(0,Lf.config)({path:e});t.parsed&&(this.config={...this.config,...this.parseEnvConfig(t.parsed)})}catch(t){console.warn(`Failed to load .env config from ${e}:`,t)}}loadEnvironmentVariables(){let e=this.parseEnvConfig(process.env);this.config={...this.config,...e}}parseEnvConfig(e){let t={};return Object.assign(t,e),t}isAbsolutePath(e){return e.startsWith("/")||e.includes(":")}get(e,t){let n=this.config[e];return n!==void 0?n:t}getAll(){return{...this.config}}getHttpsProxy(){return this.get("HTTPS_PROXY")||this.get("https_proxy")||this.get("httpsProxy")||this.get("PROXY_URL")}has(e){return this.config[e]!==void 0}set(e,t){this.config[e]=t}reload(){this.config={},this.loadConfig()}getConfigSummary(){let e=[];return this.options.initialConfig&&e.push("Initial Config"),this.options.useJsonFile&&this.options.jsonPath&&e.push(`JSON: ${this.options.jsonPath}`),this.options.useEnvFile&&e.push(`ENV: ${this.options.envPath}`),this.options.useEnvironmentVariables&&e.push("Environment Variables"),`Config sources: ${e.join(", ")}`}};var Mf=qe(require("node:fs"),1);function re(...r){if(console.log(...r),!(process.env.LOG==="true"))return;let n=`[${new Date().toISOString()}] ${Array.isArray(r)?r.map(a=>typeof a=="object"?JSON.stringify(a):String(a)).join(" "):""}
`,s=process.env.LOG_FILE||"app.log";Mf.default.appendFileSync(s,n,"utf8")}function At(r,e=500,t="internal_error",n="api_error"){let s=new Error(r);return s.statusCode=e,s.code=t,s.type=n,s}async function $f(r,e,t){e.log.error(r);let n=r.statusCode||500,s={error:{message:r.message+r.stack||"Internal Server Error",type:r.type||"api_error",code:r.code||"internal_error"}};return t.code(n).send(s)}var Hf=require("undici");function Gf(r,e,t){let n=new Headers({"Content-Type":"application/json"});t.headers&&Object.entries(t.headers).forEach(([l,f])=>{n.set(l,f)});let s,a=AbortSignal.timeout(t.TIMEOUT??60*1e3*60);if(t.signal){let l=new AbortController,f=()=>l.abort();t.signal.addEventListener("abort",f),a.addEventListener("abort",f),s=l.signal}else s=a;let u={method:"POST",headers:n,body:JSON.stringify(e),signal:s};return t.httpsProxy&&(u.dispatcher=new Hf.ProxyAgent(new URL(t.httpsProxy).toString())),re("final request:",typeof r=="string"?r:r.toString(),t.httpsProxy,u),fetch(typeof r=="string"?r:r.toString(),u)}var Wf="1.0.19";async function f0(r,e,t,n){let s=r.body,a=r.provider,u=t._server.providerService.getProvider(a);if(!u)throw At(`Provider '${a}' not found`,404,"provider_not_found");let{requestBody:l,config:f,bypass:d}=await d0(s,u,n,r.headers),h=await p0(l,f,u,t,d,n),C=await m0(l,h,u,n,d);return g0(C,e,s)}async function d0(r,e,t,n){let s=r,a={},u=!1;if(u=h0(e,t,r),u&&(a.headers=n),!u&&typeof t.transformRequestOut=="function"){let l=await t.transformRequestOut(s);l.body?(s=l.body,a=l.config||{}):s=l}if(!u&&e.transformer?.use?.length){!u&&re("use transformers:",e.transformer?.use);for(let l of e.transformer.use){if(!l||typeof l.transformRequestIn!="function")continue;let f=await l.transformRequestIn(s,e);f.body?(s=f.body,a={...a,...f.config}):s=f}}if(!u&&e.transformer?.[r.model]?.use?.length)for(let l of e.transformer[r.model].use)!l||typeof l.transformRequestIn!="function"||(s=await l.transformRequestIn(s,e));return{requestBody:s,config:a,bypass:u}}function h0(r,e,t){return r.transformer?.use?.length===1&&r.transformer.use[0].name===e.name&&(!r.transformer?.[t.model]?.use.length||r.transformer?.[t.model]?.use.length===1&&r.transformer?.[t.model]?.use[0].name===e.name)}async function p0(r,e,t,n,s,a){let u=e.url||new URL(t.baseUrl);if(s&&typeof a.auth=="function"){let f=await a.auth(r,t);f.body?(r=f.body,e={...e,...f.config}):r=f}let l=await Gf(u,r,{httpsProxy:n._server.configService.getHttpsProxy(),...e,headers:{Authorization:`Bearer ${t.apiKey}`,...e?.headers||{}}});if(!l.ok){let f=await l.text();throw re(`Error response from ${u}: ${f}`),At(`Error from provider: ${f}`,l.status,"provider_response_error")}return l}async function m0(r,e,t,n,s){let a=e;if(!s&&t.transformer?.use?.length)for(let u of t.transformer.use)!u||typeof u.transformResponseOut!="function"||(a=await u.transformResponseOut(a));if(!s&&t.transformer?.[r.model]?.use?.length)for(let u of t.transformer[r.model].use)!u||typeof u.transformResponseOut!="function"||(a=await u.transformResponseOut(a));return!s&&n.transformResponseIn&&(a=await n.transformResponseIn(a)),a}function g0(r,e,t){return r.ok||e.code(r.status),t?.stream===!0?(e.header("Content-Type","text/event-stream"),e.header("Cache-Control","no-cache"),e.header("Connection","keep-alive"),e.send(r.body)):r.json()}var zf=async r=>{r.get("/",async()=>({message:"LLMs API",version:Wf})),r.get("/health",async()=>({status:"ok",timestamp:new Date().toISOString()}));let e=r._server.transformerService.getTransformersWithEndpoint();for(let{transformer:t}of e)t.endPoint&&r.post(t.endPoint,async(n,s)=>f0(n,s,r,t));r.post("/providers",{schema:{body:{type:"object",properties:{id:{type:"string"},name:{type:"string"},type:{type:"string",enum:["openai","anthropic"]},baseUrl:{type:"string"},apiKey:{type:"string"},models:{type:"array",items:{type:"string"}}},required:["id","name","type","baseUrl","apiKey","models"]}}},async(t,n)=>{let{name:s,baseUrl:a,apiKey:u,models:l}=t.body;if(!s?.trim())throw At("Provider name is required",400,"invalid_request");if(!a||!y0(a))throw At("Valid base URL is required",400,"invalid_request");if(!u?.trim())throw At("API key is required",400,"invalid_request");if(!l||!Array.isArray(l)||l.length===0)throw At("At least one model is required",400,"invalid_request");if(r._server.providerService.getProvider(t.body.name))throw At(`Provider with name '${t.body.name}' already exists`,400,"provider_exists");return r._server.providerService.registerProvider(t.body)}),r.get("/providers",async()=>r._server.providerService.getProviders()),r.get("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]}}},async t=>{let n=r._server.providerService.getProvider(t.params.id);if(!n)throw At("Provider not found",404,"provider_not_found");return n}),r.put("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]},body:{type:"object",properties:{name:{type:"string"},type:{type:"string",enum:["openai","anthropic"]},baseUrl:{type:"string"},apiKey:{type:"string"},models:{type:"array",items:{type:"string"}},enabled:{type:"boolean"}}}}},async(t,n)=>{let s=r._server.providerService.updateProvider(t.params.id,t.body);if(!s)throw At("Provider not found",404,"provider_not_found");return s}),r.delete("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]}}},async t=>{if(!r._server.providerService.deleteProvider(t.params.id))throw At("Provider not found",404,"provider_not_found");return{message:"Provider deleted successfully"}}),r.patch("/providers/:id/toggle",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]},body:{type:"object",properties:{enabled:{type:"boolean"}},required:["enabled"]}}},async(t,n)=>{if(!r._server.providerService.toggleProvider(t.params.id,t.body.enabled))throw At("Provider not found",404,"provider_not_found");return{message:`Provider ${t.body.enabled?"enabled":"disabled"} successfully`}})};function y0(r){try{return new URL(r),!0}catch{return!1}}var bs=class{constructor(e){this.providerService=e}registerProvider(e){return this.providerService.registerProvider(e)}getProviders(){return this.providerService.getProviders()}getProvider(e){return this.providerService.getProvider(e)}updateProvider(e,t){return this.providerService.updateProvider(e,t)}deleteProvider(e){return this.providerService.deleteProvider(e)}toggleProvider(e,t){return this.providerService.toggleProvider(e,t)}resolveRoute(e){let t=this.providerService.resolveModelRoute(e);if(!t)throw new Error(`Model ${e} not found. Available models: ${this.getAvailableModelNames().join(", ")}`);return t}async getAvailableModels(){return{object:"list",data:this.providerService.getAvailableModels().flatMap(t=>t.models.map(n=>({id:n,object:"model",provider:t.provider,created:Math.floor(Date.now()/1e3),owned_by:t.provider})))}}getAvailableModelNames(){return this.providerService.getModelRoutes().map(e=>e.fullModel)}getModelRoutes(){return this.providerService.getModelRoutes()}};var Es=class{constructor(e,t){this.configService=e;this.transformerService=t;this.initializeCustomProviders()}providers=new Map;modelRoutes=new Map;initializeCustomProviders(){let e=this.configService.get("providers");if(e&&Array.isArray(e)){this.initializeFromProvidersArray(e);return}}initializeFromProvidersArray(e){e.forEach(t=>{try{if(!t.name||!t.api_base_url||!t.api_key)return;let n={};t.transformer&&Object.keys(t.transformer).forEach(s=>{s==="use"?Array.isArray(t.transformer.use)&&(n.use=t.transformer.use.map(a=>{if(Array.isArray(a)&&typeof a[0]=="string"){let u=this.transformerService.getTransformer(a[0]);if(u)return new u(a[1])}if(typeof a=="string"){let u=this.transformerService.getTransformer(a);return typeof u=="function"?new u:u}}).filter(a=>typeof a<"u")):Array.isArray(t.transformer[s]?.use)&&(n[s]={use:t.transformer[s].use.map(a=>{if(Array.isArray(a)&&typeof a[0]=="string"){let u=this.transformerService.getTransformer(a[0]);if(u)return new u(a[1])}if(typeof a=="string"){let u=this.transformerService.getTransformer(a);return typeof u=="function"?new u:u}}).filter(a=>typeof a<"u")})}),this.registerProvider({name:t.name,baseUrl:t.api_base_url,apiKey:t.api_key,models:t.models||[],transformer:t.transformer?n:void 0}),re(`${t.name} provider registered`)}catch(n){re(`${t.name} provider registered error: ${n}`)}})}registerProvider(e){let t={...e};return this.providers.set(t.name,t),e.models.forEach(n=>{let s=`${t.name},${n}`,a={provider:t.name,model:n,fullModel:s};this.modelRoutes.set(s,a),this.modelRoutes.has(n)||this.modelRoutes.set(n,a)}),t}getProviders(){return Array.from(this.providers.values())}getProvider(e){return this.providers.get(e)}updateProvider(e,t){let n=this.providers.get(e);if(!n)return null;let s={...n,...t,updatedAt:new Date};return this.providers.set(e,s),t.models&&(n.models.forEach(a=>{let u=`${n.id},${a}`;this.modelRoutes.delete(u),this.modelRoutes.delete(a)}),t.models.forEach(a=>{let u=`${n.name},${a}`,l={provider:n.name,model:a,fullModel:u};this.modelRoutes.set(u,l),this.modelRoutes.has(a)||this.modelRoutes.set(a,l)})),s}deleteProvider(e){let t=this.providers.get(e);return t?(t.models.forEach(n=>{let s=`${t.name},${n}`;this.modelRoutes.delete(s),this.modelRoutes.delete(n)}),this.providers.delete(e),!0):!1}toggleProvider(e,t){return!!this.providers.get(e)}resolveModelRoute(e){let t=this.modelRoutes.get(e);if(!t)return null;let n=this.providers.get(t.provider);return n?{provider:n,originalModel:e,targetModel:t.model}:null}getAvailableModelNames(){let e=[];return this.providers.forEach(t=>{t.models.forEach(n=>{e.push(n),e.push(`${t.name},${n}`)})}),e}getModelRoutes(){return Array.from(this.modelRoutes.values())}parseTransformerConfig(e){return e?Array.isArray(e)?e.reduce((t,n)=>{if(Array.isArray(n)){let[s,a={}]=n;t[s]=a}else t[n]={};return t},{}):e:{}}async getAvailableModels(){let e=[];return this.providers.forEach(t=>{t.models.forEach(n=>{e.push({id:n,object:"model",owned_by:t.name,provider:t.name}),e.push({id:`${t.name},${n}`,object:"model",owned_by:t.name,provider:t.name})})}),{object:"list",data:e}}};var Je=[];for(let r=0;r<256;++r)Je.push((r+256).toString(16).slice(1));function Jf(r,e=0){return(Je[r[e+0]]+Je[r[e+1]]+Je[r[e+2]]+Je[r[e+3]]+"-"+Je[r[e+4]]+Je[r[e+5]]+"-"+Je[r[e+6]]+Je[r[e+7]]+"-"+Je[r[e+8]]+Je[r[e+9]]+"-"+Je[r[e+10]]+Je[r[e+11]]+Je[r[e+12]]+Je[r[e+13]]+Je[r[e+14]]+Je[r[e+15]]).toLowerCase()}var Vf=require("crypto"),As=new Uint8Array(256),ws=As.length;function Wa(){return ws>As.length-16&&((0,Vf.randomFillSync)(As),ws=0),As.slice(ws,ws+=16)}var Kf=require("crypto"),za={randomUUID:Kf.randomUUID};function _0(r,e,t){if(za.randomUUID&&!e&&!r)return za.randomUUID();r=r||{};let n=r.random??r.rng?.()??Wa();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let s=0;s<16;++s)e[t+s]=n[s];return e}return Jf(n)}var Or=_0;var Yf=r=>r<=0?"none":r<=1024?"low":r<=8192?"medium":"high";var Ds=class{name="Anthropic";endPoint="/v1/messages";async auth(e,t){return{body:e,config:{headers:{"x-api-key":t.apiKey,Authorization:void 0}}}}async transformRequestOut(e){re("Anthropic Request:",JSON.stringify(e,null,2));let t=[];if(e.system){if(typeof e.system=="string")t.push({role:"system",content:e.system});else if(Array.isArray(e.system)&&e.system.length){let a=e.system.filter(u=>u.type==="text"&&u.text).map(u=>({type:"text",text:u.text,cache_control:u.cache_control}));t.push({role:"system",content:a})}}JSON.parse(JSON.stringify(e.messages||[]))?.forEach((a,u)=>{if(a.role==="user"||a.role==="assistant"){if(typeof a.content=="string"){t.push({role:a.role,content:a.content});return}if(Array.isArray(a.content)){if(a.role==="user"){let l=a.content.filter(d=>d.type==="tool_result"&&d.tool_use_id);l.length&&l.forEach((d,h)=>{let C={role:"tool",content:typeof d.content=="string"?d.content:JSON.stringify(d.content),tool_call_id:d.tool_use_id,cache_control:d.cache_control};t.push(C)});let f=a.content.filter(d=>d.type==="text"&&d.text||d.type==="image"&&d.source);f.length&&t.push({role:"user",content:f.map(d=>d?.type==="image"?{type:"image_url",image_url:{url:d.source?.type==="base64"?d.source.data:d.source.url},media_type:d.source.media_type}:d)})}else if(a.role==="assistant"){let l={role:"assistant",content:null},f=a.content.filter(h=>h.type==="text"&&h.text);f.length&&(l.content=f.map(h=>h.text).join(`
`));let d=a.content.filter(h=>h.type==="tool_use"&&h.id);d.length&&(l.tool_calls=d.map(h=>({id:h.id,type:"function",function:{name:h.name,arguments:JSON.stringify(h.input||{})}}))),t.push(l)}return}}});let s={messages:t,model:e.model,max_tokens:e.max_tokens,temperature:e.temperature,stream:e.stream,tools:e.tools?.length?this.convertAnthropicToolsToUnified(e.tools):void 0,tool_choice:e.tool_choice};return e.thinking&&(s.reasoning={effort:Yf(e.thinking.budget_tokens),max_tokens:e.thinking.budget_tokens,enabled:e.thinking.type==="enabled"}),e.tool_choice&&(e.tool_choice.type==="tool"?s.tool_choice={type:"function",function:{name:e.tool_choice.name}}:s.tool_choice=e.tool_choice.type),s}async transformResponseIn(e,t){if(e.headers.get("Content-Type")?.includes("text/event-stream")){if(!e.body)throw new Error("Stream response body is null");let s=await this.convertOpenAIStreamToAnthropic(e.body);return new Response(s,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}else{let s=await e.json(),a=this.convertOpenAIResponseToAnthropic(s);return new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}})}}convertAnthropicToolsToUnified(e){return e.map(t=>({type:"function",function:{name:t.name,description:t.description||"",parameters:t.input_schema}}))}async convertOpenAIStreamToAnthropic(e){return new ReadableStream({async start(n){let s=new TextEncoder,a=`msg_${Date.now()}`,u="unknown",l=!1,f=!1,d=!1,h=new Map,C=new Map,w=0,I=0,S=0,b=!1,_=!1,y=0,T=P=>{if(!b)try{n.enqueue(P);let j=new TextDecoder().decode(P);re("send data:",j.trim())}catch(j){if(j instanceof TypeError&&j.message.includes("Controller is already closed"))b=!0;else throw re(`send data error: ${j.message}`),j}},F=()=>{if(!b)try{n.close(),b=!0}catch(P){if(P instanceof TypeError&&P.message.includes("Controller is already closed"))b=!0;else throw P}},L=null;try{L=e.getReader();let P=new TextDecoder,j="";for(;!b;){let{done:G,value:te}=await L.read();if(G)break;j+=P.decode(te,{stream:!0});let W=j.split(`
`);j=W.pop()||"";for(let be of W){if(b||d)break;if(!be.startsWith("data: "))continue;let de=be.slice(6);if(de!=="[DONE]")try{let oe=JSON.parse(de);if(w++,re("Original Response:",JSON.stringify(oe,null,2)),oe.error){let Q={type:"error",message:{type:"api_error",message:JSON.stringify(oe.error)}};T(s.encode(`event: error
data: ${JSON.stringify(Q)}

`));continue}if(u=oe.model||u,!l&&!b&&!d){l=!0;let Q={type:"message_start",message:{id:a,type:"message",role:"assistant",content:[],model:u,stop_reason:null,stop_sequence:null,usage:{input_tokens:1,output_tokens:1}}};T(s.encode(`event: message_start
data: ${JSON.stringify(Q)}

`))}let ae=oe.choices?.[0];if(!ae)continue;if(ae?.delta?.thinking&&!b&&!d){if(!_){let Q={type:"content_block_start",index:y,content_block:{type:"thinking",thinking:""}};T(s.encode(`event: content_block_start
data: ${JSON.stringify(Q)}

`)),_=!0}if(ae.delta.thinking.signature){let Q={type:"content_block_delta",index:y,delta:{type:"signature_delta",signature:ae.delta.thinking.signature}};T(s.encode(`event: content_block_delta
data: ${JSON.stringify(Q)}

`));let ue={type:"content_block_stop",index:y};T(s.encode(`event: content_block_stop
data: ${JSON.stringify(ue)}

`)),y++}else if(ae.delta.thinking.content){let Q={type:"content_block_delta",index:y,delta:{type:"thinking_delta",thinking:ae.delta.thinking.content||""}};T(s.encode(`event: content_block_delta
data: ${JSON.stringify(Q)}

`))}}if(ae?.delta?.content&&!b&&!d){if(I++,!f&&!d){f=!0;let Q={type:"content_block_start",index:y,content_block:{type:"text",text:""}};T(s.encode(`event: content_block_start
data: ${JSON.stringify(Q)}

`))}if(!b&&!d){let Q={type:"content_block_delta",index:y,delta:{type:"text_delta",text:ae.delta.content}};T(s.encode(`event: content_block_delta
data: ${JSON.stringify(Q)}

`))}}if(ae?.delta?.annotations?.length&&!b&&!d){let Q={type:"content_block_stop",index:y};T(s.encode(`event: content_block_stop
data: ${JSON.stringify(Q)}

`)),f=!1,ae?.delta?.annotations.forEach((ue,he,ve)=>{y++;let J={type:"content_block_start",index:y,content_block:{type:"web_search_tool_result",tool_use_id:`srvtoolu_${Or()}`,content:[{type:"web_search_result",title:ue.url_citation.title,url:ue.url_citation.url}]}};T(s.encode(`event: content_block_start
data: ${JSON.stringify(J)}

`));let Y={type:"content_block_stop",index:y};T(s.encode(`event: content_block_stop
data: ${JSON.stringify(Y)}

`))})}if(ae?.delta?.tool_calls&&!b&&!d){S++;let Q=new Set;for(let ue of ae.delta.tool_calls){if(b)break;let he=ue.index??0;if(Q.has(he))continue;if(Q.add(he),!C.has(he)){let J=f?C.size+1:C.size;if(J!==0){re("content_block_stop2");let H={type:"content_block_stop",index:y};T(s.encode(`event: content_block_stop
data: ${JSON.stringify(H)}

`)),y++}C.set(he,J);let Y=ue.id||`call_${Date.now()}_${he}`,ce=ue.function?.name||`tool_${he}`,Ne={type:"content_block_start",index:y,content_block:{type:"tool_use",id:Y,name:ce,input:{}}};T(s.encode(`event: content_block_start
data: ${JSON.stringify(Ne)}

`));let ze={id:Y,name:ce,arguments:"",contentBlockIndex:J};h.set(he,ze)}else if(ue.id&&ue.function?.name){let J=h.get(he);J.id.startsWith("call_")&&J.name.startsWith("tool_")&&(J.id=ue.id,J.name=ue.function.name)}if(ue.function?.arguments&&!b&&!d){if(C.get(he)===void 0)continue;let Y=h.get(he);Y&&(Y.arguments+=ue.function.arguments);try{let ce={type:"content_block_delta",index:y,delta:{type:"input_json_delta",partial_json:ue.function.arguments}};T(s.encode(`event: content_block_delta
data: ${JSON.stringify(ce)}

`))}catch{try{let Ne=ue.function.arguments.replace(/[\x00-\x1F\x7F-\x9F]/g,"").replace(/\\/g,"\\\\").replace(/"/g,'\\"'),ze={type:"content_block_delta",index:y,delta:{type:"input_json_delta",partial_json:Ne}};T(s.encode(`event: content_block_delta
data: ${JSON.stringify(ze)}

`))}catch(Ne){console.error(Ne)}}}}}if(ae?.finish_reason&&!b&&!d){if(d=!0,I===0&&S===0&&console.error("Warning: No content in the stream response!"),(f||S>0)&&!b){re("content_block_stop hasTextContentStarted");let Q={type:"content_block_stop",index:y};T(s.encode(`event: content_block_stop
data: ${JSON.stringify(Q)}

`))}if(!b){let he={type:"message_delta",delta:{stop_reason:{stop:"end_turn",length:"max_tokens",tool_calls:"tool_use",content_filter:"stop_sequence"}[ae.finish_reason]||"end_turn",stop_sequence:null},usage:{input_tokens:oe.usage?.prompt_tokens||0,output_tokens:oe.usage?.completion_tokens||0}};T(s.encode(`event: message_delta
data: ${JSON.stringify(he)}

`))}if(!b){let Q={type:"message_stop"};T(s.encode(`event: message_stop
data: ${JSON.stringify(Q)}

`))}break}}catch(oe){re(`parseError: ${oe.name} message: ${oe.message} stack: ${oe.stack} data: ${de}`)}}}F()}catch(P){if(!b)try{n.error(P)}catch(j){console.error(j)}}finally{if(L)try{L.releaseLock()}catch(P){console.error(P)}}},cancel(n){re("cancle stream:",n)}})}convertOpenAIResponseToAnthropic(e){re("Original OpenAI response:",JSON.stringify(e,null,2));let t=e.choices[0];if(!t)throw new Error("No choices found in OpenAI response");let n=[];if(t.message.annotations){let a=`srvtoolu_${Or()}`;n.push({type:"server_tool_use",id:a,name:"web_search",input:{query:""}}),n.push({type:"web_search_tool_result",tool_use_id:a,content:t.message.annotations.map(u=>({type:"web_search_result",url:u.url_citation.url,title:u.url_citation.title}))})}t.message.content&&n.push({type:"text",text:t.message.content}),t.message.tool_calls&&t.message.tool_calls.length>0&&t.message.tool_calls.forEach((a,u)=>{let l={};try{let f=a.function.arguments||"{}";typeof f=="object"?l=f:typeof f=="string"&&(l=JSON.parse(f))}catch{l={text:a.function.arguments||""}}n.push({type:"tool_use",id:a.id,name:a.function.name,input:l})});let s={id:e.id,type:"message",role:"assistant",model:e.model,content:n,stop_reason:t.finish_reason==="stop"?"end_turn":t.finish_reason==="length"?"max_tokens":t.finish_reason==="tool_calls"?"tool_use":t.finish_reason==="content_filter"?"stop_sequence":"end_turn",stop_sequence:null,usage:{input_tokens:e.usage?.prompt_tokens||0,output_tokens:e.usage?.completion_tokens||0}};return re("Conversion complete, final Anthropic response:",JSON.stringify(s,null,2)),s}};function Ja(r){if(!(!r||typeof r!="object")){if(Array.isArray(r)){r.forEach(Ja);return}delete r.$schema,delete r.additionalProperties,delete r.const,r.type==="string"&&r.format&&!["enum","date-time"].includes(r.format)&&delete r.format,Object.keys(r).forEach(e=>{Ja(r[e])})}}function Ss(r){let e=[],t=r.tools?.filter(a=>a.function.name!=="web_search")?.map(a=>(a.function.parameters&&Ja(a.function.parameters),{name:a.function.name,description:a.function.description,parameters:a.function.parameters}));return t?.length&&e.push({functionDeclarations:t}),r.tools?.find(a=>a.function.name==="web_search")&&e.push({googleSearch:{}}),{contents:r.messages.map(a=>{let u;a.role==="assistant"?u="model":(["user","system","tool"].includes(a.role),u="user");let l=[];return typeof a.content=="string"?l.push({text:a.content}):Array.isArray(a.content)&&l.push(...a.content.map(f=>{if(f.type==="text")return{text:f.text||""};if(f.type==="image_url")return f.image_url.url.startsWith("http")?{file_data:{mime_type:f.media_type,file_uri:f.image_url.url}}:{inlineData:{mime_type:f.media_type,data:f.image_url.url}}})),Array.isArray(a.tool_calls)&&l.push(...a.tool_calls.map(f=>({functionCall:{id:f.id||`tool_${Math.random().toString(36).substring(2,15)}`,name:f.function.name,args:JSON.parse(f.function.arguments||"{}")}}))),{role:u,parts:l}}),tools:e.length?e:void 0}}function vs(r){let e=r.contents,t=r.tools,n=r.model,s=r.max_tokens,a=r.temperature,u=r.stream,l=r.tool_choice,f={messages:[],model:n,max_tokens:s,temperature:a,stream:u,tool_choice:l};return Array.isArray(e)&&e.forEach(d=>{typeof d=="string"?f.messages.push({role:"user",content:d}):typeof d.text=="string"?f.messages.push({role:"user",content:d.text||null}):d.role==="user"?f.messages.push({role:"user",content:d?.parts?.map(h=>({type:"text",text:h.text||""}))||[]}):d.role==="model"&&f.messages.push({role:"assistant",content:d?.parts?.map(h=>({type:"text",text:h.text||""}))||[]})}),Array.isArray(t)&&(f.tools=[],t.forEach(d=>{Array.isArray(d.functionDeclarations)&&d.functionDeclarations.forEach(h=>{f.tools.push({type:"function",function:{name:h.name,description:h.description,parameters:h.parameters}})})})),f}async function Ts(r,e){if(r.headers.get("Content-Type")?.includes("application/json")){let t=await r.json(),n=t.candidates[0].content?.parts?.filter(a=>a.functionCall)?.map(a=>({id:a.functionCall?.id||`tool_${Math.random().toString(36).substring(2,15)}`,type:"function",function:{name:a.functionCall?.name,arguments:JSON.stringify(a.functionCall?.args||{})}}))||[],s={id:t.responseId,choices:[{finish_reason:t.candidates[0].finishReason?.toLowerCase()||null,index:0,message:{content:t.candidates[0].content?.parts?.filter(a=>a.text)?.map(a=>a.text)?.join(`
`),role:"assistant",tool_calls:n.length>0?n:void 0}}],created:parseInt(new Date().getTime()/1e3+"",10),model:t.modelVersion,object:"chat.completion",usage:{completion_tokens:t.usageMetadata.candidatesTokenCount,prompt_tokens:t.usageMetadata.promptTokenCount,cached_content_token_count:t.usageMetadata.cachedContentTokenCount||null,total_tokens:t.usageMetadata.totalTokenCount}};return new Response(JSON.stringify(s),{status:r.status,statusText:r.statusText,headers:r.headers})}else if(r.headers.get("Content-Type")?.includes("stream")){if(!r.body)return r;let t=new TextDecoder,n=new TextEncoder,s=(u,l)=>{if(u.startsWith("data: ")){let f=u.slice(6).trim();if(f){re(`${e} chunk:`,f);try{let d=JSON.parse(f),h=d.candidates[0].content?.parts?.filter(w=>w.functionCall)?.map(w=>({id:w.functionCall?.id||`tool_${Math.random().toString(36).substring(2,15)}`,type:"function",function:{name:w.functionCall?.name,arguments:JSON.stringify(w.functionCall?.args||{})}})),C={choices:[{delta:{role:"assistant",content:d.candidates[0].content?.parts?.filter(w=>w.text)?.map(w=>w.text)?.join(`
`),tool_calls:h.length>0?h:void 0},finish_reason:d.candidates[0].finishReason?.toLowerCase()||null,index:d.candidates[0].index||h.length>0?1:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.responseId||"",model:d.modelVersion||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usageMetadata.candidatesTokenCount,prompt_tokens:d.usageMetadata.promptTokenCount,cached_content_token_count:d.usageMetadata.cachedContentTokenCount||null,total_tokens:d.usageMetadata.totalTokenCount}};d.candidates[0]?.groundingMetadata?.groundingChunks?.length&&(C.choices[0].delta.annotations=d.candidates[0].groundingMetadata.groundingChunks.map((w,I)=>{let S=d.candidates[0]?.groundingMetadata?.groundingSupports?.filter(b=>b.groundingChunkIndices.includes(I));return{type:"url_citation",url_citation:{url:w.web.uri,title:w.web.title,content:S?.[0].segment.text,start_index:S?.[0].segment.startIndex,end_index:S?.[0].segment.endIndex}}})),l.enqueue(n.encode(`data: ${JSON.stringify(C)}

`))}catch(d){re(`Error parsing ${e} stream chunk`,f,d.message)}}}},a=new ReadableStream({async start(u){let l=r.body.getReader(),f="";try{for(;;){let{done:d,value:h}=await l.read();if(d){f&&s(f,u);break}f+=t.decode(h,{stream:!0});let C=f.split(`
`);f=C.pop()||"";for(let w of C)s(w,u)}}catch(d){u.error(d)}finally{u.close()}}});return new Response(a,{status:r.status,statusText:r.statusText,headers:r.headers})}return r}var Rs=class{name="gemini";endPoint="/v1beta/models/:modelAndAction";async transformRequestIn(e,t){return{body:Ss(e),config:{url:new URL(`./${e.model}:${e.stream?"streamGenerateContent?alt=sse":"generateContent"}`,t.baseUrl),headers:{"x-goog-api-key":t.apiKey,Authorization:void 0}}}}transformRequestOut=vs;async transformResponseOut(e){return Ts(e,this.name)}};async function Mw(){try{let{GoogleAuth:r}=await Promise.resolve().then(()=>qe(fl(),1));return(await(await new r({scopes:["https://www.googleapis.com/auth/cloud-platform"]}).getClient()).getAccessToken()).token||""}catch(r){throw re("Error getting access token:",r),new Error(`Failed to get access token for Vertex AI. Please ensure you have set up authentication using one of these methods:
1. Set GOOGLE_APPLICATION_CREDENTIALS to point to service account key file
2. Run "gcloud auth application-default login"
3. Use Google Cloud environment with default service account`)}}var Wi=class{name="vertex-gemini";endPoint="/v1/projects/:projectId/locations/:location/publishers/google/models/:modelAndAction";async transformRequestIn(e,t){let n=process.env.GOOGLE_CLOUD_PROJECT,s=process.env.GOOGLE_CLOUD_LOCATION||"us-central1";if(!n&&process.env.GOOGLE_APPLICATION_CREDENTIALS)try{let l=(await import("fs")).readFileSync(process.env.GOOGLE_APPLICATION_CREDENTIALS,"utf8"),f=JSON.parse(l);f&&f.project_id&&(n=f.project_id)}catch(u){re("Error extracting project_id from GOOGLE_APPLICATION_CREDENTIALS:",u)}if(!n)throw new Error("Project ID is required for Vertex AI. Set GOOGLE_CLOUD_PROJECT environment variable or ensure project_id is in GOOGLE_APPLICATION_CREDENTIALS file.");let a=await Mw();return{body:Ss(e),config:{url:new URL(`./v1beta1/projects/${n}/locations/${s}/publishers/google/models/${e.model}:${e.stream?"streamGenerateContent":"generateContent"}`,t.baseUrl.endsWith("/")?t.baseUrl:t.baseUrl+"/"||`https://${s}-aiplatform.googleapis.com`),headers:{Authorization:`Bearer ${a}`,"x-goog-api-key":void 0}}}}transformRequestOut=vs;async transformResponseOut(e){return Ts(e,this.name)}};var zi=class{name="deepseek";async transformRequestIn(e){return e.max_tokens&&e.max_tokens>8192&&(e.max_tokens=8192),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s="",a=!1,u="",l=new ReadableStream({async start(f){let d=e.body.getReader(),h=(w,I,S)=>{let b=w.split(`
`);for(let _ of b)_.trim()&&I.enqueue(S.encode(_+`
`))},C=(w,I)=>{let{controller:S,encoder:b}=I;if(w.startsWith("data: ")&&w.trim()!=="data: [DONE]")try{let _=JSON.parse(w.slice(6));if(_.choices?.[0]?.delta?.reasoning_content){I.appendReasoningContent(_.choices[0].delta.reasoning_content);let y={..._,choices:[{..._.choices[0],delta:{..._.choices[0].delta,thinking:{content:_.choices[0].delta.reasoning_content}}}]};delete y.choices[0].delta.reasoning_content;let T=`data: ${JSON.stringify(y)}

`;S.enqueue(b.encode(T));return}if(_.choices?.[0]?.delta?.content&&I.reasoningContent()&&!I.isReasoningComplete()){I.setReasoningComplete(!0);let y=Date.now().toString(),T={..._,choices:[{..._.choices[0],delta:{..._.choices[0].delta,content:null,thinking:{content:I.reasoningContent(),signature:y}}}]};delete T.choices[0].delta.reasoning_content;let F=`data: ${JSON.stringify(T)}

`;S.enqueue(b.encode(F))}if(_.choices[0]?.delta?.reasoning_content&&delete _.choices[0].delta.reasoning_content,_.choices?.[0]?.delta&&Object.keys(_.choices[0].delta).length>0){I.isReasoningComplete()&&_.choices[0].index++;let y=`data: ${JSON.stringify(_)}

`;S.enqueue(b.encode(y))}}catch{S.enqueue(b.encode(w+`
`))}else S.enqueue(b.encode(w+`
`))};try{for(;;){let{done:w,value:I}=await d.read();if(w){u.trim()&&h(u,f,n);break}let S=t.decode(I,{stream:!0});u+=S;let b=u.split(`
`);u=b.pop()||"";for(let _ of b)if(_.trim())try{C(_,{controller:f,encoder:n,reasoningContent:()=>s,appendReasoningContent:y=>s+=y,isReasoningComplete:()=>a,setReasoningComplete:y=>a=y})}catch(y){console.error("Error processing line:",_,y),f.enqueue(n.encode(_+`
`))}}}catch(w){console.error("Stream error:",w),f.error(w)}finally{try{d.releaseLock()}catch(w){console.error("Error releasing reader lock:",w)}f.close()}}});return new Response(l,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Ji=class{name="tooluse";transformRequestIn(e){return e.messages.push({role:"system",content:"<system-reminder>Tool mode is active. The user expects you to proactively execute the most suitable tool to help complete the task. \nBefore invoking a tool, you must carefully evaluate whether it matches the current task. If no available tool is appropriate for the task, you MUST call the `ExitTool` to exit tool mode \u2014 this is the only valid way to terminate tool mode.\nAlways prioritize completing the user's task effectively and efficiently by using tools whenever appropriate.</system-reminder>"}),e.tools?.length&&(e.tool_choice="required",e.tools.unshift({type:"function",function:{name:"ExitTool",description:`Use this tool when you are in tool mode and have completed the task. This is the only valid way to exit tool mode.
IMPORTANT: Before using this tool, ensure that none of the available tools are applicable to the current task. You must evaluate all available options \u2014 only if no suitable tool can help you complete the task should you use ExitTool to terminate tool mode.
Examples:
1. Task: "Use a tool to summarize this document" \u2014 Do not use ExitTool if a summarization tool is available.
2. Task: "What\u2019s the weather today?" \u2014 If no tool is available to answer, use ExitTool after reasoning that none can fulfill the task.`,parameters:{type:"object",properties:{response:{type:"string",description:"Your response will be forwarded to the user exactly as returned \u2014 the tool will not modify or post-process it in any way."}},required:["response"]}}})),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();if(t?.choices[0]?.message.tool_calls?.length&&t?.choices[0]?.message.tool_calls[0]?.function?.name==="ExitTool"){let n=t?.choices[0]?.message.tool_calls[0],s=JSON.parse(n.function.arguments||"{}");t.choices[0].message.content=s.response||"",delete t.choices[0].message.tool_calls}return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=-1,a="",u="",l=new ReadableStream({async start(f){let d=e.body.getReader(),h=(w,I,S)=>{let b=w.split(`
`);for(let _ of b)_.trim()&&I.enqueue(S.encode(_+`
`))},C=(w,I)=>{let{controller:S,encoder:b,exitToolIndex:_,setExitToolIndex:y,appendExitToolResponse:T}=I;if(w.startsWith("data: ")&&w.trim()!=="data: [DONE]")try{let F=JSON.parse(w.slice(6));if(F.choices[0]?.delta?.tool_calls?.length){let L=F.choices[0].delta.tool_calls[0];if(L.function?.name==="ExitTool"){y(L.index);return}else if(_()>-1&&L.index===_()&&L.function.arguments){T(L.function.arguments);try{let P=JSON.parse(I.exitToolResponse());F.choices=[{delta:{role:"assistant",content:P.response||""}}];let j=`data: ${JSON.stringify(F)}

`;S.enqueue(b.encode(j))}catch{}return}}if(F.choices?.[0]?.delta&&Object.keys(F.choices[0].delta).length>0){let L=`data: ${JSON.stringify(F)}

`;S.enqueue(b.encode(L))}}catch{S.enqueue(b.encode(w+`
`))}else S.enqueue(b.encode(w+`
`))};try{for(;;){let{done:w,value:I}=await d.read();if(w){u.trim()&&h(u,f,n);break}let S=t.decode(I,{stream:!0});u+=S;let b=u.split(`
`);u=b.pop()||"";for(let _ of b)if(_.trim())try{C(_,{controller:f,encoder:n,exitToolIndex:()=>s,setExitToolIndex:y=>s=y,exitToolResponse:()=>a,appendExitToolResponse:y=>a+=y})}catch(y){console.error("Error processing line:",_,y),f.enqueue(n.encode(_+`
`))}}}catch(w){console.error("Stream error:",w),f.error(w)}finally{try{d.releaseLock()}catch(w){console.error("Error releasing reader lock:",w)}f.close()}}});return new Response(l,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Vi=class{constructor(e){this.options=e}static TransformerName="openrouter";async transformRequestIn(e){return e.model.includes("claude")?e.messages.forEach(t=>{Array.isArray(t.content)&&t.content.forEach(n=>{n.type==="image_url"&&(n.image_url.url.startsWith("http")||(n.image_url.url=`data:${n.media_type};base64,${n.image_url.url}`),delete n.media_type)})}):e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control,n.type==="image_url"&&(n.image_url.url.startsWith("http")||(n.image_url.url=`data:${n.media_type};base64,${n.image_url.url}`),delete n.media_type)}):t.cache_control&&delete t.cache_control}),Object.assign(e,this.options||{}),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=!1,a="",u=!1,l=!1,f="",d=new ReadableStream({async start(h){let C=e.body.getReader(),w=(S,b,_)=>{let y=S.split(`
`);for(let T of y)T.trim()&&b.enqueue(_.encode(T+`
`))},I=(S,b)=>{let{controller:_,encoder:y}=b;if(S.startsWith("data: ")&&S.trim()!=="data: [DONE]"){let T=S.slice(6);try{let F=JSON.parse(T);if(F.usage&&(re("usage",F.usage,l),F.choices[0].finish_reason=l?"tool_calls":"stop"),F.choices?.[0]?.finish_reason==="error"&&_.enqueue(y.encode(`data: ${JSON.stringify({error:F.choices?.[0].error})}

`)),F.choices?.[0]?.delta?.content&&!b.hasTextContent()&&b.setHasTextContent(!0),F.choices?.[0]?.delta?.reasoning){b.appendReasoningContent(F.choices[0].delta.reasoning);let P={...F,choices:[{...F.choices?.[0],delta:{...F.choices[0].delta,thinking:{content:F.choices[0].delta.reasoning}}}]};P.choices?.[0]?.delta&&delete P.choices[0].delta.reasoning;let j=`data: ${JSON.stringify(P)}

`;_.enqueue(y.encode(j));return}if(F.choices?.[0]?.delta?.content&&b.reasoningContent()&&!b.isReasoningComplete()){b.setReasoningComplete(!0);let P=Date.now().toString(),j={...F,choices:[{...F.choices?.[0],delta:{...F.choices[0].delta,content:null,thinking:{content:b.reasoningContent(),signature:P}}}]};j.choices?.[0]?.delta&&delete j.choices[0].delta.reasoning;let G=`data: ${JSON.stringify(j)}

`;_.enqueue(y.encode(G))}F.choices?.[0]?.delta?.reasoning&&delete F.choices[0].delta.reasoning,F.choices?.[0]?.delta?.tool_calls?.length&&!Number.isNaN(parseInt(F.choices?.[0]?.delta?.tool_calls[0].id,10))&&F.choices?.[0]?.delta?.tool_calls.forEach(P=>{P.id=`call_${Or()}`}),F.choices?.[0]?.delta?.tool_calls?.length&&!l&&(re("hasToolCall",!0),l=!0),F.choices?.[0]?.delta?.tool_calls?.length&&b.hasTextContent()&&(typeof F.choices[0].index=="number"?F.choices[0].index+=1:F.choices[0].index=1);let L=`data: ${JSON.stringify(F)}

`;_.enqueue(y.encode(L))}catch{_.enqueue(y.encode(S+`
`))}}else _.enqueue(y.encode(S+`
`))};try{for(;;){let{done:S,value:b}=await C.read();if(S){f.trim()&&w(f,h,n);break}if(!b||b.length===0)continue;let _;try{_=t.decode(b,{stream:!0})}catch(T){console.warn("Failed to decode chunk",T);continue}if(_.length===0)continue;if(f+=_,f.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let T=f.split(`
`);f=T.pop()||"";for(let F of T)if(F.trim())try{I(F,{controller:h,encoder:n,hasTextContent:()=>s,setHasTextContent:L=>s=L,reasoningContent:()=>a,appendReasoningContent:L=>a+=L,isReasoningComplete:()=>u,setReasoningComplete:L=>u=L})}catch(L){console.error("Error processing line:",F,L),h.enqueue(n.encode(F+`
`))}continue}let y=f.split(`
`);f=y.pop()||"";for(let T of y)if(T.trim())try{I(T,{controller:h,encoder:n,hasTextContent:()=>s,setHasTextContent:F=>s=F,reasoningContent:()=>a,appendReasoningContent:F=>a+=F,isReasoningComplete:()=>u,setReasoningComplete:F=>u=F})}catch(F){console.error("Error processing line:",T,F),h.enqueue(n.encode(T+`
`))}}}catch(S){console.error("Stream error:",S),h.error(S)}finally{try{C.releaseLock()}catch(S){console.error("Error releasing reader lock:",S)}h.close()}}});return new Response(d,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Ki=class{constructor(e){this.options=e;this.max_tokens=this.options?.max_tokens}static TransformerName="maxtoken";max_tokens;async transformRequestIn(e){return e.max_tokens&&e.max_tokens>this.max_tokens&&(e.max_tokens=this.max_tokens),e}};var Yi=class{name="groq";async transformRequestIn(e){return e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control}):t.cache_control&&delete t.cache_control}),Array.isArray(e.tools)&&e.tools.forEach(t=>{delete t.function.parameters.$schema}),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=!1,a="",u=!1,l="",f=new ReadableStream({async start(d){let h=e.body.getReader(),C=(I,S,b)=>{let _=I.split(`
`);for(let y of _)y.trim()&&S.enqueue(b.encode(y+`
`))},w=(I,S)=>{let{controller:b,encoder:_}=S;if(I.startsWith("data: ")&&I.trim()!=="data: [DONE]"){let y=I.slice(6);try{let T=JSON.parse(y);if(T.error)throw new Error(JSON.stringify(T));T.choices?.[0]?.delta?.content&&!S.hasTextContent()&&S.setHasTextContent(!0),T.choices?.[0]?.delta?.tool_calls?.length&&T.choices?.[0]?.delta?.tool_calls.forEach(L=>{L.id=`call_${Or()}`}),T.choices?.[0]?.delta?.tool_calls?.length&&S.hasTextContent()&&(typeof T.choices[0].index=="number"?T.choices[0].index+=1:T.choices[0].index=1);let F=`data: ${JSON.stringify(T)}

`;b.enqueue(_.encode(F))}catch{b.enqueue(_.encode(I+`
`))}}else b.enqueue(_.encode(I+`
`))};try{for(;;){let{done:I,value:S}=await h.read();if(I){l.trim()&&C(l,d,n);break}if(!S||S.length===0)continue;let b;try{b=t.decode(S,{stream:!0})}catch(y){console.warn("Failed to decode chunk",y);continue}if(b.length===0)continue;if(l+=b,l.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let y=l.split(`
`);l=y.pop()||"";for(let T of y)if(T.trim())try{w(T,{controller:d,encoder:n,hasTextContent:()=>s,setHasTextContent:F=>s=F,reasoningContent:()=>a,appendReasoningContent:F=>a+=F,isReasoningComplete:()=>u,setReasoningComplete:F=>u=F})}catch(F){console.error("Error processing line:",T,F),d.enqueue(n.encode(T+`
`))}continue}let _=l.split(`
`);l=_.pop()||"";for(let y of _)if(y.trim())try{w(y,{controller:d,encoder:n,hasTextContent:()=>s,setHasTextContent:T=>s=T,reasoningContent:()=>a,appendReasoningContent:T=>a+=T,isReasoningComplete:()=>u,setReasoningComplete:T=>u=T})}catch(T){console.error("Error processing line:",y,T),d.enqueue(n.encode(y+`
`))}}}catch(I){console.error("Stream error:",I),d.error(I)}finally{try{h.releaseLock()}catch(I){console.error("Error releasing reader lock:",I)}d.close()}}});return new Response(f,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Xi=class{name="cleancache";async transformRequestIn(e){return Array.isArray(e.messages)&&e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control}):t.cache_control&&delete t.cache_control}),e}};var ug=qe(Ha(),1);var Er=class extends Error{constructor(e,t){super(`${e} at position ${t}`),this.position=t}};function tg(r){return/^[0-9A-Fa-f]$/.test(r)}function Ur(r){return r>="0"&&r<="9"}function rg(r){return r>=" "}function Lo(r){return`,:[]/{}()
+`.includes(r)}function dl(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="_"||r==="$"}function hl(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="_"||r==="$"||r>="0"&&r<="9"}var pl=/^(http|https|ftp|mailto|file|data|irc):\/\/$/,ml=/^[A-Za-z0-9-._~:/?#@!$&'()*+;=]$/;function gl(r){return`,[]/{}
+`.includes(r)}function yl(r){return Uo(r)||$w.test(r)}var $w=/^[[{\w-]$/;function ng(r){return r===`
`||r==="\r"||r==="	"||r==="\b"||r==="\f"}function Lr(r,e){let t=r.charCodeAt(e);return t===32||t===10||t===9||t===13}function og(r,e){let t=r.charCodeAt(e);return t===32||t===9||t===13}function sg(r,e){let t=r.charCodeAt(e);return t===160||t>=8192&&t<=8202||t===8239||t===8287||t===12288}function Uo(r){return _l(r)||Qi(r)}function _l(r){return r==='"'||r==="\u201C"||r==="\u201D"}function Cl(r){return r==='"'}function Qi(r){return r==="'"||r==="\u2018"||r==="\u2019"||r==="`"||r==="\xB4"}function bl(r){return r==="'"}function Yn(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r.lastIndexOf(e);return n!==-1?r.substring(0,n)+(t?"":r.substring(n+1)):r}function Ot(r,e){let t=r.length;if(!Lr(r,t-1))return r+e;for(;Lr(r,t-1);)t--;return r.substring(0,t)+e+r.substring(t)}function ig(r,e,t){return r.substring(0,e)+r.substring(e+t)}function ag(r){return/[,\n][ \t\r]*$/.test(r)}var Hw={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},Gw={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function El(r){let e=0,t="";d(["```","[```","{```"]),a()||Q(),d(["```","```]","```}"]);let s=C(",");for(s&&u(),yl(r[e])&&ag(t)?(s||(t=Ot(t,",")),y()):s&&(t=Yn(t,","));r[e]==="}"||r[e]==="]";)e++,u();if(e>=r.length)return t;ae();function a(){u();let J=b()||_()||T()||L()||P()||G(!1)||te();return u(),J}function u(){let J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,Y=e,ce=l(J);do ce=f(),ce&&(ce=l(J));while(ce);return e>Y}function l(J){let Y=J?Lr:og,ce="";for(;;)if(Y(r,e))ce+=r[e],e++;else if(sg(r,e))ce+=" ",e++;else break;return ce.length>0?(t+=ce,!0):!1}function f(){if(r[e]==="/"&&r[e+1]==="*"){for(;e<r.length&&!Ww(r,e);)e++;return e+=2,!0}if(r[e]==="/"&&r[e+1]==="/"){for(;e<r.length&&r[e]!==`
`;)e++;return!0}return!1}function d(J){if(h(J)){if(dl(r[e]))for(;e<r.length&&hl(r[e]);)e++;return u(),!0}return!1}function h(J){for(let Y of J){let ce=e+Y.length;if(r.slice(e,ce)===Y)return e=ce,!0}return!1}function C(J){return r[e]===J?(t+=r[e],e++,!0):!1}function w(J){return r[e]===J?(e++,!0):!1}function I(){return w("\\")}function S(){return u(),r[e]==="."&&r[e+1]==="."&&r[e+2]==="."?(e+=3,u(),w(","),!0):!1}function b(){if(r[e]==="{"){t+="{",e++,u(),w(",")&&u();let J=!0;for(;e<r.length&&r[e]!=="}";){let Y;if(J?(Y=!0,J=!1):(Y=C(","),Y||(t=Ot(t,",")),u()),S(),!(T()||G(!0))){r[e]==="}"||r[e]==="{"||r[e]==="]"||r[e]==="["||r[e]===void 0?t=Yn(t,","):ue();break}u();let Ne=C(":"),ze=e>=r.length;Ne||(yl(r[e])||ze?t=Ot(t,":"):he()),a()||(Ne||ze?t+="null":he())}return r[e]==="}"?(t+="}",e++):t=Ot(t,"}"),!0}return!1}function _(){if(r[e]==="["){t+="[",e++,u(),w(",")&&u();let J=!0;for(;e<r.length&&r[e]!=="]";)if(J?J=!1:C(",")||(t=Ot(t,",")),S(),!a()){t=Yn(t,",");break}return r[e]==="]"?(t+="]",e++):t=Ot(t,"]"),!0}return!1}function y(){let J=!0,Y=!0;for(;Y;)J?J=!1:C(",")||(t=Ot(t,",")),Y=a();Y||(t=Yn(t,",")),t=`[
${t}
]`}function T(){let J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,ce=r[e]==="\\";if(ce&&(e++,ce=!0),Uo(r[e])){let Ne=Cl(r[e])?Cl:bl(r[e])?bl:Qi(r[e])?Qi:_l,ze=e,H=t.length,ge='"';for(e++;;){if(e>=r.length){let we=W(e-1);return!J&&Lo(r.charAt(we))?(e=ze,t=t.substring(0,H),T(!0)):(ge=Ot(ge,'"'),t+=ge,!0)}if(e===Y)return ge=Ot(ge,'"'),t+=ge,!0;if(Ne(r[e])){let we=e,nr=ge.length;if(ge+='"',e++,t+=ge,u(!1),J||e>=r.length||Lo(r[e])||Uo(r[e])||Ur(r[e]))return F(),!0;let xe=W(we-1),Ie=r.charAt(xe);if(Ie===",")return e=ze,t=t.substring(0,H),T(!1,xe);if(Lo(Ie))return e=ze,t=t.substring(0,H),T(!0);t=t.substring(0,H),e=we+1,ge=`${ge.substring(0,nr)}\\${ge.substring(nr)}`}else if(J&&gl(r[e])){if(r[e-1]===":"&&pl.test(r.substring(ze+1,e+2)))for(;e<r.length&&ml.test(r[e]);)ge+=r[e],e++;return ge=Ot(ge,'"'),t+=ge,F(),!0}else if(r[e]==="\\"){let we=r.charAt(e+1);if(Gw[we]!==void 0)ge+=r.slice(e,e+2),e+=2;else if(we==="u"){let xe=2;for(;xe<6&&tg(r[e+xe]);)xe++;xe===6?(ge+=r.slice(e,e+6),e+=6):e+xe>=r.length?e=r.length:ve()}else ge+=we,e+=2}else{let we=r.charAt(e);we==='"'&&r[e-1]!=="\\"?(ge+=`\\${we}`,e++):ng(we)?(ge+=Hw[we],e++):(rg(we)||oe(we),ge+=we,e++)}ce&&I()}}return!1}function F(){let J=!1;for(u();r[e]==="+";){J=!0,e++,u(),t=Yn(t,'"',!0);let Y=t.length;T()?t=ig(t,Y,1):t=Ot(t,'"')}return J}function L(){let J=e;if(r[e]==="-"){if(e++,be())return de(J),!0;if(!Ur(r[e]))return e=J,!1}for(;Ur(r[e]);)e++;if(r[e]==="."){if(e++,be())return de(J),!0;if(!Ur(r[e]))return e=J,!1;for(;Ur(r[e]);)e++}if(r[e]==="e"||r[e]==="E"){if(e++,(r[e]==="-"||r[e]==="+")&&e++,be())return de(J),!0;if(!Ur(r[e]))return e=J,!1;for(;Ur(r[e]);)e++}if(!be())return e=J,!1;if(e>J){let Y=r.slice(J,e),ce=/^0\d/.test(Y);return t+=ce?`"${Y}"`:Y,!0}return!1}function P(){return j("true","true")||j("false","false")||j("null","null")||j("True","true")||j("False","false")||j("None","null")}function j(J,Y){return r.slice(e,e+J.length)===J?(t+=Y,e+=J.length,!0):!1}function G(J){let Y=e;if(dl(r[e])){for(;e<r.length&&hl(r[e]);)e++;let ce=e;for(;Lr(r,ce);)ce++;if(r[ce]==="(")return e=ce+1,a(),r[e]===")"&&(e++,r[e]===";"&&e++),!0}for(;e<r.length&&!gl(r[e])&&!Uo(r[e])&&(!J||r[e]!==":");)e++;if(r[e-1]===":"&&pl.test(r.substring(Y,e+2)))for(;e<r.length&&ml.test(r[e]);)e++;if(e>Y){for(;Lr(r,e-1)&&e>0;)e--;let ce=r.slice(Y,e);return t+=ce==="undefined"?"null":JSON.stringify(ce),r[e]==='"'&&e++,!0}}function te(){if(r[e]==="/"){let J=e;for(e++;e<r.length&&(r[e]!=="/"||r[e-1]==="\\");)e++;return e++,t+=`"${r.substring(J,e)}"`,!0}}function W(J){let Y=J;for(;Y>0&&Lr(r,Y);)Y--;return Y}function be(){return e>=r.length||Lo(r[e])||Lr(r,e)}function de(J){t+=`${r.slice(J,e)}0`}function oe(J){throw new Er(`Invalid character ${JSON.stringify(J)}`,e)}function ae(){throw new Er(`Unexpected character ${JSON.stringify(r[e])}`,e)}function Q(){throw new Er("Unexpected end of json string",r.length)}function ue(){throw new Er("Object key expected",e)}function he(){throw new Er("Colon expected",e)}function ve(){let J=r.slice(e,e+6);throw new Er(`Invalid unicode character "${J}"`,e)}}function Ww(r,e){return r[e]==="*"&&r[e+1]==="/"}function wl(r){if(!r||r.trim()===""||r==="{}")return"{}";try{return JSON.parse(r),re("\u5DE5\u5177\u8C03\u7528\u53C2\u6570\u6807\u51C6JSON\u89E3\u6790\u6210\u529F / Tool arguments standard JSON parsing successful"),r}catch(e){try{let t=ug.default.parse(r);return re("\u5DE5\u5177\u8C03\u7528\u53C2\u6570JSON5\u89E3\u6790\u6210\u529F / Tool arguments JSON5 parsing successful"),JSON.stringify(t)}catch(t){try{let n=El(r);return re("\u5DE5\u5177\u8C03\u7528\u53C2\u6570\u5B89\u5168\u4FEE\u590D\u6210\u529F / Tool arguments safely repaired"),n}catch(n){return re(`JSON\u89E3\u6790\u5931\u8D25 / JSON parsing failed: ${e.message}. JSON5\u89E3\u6790\u5931\u8D25 / JSON5 parsing failed: ${t.message}. JSON\u4FEE\u590D\u5931\u8D25 / JSON repair failed: ${n.message}. \u8F93\u5165\u6570\u636E / Input data: ${JSON.stringify(r)}`),re("\u8FD4\u56DE\u5B89\u5168\u7684\u7A7A\u5BF9\u8C61\u4F5C\u4E3A\u540E\u5907\u65B9\u6848 / Returning safe empty object as fallback"),"{}"}}}}var Zi=class{name="enhancetool";async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();if(t?.choices?.[0]?.message?.tool_calls?.length)for(let n of t.choices[0].message.tool_calls)n.function?.arguments&&(n.function.arguments=wl(n.function.arguments));return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s={},a=!1,u="",l=!1,f=!1,d="",h=new ReadableStream({async start(C){let w=e.body.getReader(),I=(_,y,T)=>{let F=_.split(`
`);for(let L of F)L.trim()&&y.enqueue(T.encode(L+`
`))},S=(_,y,T)=>{let F="";try{F=wl(s.arguments||"")}catch(G){re(`${G.message} ${G.stack}  \u5DE5\u5177\u8C03\u7528\u53C2\u6570\u89E3\u6790\u5931\u8D25: ${JSON.stringify(s)}`),F=s.arguments||""}let L={role:"assistant",tool_calls:[{function:{name:s.name,arguments:F},id:s.id,index:s.index,type:"function"}]},P={..._,choices:[{..._.choices[0],delta:L}]};P.choices[0].delta.content!==void 0&&delete P.choices[0].delta.content;let j=`data: ${JSON.stringify(P)}

`;y.enqueue(T.encode(j))},b=(_,y)=>{let{controller:T,encoder:F}=y;if(_.startsWith("data: ")&&_.trim()!=="data: [DONE]"){let L=_.slice(6);try{let P=JSON.parse(L);if(P.choices?.[0]?.delta?.tool_calls?.length){let G=P.choices[0].delta.tool_calls[0];if(typeof s.index>"u"){s={index:G.index,name:G.function?.name||"",id:G.id||"",arguments:G.function?.arguments||""},G.function?.arguments&&(G.function.arguments="");let te=`data: ${JSON.stringify(P)}

`;T.enqueue(F.encode(te));return}else if(s.index===G.index){G.function?.arguments&&(s.arguments+=G.function.arguments);return}else{S(P,T,F),s={index:G.index,name:G.function?.name||"",id:G.id||"",arguments:G.function?.arguments||""};return}}if(P.choices?.[0]?.finish_reason==="tool_calls"&&s.index!==void 0){S(P,T,F),s={};return}P.choices?.[0]?.delta?.tool_calls?.length&&y.hasTextContent()&&(typeof P.choices[0].index=="number"?P.choices[0].index+=1:P.choices[0].index=1);let j=`data: ${JSON.stringify(P)}

`;T.enqueue(F.encode(j))}catch{T.enqueue(F.encode(_+`
`))}}else T.enqueue(F.encode(_+`
`))};try{for(;;){let{done:_,value:y}=await w.read();if(_){d.trim()&&I(d,C,n);break}if(!y||y.length===0)continue;let T;try{T=t.decode(y,{stream:!0})}catch(L){console.warn("Failed to decode chunk",L);continue}if(T.length===0)continue;if(d+=T,d.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let L=d.split(`
`);d=L.pop()||"";for(let P of L)if(P.trim())try{b(P,{controller:C,encoder:n,hasTextContent:()=>a,setHasTextContent:j=>a=j,reasoningContent:()=>u,appendReasoningContent:j=>u+=j,isReasoningComplete:()=>l,setReasoningComplete:j=>l=j})}catch(j){console.error("Error processing line:",P,j),C.enqueue(n.encode(P+`
`))}continue}let F=d.split(`
`);d=F.pop()||"";for(let L of F)if(L.trim())try{b(L,{controller:C,encoder:n,hasTextContent:()=>a,setHasTextContent:P=>a=P,reasoningContent:()=>u,appendReasoningContent:P=>u+=P,isReasoningComplete:()=>l,setReasoningComplete:P=>l=P})}catch(P){console.error("Error processing line:",L,P),C.enqueue(n.encode(L+`
`))}}}catch(_){console.error("Stream error:",_),C.error(_)}finally{try{w.releaseLock()}catch(_){console.error("Error releasing reader lock:",_)}C.close()}}});return new Response(h,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var ea=class{constructor(e){this.options=e;this.enable=this.options?.enable??!0}static TransformerName="reasoning";enable;async transformRequestIn(e){return this.enable?(e.reasoning&&(e.thinking={type:"enabled",budget_tokens:e.reasoning.max_tokens},e.enable_thinking=!0),e):(e.thinking={type:"disabled",budget_tokens:-1},e.enable_thinking=!1,e)}async transformResponseOut(e){if(!this.enable)return e;if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s="",a=!1,u="",l=new ReadableStream({async start(f){let d=e.body.getReader(),h=(w,I,S)=>{let b=w.split(`
`);for(let _ of b)_.trim()&&I.enqueue(S.encode(_+`
`))},C=(w,I)=>{let{controller:S,encoder:b}=I;if(re("Processing reason line:",w),w.startsWith("data: ")&&w.trim()!=="data: [DONE]")try{let _=JSON.parse(w.slice(6));if(_.choices?.[0]?.delta?.reasoning_content){I.appendReasoningContent(_.choices[0].delta.reasoning_content);let y={..._,choices:[{..._.choices[0],delta:{..._.choices[0].delta,thinking:{content:_.choices[0].delta.reasoning_content}}}]};delete y.choices[0].delta.reasoning_content;let T=`data: ${JSON.stringify(y)}

`;S.enqueue(b.encode(T));return}if((_.choices?.[0]?.delta?.content||_.choices?.[0]?.delta?.tool_calls)&&I.reasoningContent()&&!I.isReasoningComplete()){I.setReasoningComplete(!0);let y=Date.now().toString(),T={..._,choices:[{..._.choices[0],delta:{..._.choices[0].delta,content:null,thinking:{content:I.reasoningContent(),signature:y}}}]};delete T.choices[0].delta.reasoning_content;let F=`data: ${JSON.stringify(T)}

`;S.enqueue(b.encode(F))}if(_.choices?.[0]?.delta?.reasoning_content&&delete _.choices[0].delta.reasoning_content,_.choices?.[0]?.delta&&Object.keys(_.choices[0].delta).length>0){I.isReasoningComplete()&&_.choices[0].index++;let y=`data: ${JSON.stringify(_)}

`;S.enqueue(b.encode(y))}}catch{S.enqueue(b.encode(w+`
`))}else S.enqueue(b.encode(w+`
`))};try{for(;;){let{done:w,value:I}=await d.read();if(w){u.trim()&&h(u,f,n);break}let S=t.decode(I,{stream:!0});u+=S;let b=u.split(`
`);u=b.pop()||"";for(let _ of b)if(_.trim())try{C(_,{controller:f,encoder:n,reasoningContent:()=>s,appendReasoningContent:y=>s+=y,isReasoningComplete:()=>a,setReasoningComplete:y=>a=y})}catch(y){console.error("Error processing line:",_,y),f.enqueue(n.encode(_+`
`))}}}catch(w){console.error("Stream error:",w),f.error(w)}finally{try{d.releaseLock()}catch(w){console.error("Error releasing reader lock:",w)}f.close()}}});return new Response(l,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var ta=class{constructor(e){this.options=e;this.max_tokens=this.options?.max_tokens,this.temperature=this.options?.temperature,this.top_p=this.options?.top_p,this.top_k=this.options?.top_k,this.repetition_penalty=this.options?.repetition_penalty}name="sampling";max_tokens;temperature;top_p;top_k;repetition_penalty;async transformRequestIn(e){return e.max_tokens&&e.max_tokens>this.max_tokens&&(e.max_tokens=this.max_tokens),typeof this.temperature<"u"&&(e.temperature=this.temperature),typeof this.top_p<"u"&&(e.top_p=this.top_p),typeof this.top_k<"u"&&(e.top_k=this.top_k),typeof this.repetition_penalty<"u"&&(e.repetition_penalty=this.repetition_penalty),e}};var ra=class{constructor(e){this.options=e;this.max_completion_tokens=this.options?.max_completion_tokens}static TransformerName="maxcompletiontokens";max_completion_tokens;async transformRequestIn(e){return e.max_tokens&&delete e.max_tokens,e.max_tokens=this.max_completion_tokens,e}};function cg(r){let e=[];for(let n=0;n<r.messages.length;n++){let s=r.messages[n],a=n===r.messages.length-1,u=s.role==="assistant",l=[];typeof s.content=="string"?l.push({type:"text",text:s.content}):Array.isArray(s.content)&&s.content.forEach(f=>{f.type==="text"?l.push({type:"text",text:f.text||""}):f.type==="image_url"&&l.push({type:"image",source:{type:"base64",media_type:f.media_type||"image/jpeg",data:f.image_url.url}})}),!(!a&&l.length===0&&!s.tool_calls&&!s.content)&&(a&&u&&l.length===0&&s.tool_calls&&l.push({type:"text",text:""}),e.push({role:s.role==="assistant"?"assistant":"user",content:l}))}let t={anthropic_version:"vertex-2023-10-16",messages:e,max_tokens:r.max_tokens||1e3,stream:r.stream||!1,...r.temperature&&{temperature:r.temperature}};return r.tools&&r.tools.length>0&&(t.tools=r.tools.map(n=>({name:n.function.name,description:n.function.description,input_schema:n.function.parameters}))),r.tool_choice&&(r.tool_choice==="auto"||r.tool_choice==="none"?t.tool_choice=r.tool_choice:typeof r.tool_choice=="string"&&(t.tool_choice={type:"tool",name:r.tool_choice})),t}function lg(r){let e=r,n={messages:e.messages.map(s=>{let a=s.content.map(u=>u.type==="text"?{type:"text",text:u.text||""}:u.type==="image"&&u.source?{type:"image_url",image_url:{url:u.source.data},media_type:u.source.media_type}:{type:"text",text:""});return{role:s.role,content:a}}),model:r.model||"claude-sonnet-4@20250514",max_tokens:e.max_tokens,temperature:e.temperature,stream:e.stream};return e.tools&&e.tools.length>0&&(n.tools=e.tools.map(s=>({type:"function",function:{name:s.name,description:s.description,parameters:{type:"object",properties:s.input_schema.properties,required:s.input_schema.required,additionalProperties:s.input_schema.additionalProperties,$schema:s.input_schema.$schema}}}))),e.tool_choice&&(typeof e.tool_choice=="string"?n.tool_choice=e.tool_choice:e.tool_choice.type==="tool"&&(n.tool_choice=e.tool_choice.name)),n}async function fg(r,e){if(r.headers.get("Content-Type")?.includes("application/json")){let t=await r.json(),n;t.tool_use&&t.tool_use.length>0&&(n=t.tool_use.map(a=>({id:a.id,type:"function",function:{name:a.name,arguments:JSON.stringify(a.input)}})));let s={id:t.id,choices:[{finish_reason:t.stop_reason||null,index:0,message:{content:t.content[0]?.text||"",role:"assistant",...n&&{tool_calls:n}}}],created:parseInt(new Date().getTime()/1e3+"",10),model:t.model,object:"chat.completion",usage:{completion_tokens:t.usage.output_tokens,prompt_tokens:t.usage.input_tokens,total_tokens:t.usage.input_tokens+t.usage.output_tokens}};return new Response(JSON.stringify(s),{status:r.status,statusText:r.statusText,headers:r.headers})}else if(r.headers.get("Content-Type")?.includes("stream")){if(!r.body)return r;let t=new TextDecoder,n=new TextEncoder,s=(u,l)=>{if(u.startsWith("data: ")){let f=u.slice(6).trim();if(f){re(`${e} chunk:`,f);try{let d=JSON.parse(f);if(d.type==="content_block_delta"&&d.delta?.type==="text_delta"){let h={choices:[{delta:{role:"assistant",content:d.delta.text||""},finish_reason:null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};l.enqueue(n.encode(`data: ${JSON.stringify(h)}

`))}else if(d.type==="content_block_delta"&&d.delta?.type==="input_json_delta"){let h={choices:[{delta:{tool_calls:[{index:d.index||0,function:{arguments:d.delta.partial_json||""}}]},finish_reason:null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};l.enqueue(n.encode(`data: ${JSON.stringify(h)}

`))}else if(d.type==="content_block_start"&&d.content_block?.type==="tool_use"){let h={choices:[{delta:{tool_calls:[{index:d.index||0,id:d.content_block.id,type:"function",function:{name:d.content_block.name,arguments:""}}]},finish_reason:null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};l.enqueue(n.encode(`data: ${JSON.stringify(h)}

`))}else if(d.type==="message_delta"){let h={choices:[{delta:{},finish_reason:d.delta?.stop_reason==="tool_use"?"tool_calls":d.delta?.stop_reason==="max_tokens"?"length":d.delta?.stop_reason==="stop_sequence"?"content_filter":"stop",index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};l.enqueue(n.encode(`data: ${JSON.stringify(h)}

`))}else if(d.type==="message_stop")l.enqueue(n.encode(`data: [DONE]

`));else{let h={choices:[{delta:{role:"assistant",content:d.content?.[0]?.text||""},finish_reason:d.stop_reason?.toLowerCase()||null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};l.enqueue(n.encode(`data: ${JSON.stringify(h)}

`))}}catch(d){re(`Error parsing ${e} stream chunk`,f,d.message)}}}},a=new ReadableStream({async start(u){let l=r.body.getReader(),f="";try{for(;;){let{done:d,value:h}=await l.read();if(d){f&&s(f,u);break}f+=t.decode(h,{stream:!0});let C=f.split(`
`);f=C.pop()||"";for(let w of C)s(w,u)}}catch(d){u.error(d)}finally{u.close()}}});return new Response(a,{status:r.status,statusText:r.statusText,headers:r.headers})}return r}async function zw(){try{let{GoogleAuth:r}=await Promise.resolve().then(()=>qe(fl(),1));return(await(await new r({scopes:["https://www.googleapis.com/auth/cloud-platform"]}).getClient()).getAccessToken()).token||""}catch(r){throw re("Error getting access token:",r),new Error(`Failed to get access token for Vertex AI. Please ensure you have set up authentication using one of these methods:
1. Set GOOGLE_APPLICATION_CREDENTIALS to point to service account key file
2. Run "gcloud auth application-default login"
3. Use Google Cloud environment with default service account`)}}var na=class{name="vertex-claude";endPoint="/v1/projects/:projectId/locations/:location/publishers/anthropic/models/:modelAndAction";async transformRequestIn(e,t){let n=process.env.GOOGLE_CLOUD_PROJECT,s=process.env.GOOGLE_CLOUD_LOCATION||"us-east5";if(!n&&process.env.GOOGLE_APPLICATION_CREDENTIALS)try{let l=(await import("fs")).readFileSync(process.env.GOOGLE_APPLICATION_CREDENTIALS,"utf8"),f=JSON.parse(l);f&&f.project_id&&(n=f.project_id)}catch(u){re("Error extracting project_id from GOOGLE_APPLICATION_CREDENTIALS:",u)}if(!n)throw new Error("Project ID is required for Vertex AI. Set GOOGLE_CLOUD_PROJECT environment variable or ensure project_id is in GOOGLE_APPLICATION_CREDENTIALS file.");let a=await zw();return{body:cg(e),config:{url:new URL(`/v1/projects/${n}/locations/${s}/publishers/anthropic/models/${e.model}:${e.stream?"streamRawPredict":"rawPredict"}`,`https://${s}-aiplatform.googleapis.com`).toString(),headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}}}async transformRequestOut(e){return lg(e)}async transformResponseOut(e){return fg(e,this.name)}};function Al(r){return typeof r=="string"?r:Array.isArray(r)?r.map(e=>typeof e=="string"?e:e.type==="text"&&e.text?e.text:"").join(""):""}var oa=class{name="cerebras";endPoint="/v1/chat/completions";async transformRequestIn(e,t){let n=JSON.parse(JSON.stringify(e));return n.messages&&Array.isArray(n.messages)&&(n.messages=n.messages.map(s=>{let a={...s};return s.content!==void 0&&(a.content=Al(s.content)),s.role==="system"&&s.content!==void 0&&(a.content=Al(s.content)),a})),n.system!==void 0&&(n.system=Al(n.system)),{body:n,config:{headers:{Authorization:`Bearer ${t.apiKey}`,"Content-Type":"application/json"}}}}async transformResponseOut(e){return e}};var dg={AnthropicTransformer:Ds,GeminiTransformer:Rs,VertexGeminiTransformer:Wi,VertexClaudeTransformer:na,DeepseekTransformer:zi,TooluseTransformer:Ji,OpenrouterTransformer:Vi,MaxTokenTransformer:Ki,GroqTransformer:Yi,CleancacheTransformer:Xi,EnhanceToolTransformer:Zi,ReasoningTransformer:ea,SamplingTransformer:ta,MaxCompletionTokens:ra,CerebrasTransformer:oa};var sa=qe(require("node:module"),1),ia=class{constructor(e){this.configService=e}transformers=new Map;registerTransformer(e,t){this.transformers.set(e,t),re(`register transformer: ${e}${t.endPoint?` (endpoint: ${t.endPoint})`:" (no endpoint)"}`)}getTransformer(e){return this.transformers.get(e)}getAllTransformers(){return new Map(this.transformers)}getTransformersWithEndpoint(){let e=[];return this.transformers.forEach((t,n)=>{t.endPoint&&e.push({name:n,transformer:t})}),e}getTransformersWithoutEndpoint(){let e=[];return this.transformers.forEach((t,n)=>{t.endPoint||e.push({name:n,transformer:t})}),e}removeTransformer(e){return this.transformers.delete(e)}hasTransformer(e){return this.transformers.has(e)}async registerTransformerFromConfig(e){try{let t=sa.default._load;if(sa.default._load=function(n,s,a){return n==="claude-code-router"?{log:re}:t.apply(sa.default,arguments)},e.path){let n=require(require.resolve(e.path));if(n){let s=new n(e.options);if(!s.name)throw new Error(`Transformer instance from ${e.path} does not have a name property.`);return this.registerTransformer(s.name,s),!0}}return!1}catch(t){return re(`load transformer (${e.path}) error:`,t.message,t.stack),!1}}async initialize(){try{await this.registerDefaultTransformersInternal(),await this.loadFromConfig()}catch(e){re("TransformerService init error:",e)}}async registerDefaultTransformersInternal(){try{Object.values(dg).forEach(e=>{if("TransformerName"in e&&typeof e.TransformerName=="string")this.registerTransformer(e.TransformerName,e);else{let t=new e;this.registerTransformer(t.name,t)}})}catch(e){re("transformer regist error:",e)}}async loadFromConfig(){let e=this.configService.get("transformers",[]);for(let t of e)await this.registerTransformerFromConfig(t)}};function Jw(){let r=(0,hg.default)({bodyLimit:52428800});return r.setErrorHandler($f),r.register(pg.default),r}var Dl=class{app;configService;llmService;providerService;transformerService;constructor(e={}){this.configService=new Cs(e),this.transformerService=new ia(this.configService),this.transformerService.initialize().finally(()=>{this.providerService=new Es(this.configService,this.transformerService),this.llmService=new bs(this.providerService)}),this.app=Jw()}async register(e,t){await this.app.register(e,t)}addHook(e,t){this.app.addHook(e,t)}async start(){try{this.app._server=this,this.app.addHook("preHandler",async(n,s)=>{if(!(n.url.startsWith("/api")||n.method!=="POST"))try{let a=n.body;if(!a||!a.model)return s.code(400).send({error:"Missing model in request body"});let[u,l]=a.model.split(",");a.model=l,n.provider=u;return}catch(a){return n.log.error("Error in modelProviderMiddleware:",a),s.code(500).send({error:"Internal server error"})}}),this.app.register(zf);let e=await this.app.listen({port:parseInt(this.configService.get("PORT")||"3000",10),host:this.configService.get("HOST")||"127.0.0.1"});re(`\u{1F680} LLMs API server listening on ${e}`);let t=async n=>{re(`Received ${n}, shutting down gracefully...`),await this.app.close(),process.exit(0)};process.on("SIGINT",()=>t("SIGINT")),process.on("SIGTERM",()=>t("SIGTERM"))}catch(e){re(`Error starting server: ${e}`),process.exit(1)}}},Vw=Dl;
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

gtoken/build/cjs/src/index.cjs:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)
*/
//# sourceMappingURL=server.cjs.map
